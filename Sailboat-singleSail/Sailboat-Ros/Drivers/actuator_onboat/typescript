Script started on 2019å¹´08æœˆ17æ—¥ æ˜ŸæœŸå…­ 21æ—¶01åˆ†26ç§’
]0;sjtu151@sjtu151-desktop: ~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat[01;32msjtu151@sjtu151-desktop[00m:[01;34m~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat[00m$ cd scripts/
]0;sjtu151@sjtu151-desktop: ~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat/scripts[01;32msjtu151@sjtu151-desktop[00m:[01;34m~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat/scripts[00m$ ls
[0m[01;32marduino_comm.py[0m  [01;32mdxl_driver_new2.py[0m  [01;32mdxl_driver_new3.py[0m  [01;32mdxl_driver_new.py[0m  [01;32mdxl_driver_old.py[0m  [01;32mdxl_driver.py[0m  nohup.out
]0;sjtu151@sjtu151-desktop: ~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat/scripts[01;32msjtu151@sjtu151-desktop[00m:[01;34m~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat/scripts[00m$ vim adruin[K[K[K[Kui[K[K[K[Karduino_comm.py 
[?1049h[?1h=[2;1Hâ–½[6n[2;1H  [1;1H]11;?[1;62r[?12;25h[?12l[?25h[27m[23m[m[H[2J[?25l[62;1H"arduino_comm.py" 250L, 7997C[>c[27m[23m[m[H[2J[1;1H[96m#!/usr/bin/env python[m
[38;5;81mimport[m rospy
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Arduino_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Out_Time_msg
[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srv
[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srvResponse

[38;5;81mimport[m struct
[38;5;81mimport[m binascii
[38;5;81mimport[m serial
[38;5;81mimport[m time
[96m# from msgdev import

#arduino_port = '/dev/serial/by-id/usb-Arduino_Srl_Arduino_Mega_75533353038351615291-if00'
#arduino_port = '/dev/ttyACM0'[m
arduino_port = [95m'/dev/arduino'[m
motor = [95m70[m
rudder = [95m90[m
sail = [95m180[m
pcCtrl = [95m0[m

green_led = [95m1[m
yellow_led = [95m0[m
red_led = [95m0[m

AHRS_outTime = [95m0[m
WTST_outTime = [95m0[m
Arduino_outTime = [95m0[m
Mach_outTime = [95m0[m

waiting_for_checking = [95m0[m

all_result = [95m0[m

[96m# pcctrl   0 rc ctrl 1 comouter ctrl
# autoflag 0 rc ctrl 1 comouter ctrl
###
#readMark = 0 error
#
###
# send 
# pcCtrl, waiting, all_result,AHRS_outTime,WTST_outTime,Arduino_outTime,Mach_outTime

# get 
# readMark autoSail motor rudder sail voltage1 voltage2[m

[93mdef[m [1m[96mcrc16[m(x):
    poly = [95m0x8408[m
    crc = [95m0x0[m
    [93mfor[m byte [93min[m x:[52;9Hcrc = crc ^ [1m[96mord[m(byte)[53;9H[93mfor[m i [93min[m [1m[96mrange[m([95m8[m):[54;13Hlast = ([95m0xFFFF[m & crc) & [95m1[m[55;13Hcrc = ([95m0xffff[m & crc) >> [95m1[m[56;13H[93mif[m last == [95m1[m:[57;17Hcrc = crc ^ poly
    [93mreturn[m crc & [95m0xFFFF[m

[93mclass[m [1m[96mArduino[m():
    [93mdef[m [1m[96m__init__[m(self):[62;187H1,1[11CTop"arduino_comm.py" 250L, 7997C[157C   [11C   [1;1H[?12l[?25hP+q436f\P+q6b75\P+q6b64\P+q6b72\P+q6b6c\P+q2332\P+q2334\P+q2569\P+q2a37\P+q6b31\[?25l[62;1H[1m-- INSERT --[m[62;13H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H8[8;1H[?12l[?25h[?25l[62;187H15,1[15;1H[?12l[?25h[?25l[62;187H22[22;1H[?12l[?25h[?25l[62;188H9[29;1H[?12l[?25h[?25l[62;187H36[36;1H[?12l[?25h[?25l[62;187H43[43;1H[?12l[?25h[?25l[62;187H50[50;1H[?12l[?25h[?25l[62;188H7[57;1H[?12l[?25h[?25l[1;61r[1;1H[3M[1;62r[60;9Hself.ser_open_flag = self.ser_open()[61;9Hself.DataShow_count = [95m0[m[62;187H[K[62;187H64,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[57;9Hself.fst = struct.Struct([95m'!4H'[m)[58;9Hself.recvDataBytes = [95m18[m[59;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[60;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][62;187H[K[62;187H71,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.buf = [95m''[m[57;5H[93mdef[m [1m[96mser_open[m(self):[58;9H[93mtry[m:[59;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[60;13Htime.sleep([95m2[m)[61;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[62;187H[K[62;187H78,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mreturn[m [1m[96mTrue[m[56;9H[93mexcept[m(serial.serialutil.SerialException):[57;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[58;13H[93mraise[60;5Hdef[m [1m[96mupdate[m(self):[61;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[62;187H[K[62;187H85,1[10C12%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13Hself.read_data()[56;13Hself.arduino_ser.write(self.send_data())[58;5H[93mdef[m [1m[96mread_data[m(self):[59;9Hn = self.arduino_ser.inWaiting()[60;9Hself.buf += self.arduino_ser.read(n)[61;9Hself.buf = self.buf[-[95m35[m:][62;187H[K[62;187H92,1[10C16%[61;1H[?12l[?25h[?25l[62;187H86[55;1H[?12l[?25h[?25l[62;187H79[48;1H[?12l[?25h[?25l[62;188H2[41;1H[?12l[?25h[?25l[62;187H65[34;1H[?12l[?25h[?25l[62;187H58[27;1H[?12l[?25h[?25l[62;188H1[20;1H[?12l[?25h[?25l[62;187H44[13;1H[?12l[?25h[?25l[62;187H37[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;1HMach_outTime = [95m0[m[62;187H[K[62;187H30,1[10C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1Hgreen_led = [95m1[m
yellow_led = [95m0[m
red_led = [95m0[m

AHRS_outTime = [95m0[m
WTST_outTime = [95m0[m
Arduino_outTime = [95m0[m[62;187H[K[62;187H23,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m#arduino_port = '/dev/ttyACM0'[m
arduino_port = [95m'/dev/arduino'[m
motor = [95m70[m
rudder = [95m90[m
sail = [95m180[m
pcCtrl = [95m0[m[62;187H[K[62;187H16,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[38;5;81mimport[m struct
[38;5;81mimport[m binascii
[38;5;81mimport[m serial
[38;5;81mimport[m time
[96m# from msgdev import

#arduino_port = '/dev/serial/by-id/usb-Arduino_Srl_Arduino_Mega_75533353038351615291-if00'[m[62;187H[K[62;187H9,1[12C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[38;5;81mimport[m rospy
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Arduino_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Out_Time_msg
[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srv
[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srvResponse[62;187H[K[62;187H2,1[12C0%[1;1H[1;61r[1;1H[L[1;62r[1;1H[96m#!/usr/bin/env python[m[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H14,1[14;1H[?12l[?25h[?25l[62;187H21[21;1H[?12l[?25h[?25l[62;188H8[28;1H[?12l[?25h[?25l[62;187H35[35;1H[?12l[?25h[?25l[62;187H42[42;1H[?12l[?25h[?25l[62;188H9[49;1H[?12l[?25h[?25l[62;187H56[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[61;9Hself.ser_open_flag = self.ser_open()[62;187H[K[62;187H63,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.DataShow_count = [95m0[m[56;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[58;9Hself.fst = struct.Struct([95m'!4H'[m)[59;9Hself.recvDataBytes = [95m18[m[60;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[61;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][62;187H[K[62;187H70,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;9Hself.buf = [95m''[m[58;5H[93mdef[m [1m[96mser_open[m(self):[59;9H[93mtry[m:[60;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[61;13Htime.sleep([95m2[m)[62;187H[K[62;187H77,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[56;13H[93mreturn[m [1m[96mTrue[m[57;9H[93mexcept[m(serial.serialutil.SerialException):[58;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[59;13H[93mraise[61;5Hdef[m [1m[96mupdate[m(self):[62;187H[K[62;187H84,1[10C12%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[56;13Hself.read_data()[57;13Hself.arduino_ser.write(self.send_data())[59;5H[93mdef[m [1m[96mread_data[m(self):[60;9Hn = self.arduino_ser.inWaiting()[61;9Hself.buf += self.arduino_ser.read(n)[62;187H[K[62;187H91,1[10C15%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.buf = self.buf[-[95m35[m:][56;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[57;9Hidx = self.buf.find(self.header)[58;9H[93mif[m idx < [95m0[m:[59;13Hself.buf = [95m''[m[60;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[61;13H[93mreturn[m[62;187H[K[62;187H98,1[10C19%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93melif[m idx > [95m0[m:[56;13Hself.buf = self.buf[idx:][57;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[58;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[59;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[60;13H[93mreturn[m[61;9H[96m#testBety = self.buf[0:9][m[62;187H[K[62;187H105,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[56;9H[96m#print datas[m[57;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[58;9H[93mif[m datas[-[95m1[m] != crc16Num:[59;13Hself.buf = self.buf[[95m2[m:][60;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[61;13H[93mreturn[m[62;187H[K[62;187H112,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][56;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[57;9Hself.buf = self.buf[[95m18[m:][59;5H[93mdef[m [1m[96msend_data[m(self):[60;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[61;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[62;187H[K[62;187H119,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[56;9Htmp = header + tmp[57;9Htmp = tmp + crc_code[58;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[59;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[60;9H[96m#print binascii.hexlify(tmp)[m[61;9H[93mreturn[m tmp[62;187H[K[62;187H126,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;5H[93mdef[m [1m[96mclose[m(self):[57;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):
    [93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m[62;187H[K[62;187H133,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hall_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param
    checkRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param[62;187H[K[62;187H140,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result
    checkRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result[62;187H[K[62;187H147,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[60;9Hself.NodeName = nodeName[61;9H[96m#self.TopicName = topicName[m[62;187H[K[62;187H154,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[56;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[57;9Hself.r = rospy.Rate([95m5[m)[58;9Hself.arduino = Arduino()[59;9Hself.arduinomsg = Arduino_msg()[60;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[61;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[62;187H[K[62;187H161,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[56;9Hself.talker()[58;5H[93mdef[m [1m[96mtalker[m(self):[59;9H[93mglobal[m green_led, yellow_led, red_led[60;9H[93mtry[m:[61;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[62;187H[K[62;187H168,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[56;17Hself.arduino.update()[57;17Hself.arduinomsg.header.stamp = rospy.Time.now()[58;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[59;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[60;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][61;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][62;187H[K[62;187H175,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][56;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][57;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][58;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][59;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][60;17Hself.pub.publish(self.arduinomsg)[62;187H[K[62;187H182,1[9C64%[61;1H[1;61r[1;1H[7M[1;62r[55;17H[93mif[m waiting_for_checking == [95m0[m:[56;21Hgreen_led = [95m1[m[57;21Hyellow_led = [95m0[m[58;21Hred_led = [95m0[m[59;17H[93melif[m all_result == [1m[96mTrue[m :[60;21H[93mif[m pcCtrl == [95m1[m :[61;25Hgreen_led = [95m2[m[62;187H[K[62;187H189,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;25Hyellow_led = [95m0[m[56;25Hred_led = [95m0[m[57;21H[93melse[m:[58;25Hgreen_led = [95m0[m[59;25Hyellow_led = [95m1[m[60;25Hred_led = [95m0[m[61;17H[93melse[m:[62;187H[K[62;187H196,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;21Hgreen_led = [95m0[m[56;21Hyellow_led = [95m0[m[57;21Hred_led = [95m1[m[58;17Hgreen_led = [95m1[m[59;17Hyellow_led = [95m0[m[60;17Hred_led = [95m0[m[61;17Hself.r.sleep()[62;187H[K[62;187H203,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mexcept[m rospy.ROSInterruptException [93mas[m e:[56;13H[1m[96mprint[m(e)[57;9H[93mfinally[m:[58;13H[1m[96mprint[m([95m'arduino closed!'[m)[59;13Hself.arduino.close()

[93mdef[m [1m[96mmachCallback[m(data):[62;187H[K[62;187H210,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m motor, rudder, sail, pcCtrl
    [96m#print ('start')
[m    [96m#rospy.loginfo("I heard %f", data.roll)[m
    motor = [1m[96mint[m(data.motor)
    [96m#max~min 40~-40[m
    rudder = [1m[96mint[m(data.rudder*[95m57.3[m)
    [96m#max~min 90-0[m[62;187H[K[62;187H217,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hsail = [1m[96mint[m([1m[96mabs[m(data.sail)*[95m57.3[m)
    pcCtrl = [1m[96mint[m(data.PCCtrl)[58;5H[93mif[m motor > [95m100[m:[59;9Hmotor = [95m100[m
    [93mif[m motor < [95m0[m:[61;9Hmotor = [95m0[m[62;187H[K[62;187H224,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m rudder > [95m105[m:[56;9Hrudder = [95m105[m
    [93mif[m rudder < [95m75[m:[58;9Hrudder = [95m75[m
    [93mif[m sail > [95m360[m:[60;9Hsail = [95m360[m
    [93mif[m sail < [95m0[m:[62;187H[K[62;187H231,1[9C89%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail = [95m0[m
    [96m#print data.motor,data.rudder,data.sail,data.pcCtrl[m
    [1m[96mprint[m [95m'get mach msg:'[m,motor,rudder,sail,pcCtrl

[93mdef[m [1m[96moutTimeCallback[m(data):
    [93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime[62;187H[K[62;187H238,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HWTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m

[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)[62;187H[K[62;187H245,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[1;1H[5M[1;62r[57;5Hrospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[1;61r[1;1H[7L[1;62r[1;9H[93mtry[m:[2;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[3;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[4;17Hself.arduino.update()[5;17Hself.arduinomsg.header.stamp = rospy.Time.now()[6;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[7;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H167,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[2;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[3;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[4;9Hself.talker()[6;5H[93mdef[m [1m[96mtalker[m(self):[7;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H160,1[9C84%[1;1H[?12l[?25h[?25l[62;189H6[7;1H[?12l[?25h[?25l[62;188H73[14;1H[?12l[?25h[?25l[62;188H80[21;1H[?12l[?25h[?25l[62;189H7[28;1H[?12l[?25h[?25l[62;188H94[35;1H[?12l[?25h[?25l[62;187H201[42;1H[?12l[?25h[?25l[62;189H8[49;1H[?12l[?25h[?25l[62;188H15[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;5H[93mif[m motor > [95m100[m:[61;9Hmotor = [95m100[m[62;187H[K[62;187H222,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m motor < [95m0[m:[56;9Hmotor = [95m0[m
    [93mif[m rudder > [95m105[m:[58;9Hrudder = [95m105[m
    [93mif[m rudder < [95m75[m:[60;9Hrudder = [95m75[m
    [93mif[m sail > [95m360[m:[62;187H[K[62;187H229,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail = [95m360[m
    [93mif[m sail < [95m0[m:[57;9Hsail = [95m0[m
    [96m#print data.motor,data.rudder,data.sail,data.pcCtrl[m
    [1m[96mprint[m [95m'get mach msg:'[m,motor,rudder,sail,pcCtrl

[93mdef[m [1m[96moutTimeCallback[m(data):[62;187H[K[62;187H236,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime
    WTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m[62;187H[K[62;187H243,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;1H[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)
    rospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H22[33;1H[?12l[?25h[?25l[62;189H9[40;1H[?12l[?25h[?25l[62;188H36[47;1H[?12l[?25h[?25l[62;188H43[54;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[?12l[?25h[?25l[62;188H80[7;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;188H94[21;1H[?12l[?25h[?25l[62;187H201[28;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;188H15[42;1H[?12l[?25h[?25l[62;188H22[49;1H[?12l[?25h[?25l[62;188H16[43;1H[?12l[?25h[?25l[62;188H09[36;1H[?12l[?25h[?25l[62;189H2[29;1H[?12l[?25h[?25l[62;187H195[22;1H[?12l[?25h[?25l[62;188H88[15;1H[?12l[?25h[?25l[62;189H1[8;1H[?12l[?25h[?25l[62;188H74[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[93mtry[m:[2;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[3;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[4;17Hself.arduino.update()[5;17Hself.arduinomsg.header.stamp = rospy.Time.now()[6;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[7;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H167,1[9C87%[1;1H[1;61r[1;1H[7L[1;62r[1;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[2;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[3;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[4;9Hself.talker()[6;5H[93mdef[m [1m[96mtalker[m(self):[7;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H160,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.NodeName = nodeName[2;9H[96m#self.TopicName = topicName[m[3;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[4;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[5;9Hself.r = rospy.Rate([95m5[m)[6;9Hself.arduino = Arduino()[7;9Hself.arduinomsg = Arduino_msg()[62;187H[K[62;187H153,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result
    checkDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[62;187H[K[62;187H146,1[9C76%[1;1H[?12l[?25h[?25l[62;188H52[7;1H[?12l[?25h[?25l[62;189H9[14;1H[?12l[?25h[?25l[62;188H66[21;1H[?12l[?25h[?25l[62;188H73[28;1H[?12l[?25h[?25l[62;188H67[22;1H[?12l[?25h[?25l[62;189H0[15;1H[?12l[?25h[?25l[62;188H53[8;1H[?12l[?25h[?25l[62;188H46[1;1H[?12l[?25h[?25l[62;188H52[7;1H[?12l[?25h[?25l[62;189H9[14;1H[?12l[?25h[?25l[62;188H66[21;1H[?12l[?25h[?25l[62;188H73[28;1H[?12l[?25h[?25l[62;188H80[35;1H[?12l[?25h[?25l[62;189H7[42;1H[?12l[?25h[?25l[62;188H94[49;1H[?12l[?25h[?25l[62;187H201[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;13H[1m[96mprint[m([95m'arduino closed!'[m)[61;13Hself.arduino.close()[62;187H[K[62;187H208,1[9C77%[61;1H[?12l[?25h[?25l[62;189H2[55;1H[?12l[?25h[?25l[62;187H195[48;1H[?12l[?25h[?25l[62;188H88[41;1H[?12l[?25h[?25l[62;189H1[34;1H[?12l[?25h[?25l[62;188H74[27;1H[?12l[?25h[?25l[62;188H67[20;1H[?12l[?25h[?25l[62;189H0[13;1H[?12l[?25h[?25l[62;188H53[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result[62;187H[K[62;187H146,1[9C76%[1;1H[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param
    checkDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result[62;187H[K[62;187H139,1[9C73%[1;1H[1;61r[1;1H[7L[1;62r[1;5H[93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m
    all_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param[62;187H[K[62;187H132,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[96m#print binascii.hexlify(tmp)[m[2;9H[93mreturn[m tmp[4;5H[93mdef[m [1m[96mclose[m(self):[5;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):[62;187H[K[62;187H125,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[2;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[3;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[4;9Htmp = header + tmp[5;9Htmp = tmp + crc_code[6;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[7;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[62;187H[K[62;187H118,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[2;13H[93mreturn[m[3;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][4;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[5;9Hself.buf = self.buf[[95m18[m:][7;5H[93mdef[m [1m[96msend_data[m(self):[62;187H[K[62;187H111,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[93mreturn[m[2;9H[96m#testBety = self.buf[0:9][m[3;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[4;9H[96m#print datas[m[5;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[6;9H[93mif[m datas[-[95m1[m] != crc16Num:[7;13Hself.buf = self.buf[[95m2[m:][62;187H[K[62;187H104,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[2;13H[93mreturn[3;9Helif[m idx > [95m0[m:[4;13Hself.buf = self.buf[idx:][5;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[6;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[7;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[62;187H[K[62;187H97,1[10C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hn = self.arduino_ser.inWaiting()[2;9Hself.buf += self.arduino_ser.read(n)[3;9Hself.buf = self.buf[-[95m35[m:][4;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[5;9Hidx = self.buf.find(self.header)[6;9H[93mif[m idx < [95m0[m:[7;13Hself.buf = [95m''[m[62;187H[K[62;187H90,1[10C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;5H[93mdef[m [1m[96mupdate[m(self):[3;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[4;13Hself.read_data()[5;13Hself.arduino_ser.write(self.send_data())[7;5H[93mdef[m [1m[96mread_data[m(self):[62;187H[K[62;187H83,1[10C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[2;13Htime.sleep([95m2[m)[3;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[4;13H[93mreturn[m [1m[96mTrue[m[5;9H[93mexcept[m(serial.serialutil.SerialException):[6;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[7;13H[93mraise[m[62;187H[K[62;187H76,1[10C39%[1;1H[?12l[?25h[?25l[62;187H82[7;1H[?12l[?25h[?25l[62;188H9[14;1H[?12l[?25h[?25l[62;187H96[21;1H[?12l[?25h[?25l[62;187H103,1[28;1H[?12l[?25h[?25l[62;188H10[35;1H[?12l[?25h[?25l[62;189H7[42;1H[?12l[?25h[?25l[62;188H24[49;1H[?12l[?25h[?25l[62;188H31[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;5HcheckArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param[62;187H[K[62;187H138,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param
    checkDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result[62;187H[K[62;187H145,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result
    checkDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[62;187H[K[62;187H152,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.NodeName = nodeName[56;9H[96m#self.TopicName = topicName[m[57;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[58;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[59;9Hself.r = rospy.Rate([95m5[m)[60;9Hself.arduino = Arduino()[61;9Hself.arduinomsg = Arduino_msg()[62;187H[K[62;187H159,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[56;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[57;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[58;9Hself.talker()[60;5H[93mdef[m [1m[96mtalker[m(self):[61;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H166,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mtry[m:[56;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[57;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[58;17Hself.arduino.update()[59;17Hself.arduinomsg.header.stamp = rospy.Time.now()[60;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[61;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H173,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][56;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][57;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][58;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][59;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][60;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][61;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H180,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.pub.publish(self.arduinomsg)[57;17H[93mif[m waiting_for_checking == [95m0[m:[58;21Hgreen_led = [95m1[m[59;21Hyellow_led = [95m0[m[60;21Hred_led = [95m0[m[61;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H187,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;21H[93mif[m pcCtrl == [95m1[m :[56;25Hgreen_led = [95m2[m[57;25Hyellow_led = [95m0[m[58;25Hred_led = [95m0[m[59;21H[93melse[m:[60;25Hgreen_led = [95m0[m[61;25Hyellow_led = [95m1[m[62;187H[K[62;187H194,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;25Hred_led = [95m0[m[56;17H[93melse[m:[57;21Hgreen_led = [95m0[m[58;21Hyellow_led = [95m0[m[59;21Hred_led = [95m1[m[60;17Hgreen_led = [95m1[m[61;17Hyellow_led = [95m0[m[62;187H[K[62;187H201,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hred_led = [95m0[m[56;17Hself.r.sleep()[57;9H[93mexcept[m rospy.ROSInterruptException [93mas[m e:[58;13H[1m[96mprint[m(e)[59;9H[93mfinally[m:[60;13H[1m[96mprint[m([95m'arduino closed!'[m)[61;13Hself.arduino.close()[62;187H[K[62;187H208,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;1H[93mdef[m [1m[96mmachCallback[m(data):
    [93mglobal[m motor, rudder, sail, pcCtrl
    [96m#print ('start')
[m    [96m#rospy.loginfo("I heard %f", data.roll)[m
    motor = [1m[96mint[m(data.motor)
    [96m#max~min 40~-40[m[62;187H[K[62;187H215,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hrudder = [1m[96mint[m(data.rudder*[95m57.3[m)
    [96m#max~min 90-0[m
    sail = [1m[96mint[m([1m[96mabs[m(data.sail)*[95m57.3[m)
    pcCtrl = [1m[96mint[m(data.PCCtrl)[60;5H[93mif[m motor > [95m100[m:[61;9Hmotor = [95m100[m[62;187H[K[62;187H222,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m motor < [95m0[m:[56;9Hmotor = [95m0[m
    [93mif[m rudder > [95m105[m:[58;9Hrudder = [95m105[m
    [93mif[m rudder < [95m75[m:[60;9Hrudder = [95m75[m
    [93mif[m sail > [95m360[m:[62;187H[K[62;187H229,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail = [95m360[m
    [93mif[m sail < [95m0[m:[57;9Hsail = [95m0[m
    [96m#print data.motor,data.rudder,data.sail,data.pcCtrl[m
    [1m[96mprint[m [95m'get mach msg:'[m,motor,rudder,sail,pcCtrl

[93mdef[m [1m[96moutTimeCallback[m(data):[62;187H[K[62;187H236,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime
    WTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m[62;187H[K[62;187H243,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;1H[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)
    rospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H5[16;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[?12l[?25h[?25l[62;188H80[7;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;188H94[21;1H[?12l[?25h[?25l[62;187H201[28;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;188H15[42;1H[?12l[?25h[?25l[62;188H22[49;1H[?12l[?25h[?25l[62;189H9[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[61;1H[93mdef[m [1m[96moutTimeCallback[m(data):[62;187H[K[62;187H236,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime
    WTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m[62;187H[K[62;187H243,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;1H[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)
    rospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;189H6[47;1H[?12l[?25h[?25l[62;188H43[54;1H[?12l[?25h[?25l[62;188H50[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H22[33;1H[?12l[?25h[?25l[62;189H9[40;1H[?12l[?25h[?25l[62;188H36[47;1H[?12l[?25h[?25l[62;188H43[54;1H[?12l[?25h[?25l[62;188H50[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[62;188H94[7;1H[?12l[?25h[?25l[62;187H201[14;1H[?12l[?25h[?25l[62;189H8[21;1H[?12l[?25h[?25l[62;188H15[28;1H[?12l[?25h[?25l[62;188H09[22;1H[?12l[?25h[?25l[62;189H2[15;1H[?12l[?25h[?25l[62;187H195[8;1H[?12l[?25h[?25l[62;187H201[14;1H[?12l[?25h[?25l[62;189H8[21;1H[?12l[?25h[?25l[62;188H15[28;1H[?12l[?25h[?25l[62;188H09[22;1H[?12l[?25h[?25l[62;189H2[15;1H[?12l[?25h[?25l[62;187H195[8;1H[?12l[?25h[?25l[62;188H88[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[93mtry[m:[2;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[3;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[4;17Hself.arduino.update()[5;17Hself.arduinomsg.header.stamp = rospy.Time.now()[6;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[7;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H167,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[2;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[3;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[4;9Hself.talker()[6;5H[93mdef[m [1m[96mtalker[m(self):[7;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H160,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.NodeName = nodeName[2;9H[96m#self.TopicName = topicName[m[3;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[4;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[5;9Hself.r = rospy.Rate([95m5[m)[6;9Hself.arduino = Arduino()[7;9Hself.arduinomsg = Arduino_msg()[62;187H[K[62;187H153,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result
    checkDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[62;187H[K[62;187H146,1[9C76%[1;1H[?12l[?25h[?25l[62;188H52[7;1H[?12l[?25h[?25l[62;189H9[14;1H[?12l[?25h[?25l[62;188H66[21;1H[?12l[?25h[?25l[62;188H73[28;1H[?12l[?25h[?25l[62;188H80[35;1H[?12l[?25h[?25l[62;189H7[42;1H[?12l[?25h[?25l[62;189H1[36;1H[?12l[?25h[?25l[62;188H74[29;1H[?12l[?25h[?25l[62;188H67[22;1H[?12l[?25h[?25l[62;189H0[15;1H[?12l[?25h[?25l[62;188H53[8;1H[?12l[?25h[?25l[62;188H46[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param
    checkDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result[62;187H[K[62;187H139,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5H[93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m
    all_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param[62;187H[K[62;187H132,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[96m#print binascii.hexlify(tmp)[m[2;9H[93mreturn[m tmp[4;5H[93mdef[m [1m[96mclose[m(self):[5;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):[62;187H[K[62;187H125,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[2;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[3;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[4;9Htmp = header + tmp[5;9Htmp = tmp + crc_code[6;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[7;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[62;187H[K[62;187H118,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[2;13H[93mreturn[m[3;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][4;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[5;9Hself.buf = self.buf[[95m18[m:][7;5H[93mdef[m [1m[96msend_data[m(self):[62;187H[K[62;187H111,1[9C58%[1;1H[?12l[?25h[?25l[62;189H7[7;1H[?12l[?25h[?25l[62;188H24[14;1H[?12l[?25h[?25l[62;188H31[21;1H[?12l[?25h[?25l[62;189H8[28;1H[?12l[?25h[?25l[62;189H2[22;1H[?12l[?25h[?25l[62;188H25[15;1H[?12l[?25h[?25l[62;188H18[8;1H[?12l[?25h[?25l[62;189H1[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[93mreturn[m[2;9H[96m#testBety = self.buf[0:9][m[3;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[4;9H[96m#print datas[m[5;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[6;9H[93mif[m datas[-[95m1[m] != crc16Num:[7;13Hself.buf = self.buf[[95m2[m:][62;187H[K[62;187H104,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[2;13H[93mreturn[3;9Helif[m idx > [95m0[m:[4;13Hself.buf = self.buf[idx:][5;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[6;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[7;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[62;187H[K[62;187H97,1[10C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hn = self.arduino_ser.inWaiting()[2;9Hself.buf += self.arduino_ser.read(n)[3;9Hself.buf = self.buf[-[95m35[m:][4;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[5;9Hidx = self.buf.find(self.header)[6;9H[93mif[m idx < [95m0[m:[7;13Hself.buf = [95m''[m[62;187H[K[62;187H90,1[10C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;5H[93mdef[m [1m[96mupdate[m(self):[3;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[4;13Hself.read_data()[5;13Hself.arduino_ser.write(self.send_data())[7;5H[93mdef[m [1m[96mread_data[m(self):[62;187H[K[62;187H83,1[10C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[2;13Htime.sleep([95m2[m)[3;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[4;13H[93mreturn[m [1m[96mTrue[m[5;9H[93mexcept[m(serial.serialutil.SerialException):[6;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[7;13H[93mraise[m[62;187H[K[62;187H76,1[10C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[2;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][4;9Hself.buf = [95m''[m[6;5H[93mdef[m [1m[96mser_open[m(self):[7;9H[93mtry[m:[62;187H[K[62;187H69,1[10C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;9Hself.ser_open_flag = self.ser_open()[3;9Hself.DataShow_count = [95m0[m[4;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[6;9Hself.fst = struct.Struct([95m'!4H'[m)[7;9Hself.recvDataBytes = [95m18[m[62;187H[K[62;187H62,1[10C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hcrc = ([95m0xffff[m & crc) >> [95m1[m[2;13H[93mif[m last == [95m1[m:[3;17Hcrc = crc ^ poly
    [93mreturn[m crc & [95m0xFFFF[m

[93mclass[m [1m[96mArduino[m():
    [93mdef[m [1m[96m__init__[m(self):[62;187H[K[62;187H55,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[93mdef[m [1m[96mcrc16[m(x):
    poly = [95m0x8408[m
    crc = [95m0x0[m
    [93mfor[m byte [93min[m x:[5;9Hcrc = crc ^ [1m[96mord[m(byte)[6;9H[93mfor[m i [93min[m [1m[96mrange[m([95m8[m):[7;13Hlast = ([95m0xFFFF[m & crc) & [95m1[m[62;187H[K[62;187H48,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m###
# send 
# pcCtrl, waiting, all_result,AHRS_outTime,WTST_outTime,Arduino_outTime,Mach_outTime

# get 
# readMark autoSail motor rudder sail voltage1 voltage2[m[62;187H[K[62;187H41,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1Hall_result = [95m0[m

[96m# pcctrl   0 rc ctrl 1 comouter ctrl
# autoflag 0 rc ctrl 1 comouter ctrl
###
#readMark = 0 error
#[m[62;187H[K[62;187H34,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1HAHRS_outTime = [95m0[m
WTST_outTime = [95m0[m
Arduino_outTime = [95m0[m
Mach_outTime = [95m0[m

waiting_for_checking = [95m0[m[62;187H[K[62;187H27,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1Hsail = [95m180[m
pcCtrl = [95m0[m

green_led = [95m1[m
yellow_led = [95m0[m
red_led = [95m0[m[62;187H[K[62;187H20,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m# from msgdev import

#arduino_port = '/dev/serial/by-id/usb-Arduino_Srl_Arduino_Mega_75533353038351615291-if00'
#arduino_port = '/dev/ttyACM0'[m
arduino_port = [95m'/dev/arduino'[m
motor = [95m70[m
rudder = [95m90[m[62;187H[K[62;187H13,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srv
[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srvResponse

[38;5;81mimport[m struct
[38;5;81mimport[m binascii
[38;5;81mimport[m serial
[38;5;81mimport[m time[62;187H[K[62;187H6,1[12C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[5L[1;62r[1;1H[96m#!/usr/bin/env python[m
[38;5;81mimport[m rospy
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Arduino_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Out_Time_msg[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H14,1[14;1H[?12l[?25h[?25l[62;187H21[21;1H[?12l[?25h[?25l[62;188H8[28;1H[?12l[?25h[?25l[62;187H35[35;1H[?12l[?25h[?25l[62;187H42[42;1H[?12l[?25h[?25l[62;188H9[49;1H[?12l[?25h[?25l[62;187H56[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[61;9Hself.ser_open_flag = self.ser_open()[62;187H[K[62;187H63,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.DataShow_count = [95m0[m[56;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[58;9Hself.fst = struct.Struct([95m'!4H'[m)[59;9Hself.recvDataBytes = [95m18[m[60;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[61;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][62;187H[K[62;187H70,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;9Hself.buf = [95m''[m[58;5H[93mdef[m [1m[96mser_open[m(self):[59;9H[93mtry[m:[60;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[61;13Htime.sleep([95m2[m)[62;187H[K[62;187H77,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[56;13H[93mreturn[m [1m[96mTrue[m[57;9H[93mexcept[m(serial.serialutil.SerialException):[58;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[59;13H[93mraise[61;5Hdef[m [1m[96mupdate[m(self):[62;187H[K[62;187H84,1[10C12%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[56;13Hself.read_data()[57;13Hself.arduino_ser.write(self.send_data())[59;5H[93mdef[m [1m[96mread_data[m(self):[60;9Hn = self.arduino_ser.inWaiting()[61;9Hself.buf += self.arduino_ser.read(n)[62;187H[K[62;187H91,1[10C15%[61;1H[?12l[?25h[?25l[62;187H85[55;1H[?12l[?25h[?25l[62;188H2[52;1H[?12l[?25h[?25l[62;187H78[48;1H[?12l[?25h[?25l[62;188H1[41;1H[?12l[?25h[?25l[62;187H64[34;1H[?12l[?25h[?25l[62;187H57[27;1H[?12l[?25h[?25l[62;188H0[20;1H[?12l[?25h[?25l[62;187H43[13;1H[?12l[?25h[?25l[62;187H36[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;1HArduino_outTime = [95m0[m
Mach_outTime = [95m0[m[62;187H[K[62;187H29,1[10C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;1Hgreen_led = [95m1[m
yellow_led = [95m0[m
red_led = [95m0[m

AHRS_outTime = [95m0[m
WTST_outTime = [95m0[m[62;187H[K[62;187H22,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m#arduino_port = '/dev/serial/by-id/usb-Arduino_Srl_Arduino_Mega_75533353038351615291-if00'
#arduino_port = '/dev/ttyACM0'[m
arduino_port = [95m'/dev/arduino'[m
motor = [95m70[m
rudder = [95m90[m
sail = [95m180[m
pcCtrl = [95m0[m[62;187H[K[62;187H15,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;1H[38;5;81mimport[m struct
[38;5;81mimport[m binascii
[38;5;81mimport[m serial
[38;5;81mimport[m time
[96m# from msgdev import[m[62;187H[K[62;187H8,1[12C3%[1;1H[?12l[?25h[?25l[62;187H14,1[7;1H[?12l[?25h[?25l[62;187H21[14;1H[?12l[?25h[?25l[62;188H8[21;1H[?12l[?25h[?25l[62;187H35[28;1H[?12l[?25h[?25l[62;187H29[22;1H[?12l[?25h[?25l[62;188H2[15;1H[?12l[?25h[?25l[62;187H15[8;1H[?12l[?25h[?25l[62;187H8,1 [1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m#!/usr/bin/env python[m
[38;5;81mimport[m rospy
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Arduino_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Out_Time_msg
[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srv
[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srvResponse[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H14,1[14;1H[?12l[?25h[?25l[62;187H21[21;1H[?12l[?25h[?25l[62;188H8[28;1H[?12l[?25h[?25l[62;187H35[35;1H[?12l[?25h[?25l[62;187H42[42;1H[?12l[?25h[?25l[62;188H9[49;1H[?12l[?25h[?25l[62;187H56[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[61;9Hself.ser_open_flag = self.ser_open()[62;187H[K[62;187H63,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.DataShow_count = [95m0[m[56;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[58;9Hself.fst = struct.Struct([95m'!4H'[m)[59;9Hself.recvDataBytes = [95m18[m[60;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[61;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][62;187H[K[62;187H70,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;9Hself.buf = [95m''[m[58;5H[93mdef[m [1m[96mser_open[m(self):[59;9H[93mtry[m:[60;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[61;13Htime.sleep([95m2[m)[62;187H[K[62;187H77,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[56;13H[93mreturn[m [1m[96mTrue[m[57;9H[93mexcept[m(serial.serialutil.SerialException):[58;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[59;13H[93mraise[61;5Hdef[m [1m[96mupdate[m(self):[62;187H[K[62;187H84,1[10C12%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[56;13Hself.read_data()[57;13Hself.arduino_ser.write(self.send_data())[59;5H[93mdef[m [1m[96mread_data[m(self):[60;9Hn = self.arduino_ser.inWaiting()[61;9Hself.buf += self.arduino_ser.read(n)[62;187H[K[62;187H91,1[10C15%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.buf = self.buf[-[95m35[m:][56;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[57;9Hidx = self.buf.find(self.header)[58;9H[93mif[m idx < [95m0[m:[59;13Hself.buf = [95m''[m[60;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[61;13H[93mreturn[m[62;187H[K[62;187H98,1[10C19%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93melif[m idx > [95m0[m:[56;13Hself.buf = self.buf[idx:][57;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[58;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[59;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[60;13H[93mreturn[m[61;9H[96m#testBety = self.buf[0:9][m[62;187H[K[62;187H105,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[56;9H[96m#print datas[m[57;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[58;9H[93mif[m datas[-[95m1[m] != crc16Num:[59;13Hself.buf = self.buf[[95m2[m:][60;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[61;13H[93mreturn[m[62;187H[K[62;187H112,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][56;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[57;9Hself.buf = self.buf[[95m18[m:][59;5H[93mdef[m [1m[96msend_data[m(self):[60;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[61;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[62;187H[K[62;187H119,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[56;9Htmp = header + tmp[57;9Htmp = tmp + crc_code[58;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[59;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[60;9H[96m#print binascii.hexlify(tmp)[m[61;9H[93mreturn[m tmp[62;187H[K[62;187H126,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;5H[93mdef[m [1m[96mclose[m(self):[57;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):
    [93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m[62;187H[K[62;187H133,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hall_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param
    checkRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param[62;187H[K[62;187H140,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result
    checkRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result[62;187H[K[62;187H147,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[60;9Hself.NodeName = nodeName[61;9H[96m#self.TopicName = topicName[m[62;187H[K[62;187H154,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[56;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[57;9Hself.r = rospy.Rate([95m5[m)[58;9Hself.arduino = Arduino()[59;9Hself.arduinomsg = Arduino_msg()[60;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[61;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[62;187H[K[62;187H161,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[56;9Hself.talker()[58;5H[93mdef[m [1m[96mtalker[m(self):[59;9H[93mglobal[m green_led, yellow_led, red_led[60;9H[93mtry[m:[61;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[62;187H[K[62;187H168,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[56;17Hself.arduino.update()[57;17Hself.arduinomsg.header.stamp = rospy.Time.now()[58;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[59;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[60;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][61;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][62;187H[K[62;187H175,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][56;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][57;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][58;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][59;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][60;17Hself.pub.publish(self.arduinomsg)[62;187H[K[62;187H182,1[9C64%[61;1H[?12l[?25h[?25l[62;188H76[55;1H[?12l[?25h[?25l[62;188H69[48;1H[?12l[?25h[?25l[62;189H2[41;1H[?12l[?25h[?25l[62;188H55[34;1H[?12l[?25h[?25l[62;188H48[27;1H[?12l[?25h[?25l[62;189H1[20;1H[?12l[?25h[?25l[62;188H34[13;1H[?12l[?25h[?25l[62;188H27[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[2;9Htmp = header + tmp[62;187H[K[62;187H120,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][2;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[3;9Hself.buf = self.buf[[95m18[m:][5;5H[93mdef[m [1m[96msend_data[m(self):[6;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[7;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[62;187H[K[62;187H113,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[2;9H[96m#print datas[m[3;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[4;9H[93mif[m datas[-[95m1[m] != crc16Num:[5;13Hself.buf = self.buf[[95m2[m:][6;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[7;13H[93mreturn[m[62;187H[K[62;187H106,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[93melif[m idx > [95m0[m:[2;13Hself.buf = self.buf[idx:][3;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[4;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[5;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[6;13H[93mreturn[m[7;9H[96m#testBety = self.buf[0:9][m[62;187H[K[62;187H99,1[10C51%[1;1H[?12l[?25h[?25l[62;187H105,1[7;1H[?12l[?25h[?25l[62;188H12[14;1H[?12l[?25h[?25l[62;189H9[21;1H[?12l[?25h[?25l[62;188H26[28;1H[?12l[?25h[?25l[62;188H33[35;1H[?12l[?25h[?25l[62;188H40[42;1H[?12l[?25h[?25l[62;189H7[49;1H[?12l[?25h[?25l[62;188H54[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[61;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[62;187H[K[62;187H161,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[56;9Hself.talker()[58;5H[93mdef[m [1m[96mtalker[m(self):[59;9H[93mglobal[m green_led, yellow_led, red_led[60;9H[93mtry[m:[61;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[62;187H[K[62;187H168,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[56;17Hself.arduino.update()[57;17Hself.arduinomsg.header.stamp = rospy.Time.now()[58;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[59;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[60;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][61;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][62;187H[K[62;187H175,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][56;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][57;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][58;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][59;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][60;17Hself.pub.publish(self.arduinomsg)[62;187H[K[62;187H182,1[9C64%[61;1H[1;61r[1;1H[7M[1;62r[55;17H[93mif[m waiting_for_checking == [95m0[m:[56;21Hgreen_led = [95m1[m[57;21Hyellow_led = [95m0[m[58;21Hred_led = [95m0[m[59;17H[93melif[m all_result == [1m[96mTrue[m :[60;21H[93mif[m pcCtrl == [95m1[m :[61;25Hgreen_led = [95m2[m[62;187H[K[62;187H189,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;25Hyellow_led = [95m0[m[56;25Hred_led = [95m0[m[57;21H[93melse[m:[58;25Hgreen_led = [95m0[m[59;25Hyellow_led = [95m1[m[60;25Hred_led = [95m0[m[61;17H[93melse[m:[62;187H[K[62;187H196,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;21Hgreen_led = [95m0[m[56;21Hyellow_led = [95m0[m[57;21Hred_led = [95m1[m[58;17Hgreen_led = [95m1[m[59;17Hyellow_led = [95m0[m[60;17Hred_led = [95m0[m[61;17Hself.r.sleep()[62;187H[K[62;187H203,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mexcept[m rospy.ROSInterruptException [93mas[m e:[56;13H[1m[96mprint[m(e)[57;9H[93mfinally[m:[58;13H[1m[96mprint[m([95m'arduino closed!'[m)[59;13Hself.arduino.close()

[93mdef[m [1m[96mmachCallback[m(data):[62;187H[K[62;187H210,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m motor, rudder, sail, pcCtrl
    [96m#print ('start')
[m    [96m#rospy.loginfo("I heard %f", data.roll)[m
    motor = [1m[96mint[m(data.motor)
    [96m#max~min 40~-40[m
    rudder = [1m[96mint[m(data.rudder*[95m57.3[m)
    [96m#max~min 90-0[m[62;187H[K[62;187H217,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hsail = [1m[96mint[m([1m[96mabs[m(data.sail)*[95m57.3[m)
    pcCtrl = [1m[96mint[m(data.PCCtrl)[58;5H[93mif[m motor > [95m100[m:[59;9Hmotor = [95m100[m
    [93mif[m motor < [95m0[m:[61;9Hmotor = [95m0[m[62;187H[K[62;187H224,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m rudder > [95m105[m:[56;9Hrudder = [95m105[m
    [93mif[m rudder < [95m75[m:[58;9Hrudder = [95m75[m
    [93mif[m sail > [95m360[m:[60;9Hsail = [95m360[m
    [93mif[m sail < [95m0[m:[62;187H[K[62;187H231,1[9C89%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail = [95m0[m
    [96m#print data.motor,data.rudder,data.sail,data.pcCtrl[m
    [1m[96mprint[m [95m'get mach msg:'[m,motor,rudder,sail,pcCtrl

[93mdef[m [1m[96moutTimeCallback[m(data):
    [93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime[62;187H[K[62;187H238,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HWTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m

[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)[62;187H[K[62;187H245,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[1;1H[5M[1;62r[57;5Hrospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;188H15[26;1H[?12l[?25h[?25l[62;188H22[33;1H[?12l[?25h[?25l[62;189H9[40;1H[?12l[?25h[?25l[62;188H36[47;1H[?12l[?25h[?25l[62;188H43[54;1H[?12l[?25h[?25l[62;188H50[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[93mtry[m:[2;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[3;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[4;17Hself.arduino.update()[5;17Hself.arduinomsg.header.stamp = rospy.Time.now()[6;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[7;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H167,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[2;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[3;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[4;9Hself.talker()[6;5H[93mdef[m [1m[96mtalker[m(self):[7;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H160,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.NodeName = nodeName[2;9H[96m#self.TopicName = topicName[m[3;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[4;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[5;9Hself.r = rospy.Rate([95m5[m)[6;9Hself.arduino = Arduino()[7;9Hself.arduinomsg = Arduino_msg()[62;187H[K[62;187H153,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result
    checkDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[62;187H[K[62;187H146,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param
    checkDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result[62;187H[K[62;187H139,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5H[93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m
    all_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param[62;187H[K[62;187H132,1[9C69%[1;1H[?12l[?25h[?25l[62;189H8[7;1H[?12l[?25h[?25l[62;188H45[14;1H[?12l[?25h[?25l[62;188H52[21;1H[?12l[?25h[?25l[62;189H9[28;1H[?12l[?25h[?25l[62;189H3[22;1H[?12l[?25h[?25l[62;188H46[15;1H[?12l[?25h[?25l[62;188H39[8;1H[?12l[?25h[?25l[62;189H2[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[96m#print binascii.hexlify(tmp)[m[2;9H[93mreturn[m tmp[4;5H[93mdef[m [1m[96mclose[m(self):[5;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):[62;187H[K[62;187H125,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[2;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[3;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[4;9Htmp = header + tmp[5;9Htmp = tmp + crc_code[6;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[7;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[62;187H[K[62;187H118,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[2;13H[93mreturn[m[3;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][4;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[5;9Hself.buf = self.buf[[95m18[m:][7;5H[93mdef[m [1m[96msend_data[m(self):[62;187H[K[62;187H111,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[93mreturn[m[2;9H[96m#testBety = self.buf[0:9][m[3;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[4;9H[96m#print datas[m[5;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[6;9H[93mif[m datas[-[95m1[m] != crc16Num:[7;13Hself.buf = self.buf[[95m2[m:][62;187H[K[62;187H104,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[2;13H[93mreturn[3;9Helif[m idx > [95m0[m:[4;13Hself.buf = self.buf[idx:][5;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[6;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[7;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[62;187H[K[62;187H97,1[10C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hn = self.arduino_ser.inWaiting()[2;9Hself.buf += self.arduino_ser.read(n)[3;9Hself.buf = self.buf[-[95m35[m:][4;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[5;9Hidx = self.buf.find(self.header)[6;9H[93mif[m idx < [95m0[m:[7;13Hself.buf = [95m''[m[62;187H[K[62;187H90,1[10C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;5H[93mdef[m [1m[96mupdate[m(self):[3;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[4;13Hself.read_data()[5;13Hself.arduino_ser.write(self.send_data())[7;5H[93mdef[m [1m[96mread_data[m(self):[62;187H[K[62;187H83,1[10C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[2;13Htime.sleep([95m2[m)[3;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[4;13H[93mreturn[m [1m[96mTrue[m[5;9H[93mexcept[m(serial.serialutil.SerialException):[6;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[7;13H[93mraise[m[62;187H[K[62;187H76,1[10C39%[1;1H[?12l[?25h[?25l[62;187H82[7;1H[?12l[?25h[?25l[62;188H9[14;1H[?12l[?25h[?25l[62;187H96[21;1H[?12l[?25h[?25l[62;187H103,1[28;1H[?12l[?25h[?25l[62;188H10[35;1H[?12l[?25h[?25l[62;189H7[42;1H[?12l[?25h[?25l[62;188H24[49;1H[?12l[?25h[?25l[62;188H18[43;1H[?12l[?25h[?25l[62;189H1[36;1H[?12l[?25h[?25l[62;188H04[29;1H[?12l[?25h[?25l[62;187H97,1 [22;1H[?12l[?25h[?25l[62;188H0[15;1H[?12l[?25h[?25l[62;187H83[8;1H[?12l[?25h[?25l[62;187H76[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[2;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][4;9Hself.buf = [95m''[m[6;5H[93mdef[m [1m[96mser_open[m(self):[7;9H[93mtry[m:[62;187H[K[62;187H69,1[10C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;9Hself.ser_open_flag = self.ser_open()[3;9Hself.DataShow_count = [95m0[m[4;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[6;9Hself.fst = struct.Struct([95m'!4H'[m)[7;9Hself.recvDataBytes = [95m18[m[62;187H[K[62;187H62,1[10C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hcrc = ([95m0xffff[m & crc) >> [95m1[m[2;13H[93mif[m last == [95m1[m:[3;17Hcrc = crc ^ poly
    [93mreturn[m crc & [95m0xFFFF[m

[93mclass[m [1m[96mArduino[m():
    [93mdef[m [1m[96m__init__[m(self):[62;187H[K[62;187H55,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[93mdef[m [1m[96mcrc16[m(x):
    poly = [95m0x8408[m
    crc = [95m0x0[m
    [93mfor[m byte [93min[m x:[5;9Hcrc = crc ^ [1m[96mord[m(byte)[6;9H[93mfor[m i [93min[m [1m[96mrange[m([95m8[m):[7;13Hlast = ([95m0xFFFF[m & crc) & [95m1[m[62;187H[K[62;187H48,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m###
# send 
# pcCtrl, waiting, all_result,AHRS_outTime,WTST_outTime,Arduino_outTime,Mach_outTime

# get 
# readMark autoSail motor rudder sail voltage1 voltage2[m[62;187H[K[62;187H41,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1Hall_result = [95m0[m

[96m# pcctrl   0 rc ctrl 1 comouter ctrl
# autoflag 0 rc ctrl 1 comouter ctrl
###
#readMark = 0 error
#[m[62;187H[K[62;187H34,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1HAHRS_outTime = [95m0[m
WTST_outTime = [95m0[m
Arduino_outTime = [95m0[m
Mach_outTime = [95m0[m

waiting_for_checking = [95m0[m[62;187H[K[62;187H27,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1Hsail = [95m180[m
pcCtrl = [95m0[m

green_led = [95m1[m
yellow_led = [95m0[m
red_led = [95m0[m[62;187H[K[62;187H20,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m# from msgdev import

#arduino_port = '/dev/serial/by-id/usb-Arduino_Srl_Arduino_Mega_75533353038351615291-if00'
#arduino_port = '/dev/ttyACM0'[m
arduino_port = [95m'/dev/arduino'[m
motor = [95m70[m
rudder = [95m90[m[62;187H[K[62;187H13,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srv
[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srvResponse

[38;5;81mimport[m struct
[38;5;81mimport[m binascii
[38;5;81mimport[m serial
[38;5;81mimport[m time[62;187H[K[62;187H6,1[12C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[5L[1;62r[1;1H[96m#!/usr/bin/env python[m
[38;5;81mimport[m rospy
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Arduino_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Out_Time_msg[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H14,1[14;1H[?12l[?25h[?25l[62;187H21[21;1H[?12l[?25h[?25l[62;188H8[28;1H[?12l[?25h[?25l[62;187H35[35;1H[?12l[?25h[?25l[62;187H42[42;1H[?12l[?25h[?25l[62;188H9[49;1H[?12l[?25h[?25l[62;187H56[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[61;9Hself.ser_open_flag = self.ser_open()[62;187H[K[62;187H63,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.DataShow_count = [95m0[m[56;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[58;9Hself.fst = struct.Struct([95m'!4H'[m)[59;9Hself.recvDataBytes = [95m18[m[60;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[61;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][62;187H[K[62;187H70,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;9Hself.buf = [95m''[m[58;5H[93mdef[m [1m[96mser_open[m(self):[59;9H[93mtry[m:[60;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[61;13Htime.sleep([95m2[m)[62;187H[K[62;187H77,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[56;13H[93mreturn[m [1m[96mTrue[m[57;9H[93mexcept[m(serial.serialutil.SerialException):[58;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[59;13H[93mraise[61;5Hdef[m [1m[96mupdate[m(self):[62;187H[K[62;187H84,1[10C12%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[56;13Hself.read_data()[57;13Hself.arduino_ser.write(self.send_data())[59;5H[93mdef[m [1m[96mread_data[m(self):[60;9Hn = self.arduino_ser.inWaiting()[61;9Hself.buf += self.arduino_ser.read(n)[62;187H[K[62;187H91,1[10C15%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.buf = self.buf[-[95m35[m:][56;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[57;9Hidx = self.buf.find(self.header)[58;9H[93mif[m idx < [95m0[m:[59;13Hself.buf = [95m''[m[60;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[61;13H[93mreturn[m[62;187H[K[62;187H98,1[10C19%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93melif[m idx > [95m0[m:[56;13Hself.buf = self.buf[idx:][57;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[58;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[59;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[60;13H[93mreturn[m[61;9H[96m#testBety = self.buf[0:9][m[62;187H[K[62;187H105,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[56;9H[96m#print datas[m[57;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[58;9H[93mif[m datas[-[95m1[m] != crc16Num:[59;13Hself.buf = self.buf[[95m2[m:][60;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[61;13H[93mreturn[m[62;187H[K[62;187H112,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][56;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[57;9Hself.buf = self.buf[[95m18[m:][59;5H[93mdef[m [1m[96msend_data[m(self):[60;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[61;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[62;187H[K[62;187H119,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[56;9Htmp = header + tmp[57;9Htmp = tmp + crc_code[58;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[59;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[60;9H[96m#print binascii.hexlify(tmp)[m[61;9H[93mreturn[m tmp[62;187H[K[62;187H126,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;5H[93mdef[m [1m[96mclose[m(self):[57;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):
    [93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m[62;187H[K[62;187H133,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hall_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param
    checkRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param[62;187H[K[62;187H140,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result
    checkRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result[62;187H[K[62;187H147,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[60;9Hself.NodeName = nodeName[61;9H[96m#self.TopicName = topicName[m[62;187H[K[62;187H154,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[56;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[57;9Hself.r = rospy.Rate([95m5[m)[58;9Hself.arduino = Arduino()[59;9Hself.arduinomsg = Arduino_msg()[60;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[61;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[62;187H[K[62;187H161,1[9C52%[61;1H[1;61r[1;1H[7M[1;62r[55;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[56;9Hself.talker()[58;5H[93mdef[m [1m[96mtalker[m(self):[59;9H[93mglobal[m green_led, yellow_led, red_led[60;9H[93mtry[m:[61;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[62;187H[K[62;187H168,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[56;17Hself.arduino.update()[57;17Hself.arduinomsg.header.stamp = rospy.Time.now()[58;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[59;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[60;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][61;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][62;187H[K[62;187H175,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][56;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][57;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][58;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][59;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][60;17Hself.pub.publish(self.arduinomsg)[62;187H[K[62;187H182,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17H[93mif[m waiting_for_checking == [95m0[m:[56;21Hgreen_led = [95m1[m[57;21Hyellow_led = [95m0[m[58;21Hred_led = [95m0[m[59;17H[93melif[m all_result == [1m[96mTrue[m :[60;21H[93mif[m pcCtrl == [95m1[m :[61;25Hgreen_led = [95m2[m[62;187H[K[62;187H189,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;25Hyellow_led = [95m0[m[56;25Hred_led = [95m0[m[57;21H[93melse[m:[58;25Hgreen_led = [95m0[m[59;25Hyellow_led = [95m1[m[60;25Hred_led = [95m0[m[61;17H[93melse[m:[62;187H[K[62;187H196,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;21Hgreen_led = [95m0[m[56;21Hyellow_led = [95m0[m[57;21Hred_led = [95m1[m[58;17Hgreen_led = [95m1[m[59;17Hyellow_led = [95m0[m[60;17Hred_led = [95m0[m[61;17Hself.r.sleep()[62;187H[K[62;187H203,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mexcept[m rospy.ROSInterruptException [93mas[m e:[56;13H[1m[96mprint[m(e)[57;9H[93mfinally[m:[58;13H[1m[96mprint[m([95m'arduino closed!'[m)[59;13Hself.arduino.close()

[93mdef[m [1m[96mmachCallback[m(data):[62;187H[K[62;187H210,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m motor, rudder, sail, pcCtrl
    [96m#print ('start')
[m    [96m#rospy.loginfo("I heard %f", data.roll)[m
    motor = [1m[96mint[m(data.motor)
    [96m#max~min 40~-40[m
    rudder = [1m[96mint[m(data.rudder*[95m57.3[m)
    [96m#max~min 90-0[m[62;187H[K[62;187H217,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hsail = [1m[96mint[m([1m[96mabs[m(data.sail)*[95m57.3[m)
    pcCtrl = [1m[96mint[m(data.PCCtrl)[58;5H[93mif[m motor > [95m100[m:[59;9Hmotor = [95m100[m
    [93mif[m motor < [95m0[m:[61;9Hmotor = [95m0[m[62;187H[K[62;187H224,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m rudder > [95m105[m:[56;9Hrudder = [95m105[m
    [93mif[m rudder < [95m75[m:[58;9Hrudder = [95m75[m
    [93mif[m sail > [95m360[m:[60;9Hsail = [95m360[m
    [93mif[m sail < [95m0[m:[62;187H[K[62;187H231,1[9C89%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail = [95m0[m
    [96m#print data.motor,data.rudder,data.sail,data.pcCtrl[m
    [1m[96mprint[m [95m'get mach msg:'[m,motor,rudder,sail,pcCtrl

[93mdef[m [1m[96moutTimeCallback[m(data):
    [93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime[62;187H[K[62;187H238,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HWTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m

[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)[62;187H[K[62;187H245,1[9C97%[61;1H[?12l[?25h[?25l[62;188H39[55;1H[?12l[?25h[?25l[62;189H2[48;1H[?12l[?25h[?25l[62;188H25[41;1H[?12l[?25h[?25l[62;188H18[34;1H[?12l[?25h[?25l[62;189H1[27;1H[?12l[?25h[?25l[62;188H04[20;1H[?12l[?25h[?25l[62;187H197[13;1H[?12l[?25h[?25l[62;189H0[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;17H[93mif[m waiting_for_checking == [95m0[m:[2;21Hgreen_led = [95m1[m[62;187H[K[62;187H183,1[9C96%[1;1H[?12l[?25h[?25l[62;189H9[7;1H[?12l[?25h[?25l[62;188H96[14;1H[?12l[?25h[?25l[62;187H203[21;1H[?12l[?25h[?25l[62;188H10[28;1H[?12l[?25h[?25l[62;189H7[35;1H[?12l[?25h[?25l[62;188H24[42;1H[?12l[?25h[?25l[62;188H31[49;1H[?12l[?25h[?25l[62;189H8[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;1H[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)[62;187H[K[62;187H245,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[1;1H[5M[1;62r[57;5Hrospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;189H8[19;1H[?12l[?25h[?25l[62;188H15[26;1H[?12l[?25h[?25l[62;188H22[33;1H[?12l[?25h[?25l[62;189H9[40;1H[?12l[?25h[?25l[62;189H3[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[93mtry[m:[2;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[3;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[4;17Hself.arduino.update()[5;17Hself.arduinomsg.header.stamp = rospy.Time.now()[6;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[7;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H167,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[2;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[3;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[4;9Hself.talker()[6;5H[93mdef[m [1m[96mtalker[m(self):[7;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H160,1[9C84%[1;1H[?12l[?25h[?25l[62;189H6[7;1H[?12l[?25h[?25l[62;189H0[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.NodeName = nodeName[2;9H[96m#self.TopicName = topicName[m[3;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[4;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[5;9Hself.r = rospy.Rate([95m5[m)[6;9Hself.arduino = Arduino()[7;9Hself.arduinomsg = Arduino_msg()[62;187H[K[62;187H153,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result
    checkDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[62;187H[K[62;187H146,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param
    checkDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result[62;187H[K[62;187H139,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5H[93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m
    all_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param[62;187H[K[62;187H132,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[96m#print binascii.hexlify(tmp)[m[2;9H[93mreturn[m tmp[4;5H[93mdef[m [1m[96mclose[m(self):[5;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):[62;187H[K[62;187H125,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[2;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[3;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[4;9Htmp = header + tmp[5;9Htmp = tmp + crc_code[6;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[7;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[62;187H[K[62;187H118,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[2;13H[93mreturn[m[3;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][4;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[5;9Hself.buf = self.buf[[95m18[m:][7;5H[93mdef[m [1m[96msend_data[m(self):[62;187H[K[62;187H111,1[9C58%[1;1H[?12l[?25h[?25l[62;189H7[7;1H[?12l[?25h[?25l[62;189H1[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[93mreturn[m[2;9H[96m#testBety = self.buf[0:9][m[3;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[4;9H[96m#print datas[m[5;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[6;9H[93mif[m datas[-[95m1[m] != crc16Num:[7;13Hself.buf = self.buf[[95m2[m:][62;187H[K[62;187H104,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[2;13H[93mreturn[3;9Helif[m idx > [95m0[m:[4;13Hself.buf = self.buf[idx:][5;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[6;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[7;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[62;187H[K[62;187H97,1[10C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;9H[93mif[m idx < [95m0[m:[2;13Hself.buf = [95m''[m[62;187H[K[62;187H95,1[10C49%[1;1H[1;61r[1;1H[5L[1;62r[1;9Hn = self.arduino_ser.inWaiting()[2;9Hself.buf += self.arduino_ser.read(n)[3;9Hself.buf = self.buf[-[95m35[m:][4;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[5;9Hidx = self.buf.find(self.header)[62;187H[K[62;187H90,1[10C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;5H[93mdef[m [1m[96mupdate[m(self):[3;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[4;13Hself.read_data()[5;13Hself.arduino_ser.write(self.send_data())[7;5H[93mdef[m [1m[96mread_data[m(self):[62;187H[K[62;187H83,1[10C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[2;13Htime.sleep([95m2[m)[3;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[4;13H[93mreturn[m [1m[96mTrue[m[5;9H[93mexcept[m(serial.serialutil.SerialException):[6;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[7;13H[93mraise[m[62;187H[K[62;187H76,1[10C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[2;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][4;9Hself.buf = [95m''[m[6;5H[93mdef[m [1m[96mser_open[m(self):[7;9H[93mtry[m:[62;187H[K[62;187H69,1[10C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;9Hself.ser_open_flag = self.ser_open()[3;9Hself.DataShow_count = [95m0[m[4;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[6;9Hself.fst = struct.Struct([95m'!4H'[m)[7;9Hself.recvDataBytes = [95m18[m[62;187H[K[62;187H62,1[10C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hcrc = ([95m0xffff[m & crc) >> [95m1[m[2;13H[93mif[m last == [95m1[m:[3;17Hcrc = crc ^ poly
    [93mreturn[m crc & [95m0xFFFF[m

[93mclass[m [1m[96mArduino[m():
    [93mdef[m [1m[96m__init__[m(self):[62;187H[K[62;187H55,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[93mdef[m [1m[96mcrc16[m(x):
    poly = [95m0x8408[m
    crc = [95m0x0[m
    [93mfor[m byte [93min[m x:[5;9Hcrc = crc ^ [1m[96mord[m(byte)[6;9H[93mfor[m i [93min[m [1m[96mrange[m([95m8[m):[7;13Hlast = ([95m0xFFFF[m & crc) & [95m1[m[62;187H[K[62;187H48,1[10C24%[1;1H[?12l[?25h[?25l[62;187H54[7;1H[?12l[?25h[?25l[62;187H61[14;1H[?12l[?25h[?25l[62;188H8[21;1H[?12l[?25h[?25l[62;187H75[28;1H[?12l[?25h[?25l[62;187H82[35;1H[?12l[?25h[?25l[62;188H9[42;1H[?12l[?25h[?25l[62;187H96[49;1H[?12l[?25h[?25l[62;187H103,1[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;9H[93mif[m datas[-[95m1[m] != crc16Num:[61;13Hself.buf = self.buf[[95m2[m:][62;187H[K[62;187H110,1[9C25%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[56;13H[93mreturn[m[57;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][58;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[59;9Hself.buf = self.buf[[95m18[m:][61;5H[93mdef[m [1m[96msend_data[m(self):[62;187H[K[62;187H117,1[9C29%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[56;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[57;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[58;9Htmp = header + tmp[59;9Htmp = tmp + crc_code[60;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[61;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[62;187H[K[62;187H124,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[96m#print binascii.hexlify(tmp)[m[56;9H[93mreturn[m tmp[58;5H[93mdef[m [1m[96mclose[m(self):[59;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):[62;187H[K[62;187H131,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m
    all_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param[62;187H[K[62;187H138,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param
    checkDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result[62;187H[K[62;187H145,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result
    checkDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[62;187H[K[62;187H152,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.NodeName = nodeName[56;9H[96m#self.TopicName = topicName[m[57;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[58;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[59;9Hself.r = rospy.Rate([95m5[m)[60;9Hself.arduino = Arduino()[61;9Hself.arduinomsg = Arduino_msg()[62;187H[K[62;187H159,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[56;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[57;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[58;9Hself.talker()[60;5H[93mdef[m [1m[96mtalker[m(self):[61;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H166,1[9C55%[61;1H[?12l[?25h[?25l[62;189H0[55;1H[?12l[?25h[?25l[62;188H53[48;1H[?12l[?25h[?25l[62;188H46[41;1H[?12l[?25h[?25l[62;188H39[34;1H[?12l[?25h[?25l[62;189H2[27;1H[?12l[?25h[?25l[62;188H25[20;1H[?12l[?25h[?25l[62;188H18[13;1H[?12l[?25h[?25l[62;189H1[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;13H[93mreturn[m[2;9H[96m#testBety = self.buf[0:9][m[62;187H[K[62;187H104,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[2;13H[93mreturn[3;9Helif[m idx > [95m0[m:[4;13Hself.buf = self.buf[idx:][5;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[6;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[7;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[62;187H[K[62;187H97,1[10C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hn = self.arduino_ser.inWaiting()[2;9Hself.buf += self.arduino_ser.read(n)[3;9Hself.buf = self.buf[-[95m35[m:][4;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[5;9Hidx = self.buf.find(self.header)[6;9H[93mif[m idx < [95m0[m:[7;13Hself.buf = [95m''[m[62;187H[K[62;187H90,1[10C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;5H[93mdef[m [1m[96mupdate[m(self):[3;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[4;13Hself.read_data()[5;13Hself.arduino_ser.write(self.send_data())[7;5H[93mdef[m [1m[96mread_data[m(self):[62;187H[K[62;187H83,1[10C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[2;13Htime.sleep([95m2[m)[3;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[4;13H[93mreturn[m [1m[96mTrue[m[5;9H[93mexcept[m(serial.serialutil.SerialException):[6;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[7;13H[93mraise[m[62;187H[K[62;187H76,1[10C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[2;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][4;9Hself.buf = [95m''[m[6;5H[93mdef[m [1m[96mser_open[m(self):[7;9H[93mtry[m:[62;187H[K[62;187H69,1[10C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;9Hself.ser_open_flag = self.ser_open()[3;9Hself.DataShow_count = [95m0[m[4;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[6;9Hself.fst = struct.Struct([95m'!4H'[m)[7;9Hself.recvDataBytes = [95m18[m[62;187H[K[62;187H62,1[10C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hcrc = ([95m0xffff[m & crc) >> [95m1[m[2;13H[93mif[m last == [95m1[m:[3;17Hcrc = crc ^ poly
    [93mreturn[m crc & [95m0xFFFF[m

[93mclass[m [1m[96mArduino[m():
    [93mdef[m [1m[96m__init__[m(self):[62;187H[K[62;187H55,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[93mdef[m [1m[96mcrc16[m(x):
    poly = [95m0x8408[m
    crc = [95m0x0[m
    [93mfor[m byte [93min[m x:[5;9Hcrc = crc ^ [1m[96mord[m(byte)[6;9H[93mfor[m i [93min[m [1m[96mrange[m([95m8[m):[7;13Hlast = ([95m0xFFFF[m & crc) & [95m1[m[62;187H[K[62;187H48,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[3L[1;62r[1;1H[96m# get 
# readMark autoSail motor rudder sail voltage1 voltage2[m[62;187H[K[62;187H45,1[10C23%[1;1H[1;61r[1;1H[4L[1;62r[1;1H[96m###
# send 
# pcCtrl, waiting, all_result,AHRS_outTime,WTST_outTime,Arduino_outTime,Mach_outTime[m[62;187H[K[62;187H41,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1Hall_result = [95m0[m

[96m# pcctrl   0 rc ctrl 1 comouter ctrl
# autoflag 0 rc ctrl 1 comouter ctrl
###
#readMark = 0 error
#[m[62;187H[K[62;187H34,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1HAHRS_outTime = [95m0[m
WTST_outTime = [95m0[m
Arduino_outTime = [95m0[m
Mach_outTime = [95m0[m

waiting_for_checking = [95m0[m[62;187H[K[62;187H27,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1Hsail = [95m180[m
pcCtrl = [95m0[m

green_led = [95m1[m
yellow_led = [95m0[m
red_led = [95m0[m[62;187H[K[62;187H20,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m# from msgdev import

#arduino_port = '/dev/serial/by-id/usb-Arduino_Srl_Arduino_Mega_75533353038351615291-if00'
#arduino_port = '/dev/ttyACM0'[m
arduino_port = [95m'/dev/arduino'[m
motor = [95m70[m
rudder = [95m90[m[62;187H[K[62;187H13,1[11C6%[1;1H[?12l[?25h[?25l[62;188H9[7;1H[?12l[?25h[?25l[62;187H26[14;1H[?12l[?25h[?25l[62;187H33[21;1H[?12l[?25h[?25l[62;187H40[28;1H[?12l[?25h[?25l[62;188H7[35;1H[?12l[?25h[?25l[62;187H54[42;1H[?12l[?25h[?25l[62;187H61[49;1H[?12l[?25h[?25l[62;188H8[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;5H[93mdef[m [1m[96mser_open[m(self):[61;9H[93mtry[m:[62;187H[K[62;187H75,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[56;13Htime.sleep([95m2[m)[57;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[58;13H[93mreturn[m [1m[96mTrue[m[59;9H[93mexcept[m(serial.serialutil.SerialException):[60;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[61;13H[93mraise[m[62;187H[K[62;187H82,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;5H[93mdef[m [1m[96mupdate[m(self):[57;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[58;13Hself.read_data()[59;13Hself.arduino_ser.write(self.send_data())[61;5H[93mdef[m [1m[96mread_data[m(self):[62;187H[K[62;187H89,1[10C14%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hn = self.arduino_ser.inWaiting()[56;9Hself.buf += self.arduino_ser.read(n)[57;9Hself.buf = self.buf[-[95m35[m:][58;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[59;9Hidx = self.buf.find(self.header)[60;9H[93mif[m idx < [95m0[m:[61;13Hself.buf = [95m''[m[62;187H[K[62;187H96,1[10C18%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[56;13H[93mreturn[57;9Helif[m idx > [95m0[m:[58;13Hself.buf = self.buf[idx:][59;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[60;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[61;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[62;187H[K[62;187H103,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mreturn[m[56;9H[96m#testBety = self.buf[0:9][m[57;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[58;9H[96m#print datas[m[59;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[60;9H[93mif[m datas[-[95m1[m] != crc16Num:[61;13Hself.buf = self.buf[[95m2[m:][62;187H[K[62;187H110,1[9C25%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[56;13H[93mreturn[m[57;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][58;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[59;9Hself.buf = self.buf[[95m18[m:][61;5H[93mdef[m [1m[96msend_data[m(self):[62;187H[K[62;187H117,1[9C29%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[56;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[57;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[58;9Htmp = header + tmp[59;9Htmp = tmp + crc_code[60;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[61;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[62;187H[K[62;187H124,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[96m#print binascii.hexlify(tmp)[m[56;9H[93mreturn[m tmp[58;5H[93mdef[m [1m[96mclose[m(self):[59;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):[62;187H[K[62;187H131,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m
    all_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param[62;187H[K[62;187H138,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param
    checkDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result[62;187H[K[62;187H145,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result
    checkDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[62;187H[K[62;187H152,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.NodeName = nodeName[56;9H[96m#self.TopicName = topicName[m[57;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[58;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[59;9Hself.r = rospy.Rate([95m5[m)[60;9Hself.arduino = Arduino()[61;9Hself.arduinomsg = Arduino_msg()[62;187H[K[62;187H159,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[56;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[57;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[58;9Hself.talker()[60;5H[93mdef[m [1m[96mtalker[m(self):[61;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H166,1[9C55%[61;1H[1;61r[1;1H[7M[1;62r[55;9H[93mtry[m:[56;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[57;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[58;17Hself.arduino.update()[59;17Hself.arduinomsg.header.stamp = rospy.Time.now()[60;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[61;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H173,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][56;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][57;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][58;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][59;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][60;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][61;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H180,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.pub.publish(self.arduinomsg)[57;17H[93mif[m waiting_for_checking == [95m0[m:[58;21Hgreen_led = [95m1[m[59;21Hyellow_led = [95m0[m[60;21Hred_led = [95m0[m[61;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H187,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;21H[93mif[m pcCtrl == [95m1[m :[56;25Hgreen_led = [95m2[m[57;25Hyellow_led = [95m0[m[58;25Hred_led = [95m0[m[59;21H[93melse[m:[60;25Hgreen_led = [95m0[m[61;25Hyellow_led = [95m1[m[62;187H[K[62;187H194,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;25Hred_led = [95m0[m[56;17H[93melse[m:[57;21Hgreen_led = [95m0[m[58;21Hyellow_led = [95m0[m[59;21Hred_led = [95m1[m[60;17Hgreen_led = [95m1[m[61;17Hyellow_led = [95m0[m[62;187H[K[62;187H201,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hred_led = [95m0[m[56;17Hself.r.sleep()[57;9H[93mexcept[m rospy.ROSInterruptException [93mas[m e:[58;13H[1m[96mprint[m(e)[59;9H[93mfinally[m:[60;13H[1m[96mprint[m([95m'arduino closed!'[m)[61;13Hself.arduino.close()[62;187H[K[62;187H208,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;1H[93mdef[m [1m[96mmachCallback[m(data):
    [93mglobal[m motor, rudder, sail, pcCtrl
    [96m#print ('start')
[m    [96m#rospy.loginfo("I heard %f", data.roll)[m
    motor = [1m[96mint[m(data.motor)
    [96m#max~min 40~-40[m[62;187H[K[62;187H215,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hrudder = [1m[96mint[m(data.rudder*[95m57.3[m)
    [96m#max~min 90-0[m
    sail = [1m[96mint[m([1m[96mabs[m(data.sail)*[95m57.3[m)
    pcCtrl = [1m[96mint[m(data.PCCtrl)[60;5H[93mif[m motor > [95m100[m:[61;9Hmotor = [95m100[m[62;187H[K[62;187H222,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m motor < [95m0[m:[56;9Hmotor = [95m0[m
    [93mif[m rudder > [95m105[m:[58;9Hrudder = [95m105[m
    [93mif[m rudder < [95m75[m:[60;9Hrudder = [95m75[m
    [93mif[m sail > [95m360[m:[62;187H[K[62;187H229,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail = [95m360[m
    [93mif[m sail < [95m0[m:[57;9Hsail = [95m0[m
    [96m#print data.motor,data.rudder,data.sail,data.pcCtrl[m
    [1m[96mprint[m [95m'get mach msg:'[m,motor,rudder,sail,pcCtrl

[93mdef[m [1m[96moutTimeCallback[m(data):[62;187H[K[62;187H236,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime
    WTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m[62;187H[K[62;187H243,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;1H[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)
    rospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;189H6[47;1H[?12l[?25h[?25l[62;188H43[54;1H[?12l[?25h[?25l[62;188H50[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[93mtry[m:[2;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[3;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[4;17Hself.arduino.update()[5;17Hself.arduinomsg.header.stamp = rospy.Time.now()[6;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[7;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H167,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[2;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[3;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[4;9Hself.talker()[6;5H[93mdef[m [1m[96mtalker[m(self):[7;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H160,1[9C84%[1;1H[?12l[?25h[?25l[62;189H6[7;1H[?12l[?25h[?25l[62;188H73[14;1H[?12l[?25h[?25l[62;188H80[21;1H[?12l[?25h[?25l[62;189H7[28;1H[?12l[?25h[?25l[62;188H94[35;1H[?12l[?25h[?25l[62;187H201[42;1H[?12l[?25h[?25l[62;189H8[49;1H[?12l[?25h[?25l[62;188H15[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;5H[93mif[m motor > [95m100[m:[61;9Hmotor = [95m100[m[62;187H[K[62;187H222,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m motor < [95m0[m:[56;9Hmotor = [95m0[m
    [93mif[m rudder > [95m105[m:[58;9Hrudder = [95m105[m
    [93mif[m rudder < [95m75[m:[60;9Hrudder = [95m75[m
    [93mif[m sail > [95m360[m:[62;187H[K[62;187H229,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail = [95m360[m
    [93mif[m sail < [95m0[m:[57;9Hsail = [95m0[m
    [96m#print data.motor,data.rudder,data.sail,data.pcCtrl[m
    [1m[96mprint[m [95m'get mach msg:'[m,motor,rudder,sail,pcCtrl

[93mdef[m [1m[96moutTimeCallback[m(data):[62;187H[K[62;187H236,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime
    WTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m[62;187H[K[62;187H243,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;1H[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)
    rospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[1;61r[1;1H[14L[1;62r[1;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[2;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[3;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[4;9Hself.talker()[6;5H[93mdef[m [1m[96mtalker[m(self):[7;9H[93mglobal[m green_led, yellow_led, red_led[8;9H[93mtry[m:[9;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[10;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[11;17Hself.arduino.update()[12;17Hself.arduinomsg.header.stamp = rospy.Time.now()[13;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[14;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H160,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.NodeName = nodeName[2;9H[96m#self.TopicName = topicName[m[3;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[4;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[5;9Hself.r = rospy.Rate([95m5[m)[6;9Hself.arduino = Arduino()[7;9Hself.arduinomsg = Arduino_msg()[62;187H[K[62;187H153,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result
    checkDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[62;187H[K[62;187H146,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param
    checkDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result[62;187H[K[62;187H139,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5H[93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m
    all_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param[62;187H[K[62;187H132,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[96m#print binascii.hexlify(tmp)[m[2;9H[93mreturn[m tmp[4;5H[93mdef[m [1m[96mclose[m(self):[5;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):[62;187H[K[62;187H125,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[2;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[3;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[4;9Htmp = header + tmp[5;9Htmp = tmp + crc_code[6;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[7;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[62;187H[K[62;187H118,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[2;13H[93mreturn[m[3;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][4;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[5;9Hself.buf = self.buf[[95m18[m:][7;5H[93mdef[m [1m[96msend_data[m(self):[62;187H[K[62;187H111,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[93mreturn[m[2;9H[96m#testBety = self.buf[0:9][m[3;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[4;9H[96m#print datas[m[5;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[6;9H[93mif[m datas[-[95m1[m] != crc16Num:[7;13Hself.buf = self.buf[[95m2[m:][62;187H[K[62;187H104,1[9C54%[1;1H[?12l[?25h[?25l[62;188H10[7;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;188H24[21;1H[?12l[?25h[?25l[62;188H31[28;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;188H45[42;1H[?12l[?25h[?25l[62;188H52[49;1H[?12l[?25h[?25l[62;189H9[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;5H[93mdef[m [1m[96mtalker[m(self):[61;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H166,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mtry[m:[56;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[57;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[58;17Hself.arduino.update()[59;17Hself.arduinomsg.header.stamp = rospy.Time.now()[60;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[61;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H173,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][56;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][57;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][58;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][59;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][60;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][61;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H180,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.pub.publish(self.arduinomsg)[57;17H[93mif[m waiting_for_checking == [95m0[m:[58;21Hgreen_led = [95m1[m[59;21Hyellow_led = [95m0[m[60;21Hred_led = [95m0[m[61;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H187,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;21H[93mif[m pcCtrl == [95m1[m :[56;25Hgreen_led = [95m2[m[57;25Hyellow_led = [95m0[m[58;25Hred_led = [95m0[m[59;21H[93melse[m:[60;25Hgreen_led = [95m0[m[61;25Hyellow_led = [95m1[m[62;187H[K[62;187H194,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;25Hred_led = [95m0[m[56;17H[93melse[m:[57;21Hgreen_led = [95m0[m[58;21Hyellow_led = [95m0[m[59;21Hred_led = [95m1[m[60;17Hgreen_led = [95m1[m[61;17Hyellow_led = [95m0[m[62;187H[K[62;187H201,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hred_led = [95m0[m[56;17Hself.r.sleep()[57;9H[93mexcept[m rospy.ROSInterruptException [93mas[m e:[58;13H[1m[96mprint[m(e)[59;9H[93mfinally[m:[60;13H[1m[96mprint[m([95m'arduino closed!'[m)[61;13Hself.arduino.close()[62;187H[K[62;187H208,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;1H[93mdef[m [1m[96mmachCallback[m(data):
    [93mglobal[m motor, rudder, sail, pcCtrl
    [96m#print ('start')
[m    [96m#rospy.loginfo("I heard %f", data.roll)[m
    motor = [1m[96mint[m(data.motor)
    [96m#max~min 40~-40[m[62;187H[K[62;187H215,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hrudder = [1m[96mint[m(data.rudder*[95m57.3[m)
    [96m#max~min 90-0[m
    sail = [1m[96mint[m([1m[96mabs[m(data.sail)*[95m57.3[m)
    pcCtrl = [1m[96mint[m(data.PCCtrl)[60;5H[93mif[m motor > [95m100[m:[61;9Hmotor = [95m100[m[62;187H[K[62;187H222,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m motor < [95m0[m:[56;9Hmotor = [95m0[m
    [93mif[m rudder > [95m105[m:[58;9Hrudder = [95m105[m
    [93mif[m rudder < [95m75[m:[60;9Hrudder = [95m75[m
    [93mif[m sail > [95m360[m:[62;187H[K[62;187H229,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail = [95m360[m
    [93mif[m sail < [95m0[m:[57;9Hsail = [95m0[m
    [96m#print data.motor,data.rudder,data.sail,data.pcCtrl[m
    [1m[96mprint[m [95m'get mach msg:'[m,motor,rudder,sail,pcCtrl

[93mdef[m [1m[96moutTimeCallback[m(data):[62;187H[K[62;187H236,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime
    WTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m[62;187H[K[62;187H243,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;1H[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)
    rospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;189H9[40;1H[?12l[?25h[?25l[62;188H36[47;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[1;61r[1;1H[7L[1;62r[1;9H[93mtry[m:[2;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[3;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[4;17Hself.arduino.update()[5;17Hself.arduinomsg.header.stamp = rospy.Time.now()[6;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[7;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[62;187H[K[62;187H167,1[9C87%[1;1H[1;61r[1;1H[7L[1;62r[1;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[2;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[3;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[4;9Hself.talker()[6;5H[93mdef[m [1m[96mtalker[m(self):[7;9H[93mglobal[m green_led, yellow_led, red_led[62;187H[K[62;187H160,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.NodeName = nodeName[2;9H[96m#self.TopicName = topicName[m[3;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[4;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[5;9Hself.r = rospy.Rate([95m5[m)[6;9Hself.arduino = Arduino()[7;9Hself.arduinomsg = Arduino_msg()[62;187H[K[62;187H153,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result
    checkDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[62;187H[K[62;187H146,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5HcheckRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param
    checkDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result[62;187H[K[62;187H139,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5H[93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m
    all_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param[62;187H[K[62;187H132,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9H[96m#print binascii.hexlify(tmp)[m[2;9H[93mreturn[m tmp[4;5H[93mdef[m [1m[96mclose[m(self):[5;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):[62;187H[K[62;187H125,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[2;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[3;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[4;9Htmp = header + tmp[5;9Htmp = tmp + crc_code[6;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[7;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[62;187H[K[62;187H118,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[2;13H[93mreturn[m[3;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][4;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[5;9Hself.buf = self.buf[[95m18[m:][7;5H[93mdef[m [1m[96msend_data[m(self):[62;187H[K[62;187H111,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[93mreturn[m[2;9H[96m#testBety = self.buf[0:9][m[3;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[4;9H[96m#print datas[m[5;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[6;9H[93mif[m datas[-[95m1[m] != crc16Num:[7;13Hself.buf = self.buf[[95m2[m:][62;187H[K[62;187H104,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[2;13H[93mreturn[3;9Helif[m idx > [95m0[m:[4;13Hself.buf = self.buf[idx:][5;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[6;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[7;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[62;187H[K[62;187H97,1[10C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hn = self.arduino_ser.inWaiting()[2;9Hself.buf += self.arduino_ser.read(n)[3;9Hself.buf = self.buf[-[95m35[m:][4;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[5;9Hidx = self.buf.find(self.header)[6;9H[93mif[m idx < [95m0[m:[7;13Hself.buf = [95m''[m[62;187H[K[62;187H90,1[10C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;5H[93mdef[m [1m[96mupdate[m(self):[3;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[4;13Hself.read_data()[5;13Hself.arduino_ser.write(self.send_data())[7;5H[93mdef[m [1m[96mread_data[m(self):[62;187H[K[62;187H83,1[10C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[2;13Htime.sleep([95m2[m)[3;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[4;13H[93mreturn[m [1m[96mTrue[m[5;9H[93mexcept[m(serial.serialutil.SerialException):[6;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[7;13H[93mraise[m[62;187H[K[62;187H76,1[10C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[2;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][4;9Hself.buf = [95m''[m[6;5H[93mdef[m [1m[96mser_open[m(self):[7;9H[93mtry[m:[62;187H[K[62;187H69,1[10C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;9Hself.ser_open_flag = self.ser_open()[3;9Hself.DataShow_count = [95m0[m[4;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[6;9Hself.fst = struct.Struct([95m'!4H'[m)[7;9Hself.recvDataBytes = [95m18[m[62;187H[K[62;187H62,1[10C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hcrc = ([95m0xffff[m & crc) >> [95m1[m[2;13H[93mif[m last == [95m1[m:[3;17Hcrc = crc ^ poly
    [93mreturn[m crc & [95m0xFFFF[m

[93mclass[m [1m[96mArduino[m():
    [93mdef[m [1m[96m__init__[m(self):[62;187H[K[62;187H55,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[93mdef[m [1m[96mcrc16[m(x):
    poly = [95m0x8408[m
    crc = [95m0x0[m
    [93mfor[m byte [93min[m x:[5;9Hcrc = crc ^ [1m[96mord[m(byte)[6;9H[93mfor[m i [93min[m [1m[96mrange[m([95m8[m):[7;13Hlast = ([95m0xFFFF[m & crc) & [95m1[m[62;187H[K[62;187H48,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m###
# send 
# pcCtrl, waiting, all_result,AHRS_outTime,WTST_outTime,Arduino_outTime,Mach_outTime

# get 
# readMark autoSail motor rudder sail voltage1 voltage2[m[62;187H[K[62;187H41,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1Hall_result = [95m0[m

[96m# pcctrl   0 rc ctrl 1 comouter ctrl
# autoflag 0 rc ctrl 1 comouter ctrl
###
#readMark = 0 error
#[m[62;187H[K[62;187H34,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1HAHRS_outTime = [95m0[m
WTST_outTime = [95m0[m
Arduino_outTime = [95m0[m
Mach_outTime = [95m0[m

waiting_for_checking = [95m0[m[62;187H[K[62;187H27,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1Hsail = [95m180[m
pcCtrl = [95m0[m

green_led = [95m1[m
yellow_led = [95m0[m
red_led = [95m0[m[62;187H[K[62;187H20,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[96m# from msgdev import

#arduino_port = '/dev/serial/by-id/usb-Arduino_Srl_Arduino_Mega_75533353038351615291-if00'
#arduino_port = '/dev/ttyACM0'[m
arduino_port = [95m'/dev/arduino'[m
motor = [95m70[m
rudder = [95m90[m[62;187H[K[62;187H13,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srv
[38;5;81mfrom[m sailboat_message.srv [38;5;81mimport[m Self_Checking_srvResponse

[38;5;81mimport[m struct
[38;5;81mimport[m binascii
[38;5;81mimport[m serial
[38;5;81mimport[m time[62;187H[K[62;187H6,1[12C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[5L[1;62r[1;1H[96m#!/usr/bin/env python[m
[38;5;81mimport[m rospy
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Arduino_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Out_Time_msg[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H14,1[14;1H[?12l[?25h[?25l[62;187H21[21;1H[?12l[?25h[?25l[62;188H8[28;1H[?12l[?25h[?25l[62;187H35[35;1H[?12l[?25h[?25l[62;187H42[42;1H[?12l[?25h[?25l[62;188H9[49;1H[?12l[?25h[?25l[62;187H56[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[61;9Hself.ser_open_flag = self.ser_open()[62;187H[K[62;187H63,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.DataShow_count = [95m0[m[56;9Hself.header = [1m[96mchr[m([95m0x4f[m) + [1m[96mchr[m([95m0x5e[m)[58;9Hself.fst = struct.Struct([95m'!4H'[m)[59;9Hself.recvDataBytes = [95m18[m[60;9Hself.recvDataFst = struct.Struct([95m'<H7hH'[m)[61;9Hself.EarduinoDatas = [[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m,[95m0[m][62;187H[K[62;187H70,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;9Hself.buf = [95m''[m[58;5H[93mdef[m [1m[96mser_open[m(self):[59;9H[93mtry[m:[60;13Hself.arduino_ser = serial.Serial(arduino_port, [95m115200[m, timeout=[95m1[m)[61;13Htime.sleep([95m2[m)[62;187H[K[62;187H77,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m#self.logger.info(self.ahrs_ser.portstr+' open successfully')[m[56;13H[93mreturn[m [1m[96mTrue[m[57;9H[93mexcept[m(serial.serialutil.SerialException):[58;13H[96m#self.logger.info('could not open port: '+ahrs_port)[m[59;13H[93mraise[61;5Hdef[m [1m[96mupdate[m(self):[62;187H[K[62;187H84,1[10C12%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mif[m self.ser_open_flag [93mis[m [1m[96mTrue[m:[56;13Hself.read_data()[57;13Hself.arduino_ser.write(self.send_data())[59;5H[93mdef[m [1m[96mread_data[m(self):[60;9Hn = self.arduino_ser.inWaiting()[61;9Hself.buf += self.arduino_ser.read(n)[62;187H[K[62;187H91,1[10C15%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.buf = self.buf[-[95m35[m:][56;9H[1m[96mprint[m [95m'arduino read:'[m,binascii.hexlify(self.buf)[57;9Hidx = self.buf.find(self.header)[58;9H[93mif[m idx < [95m0[m:[59;13Hself.buf = [95m''[m[60;13H[1m[96mprint[m ([95m'ReadError: header not found, discard buffer'[m)[61;13H[93mreturn[m[62;187H[K[62;187H98,1[10C19%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93melif[m idx > [95m0[m:[56;13Hself.buf = self.buf[idx:][57;13H[1m[96mprint[m ([95m'ReadError: header not at start, discard bytes before header'[m)[58;9H[93mif[m [1m[96mlen[m(self.buf) < [95m18[m:[59;13H[1m[96mprint[m ([95m'ReadError: not enough data'[m)[60;13H[93mreturn[m[61;9H[96m#testBety = self.buf[0:9][m[62;187H[K[62;187H105,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hdatas = self.recvDataFst.unpack(self.buf[[95m0[m:[95m18[m])[56;9H[96m#print datas[m[57;9Hcrc16Num = crc16(self.buf[[95m2[m:[95m16[m])[58;9H[93mif[m datas[-[95m1[m] != crc16Num:[59;13Hself.buf = self.buf[[95m2[m:][60;13H[1m[96mprint[m ([95m'ReadError: ckcum error, discard first 2 bytes'[m)[61;13H[93mreturn[m[62;187H[K[62;187H112,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hself.EarduinoDatas = datas[[95m1[m:-[95m1[m][56;9H[1m[96mprint[m [95m'arduino read data:'[m,self.EarduinoDatas[57;9Hself.buf = self.buf[[95m18[m:][59;5H[93mdef[m [1m[96msend_data[m(self):[60;9Hheader = [95m'[m[38;5;224m\xff\x01[m[95m'[m[61;9Htmp = self.fst.pack(motor,rudder,sail,pcCtrl)[62;187H[K[62;187H119,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hcrc_code = struct.pack([95m'!H'[m, crc16(tmp))[56;9Htmp = header + tmp[57;9Htmp = tmp + crc_code[58;9H[1m[96mprint[m [95m'motor'[m, motor, [95m'greed_led'[m, green_led, [95m'yellow_led'[m, yellow_led, [95m'red_led'[m, red_led[59;9H[1m[96mprint[m [95m'send data:'[m,binascii.hexlify(tmp), [1m[96mtype[m(tmp)[60;9H[96m#print binascii.hexlify(tmp)[m[61;9H[93mreturn[m tmp[62;187H[K[62;187H126,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;5H[93mdef[m [1m[96mclose[m(self):[57;9Hself.arduino_ser.close()

[93mdef[m [1m[96mhandleSelfChecking[m(data):
    [93mglobal[m all_result, waiting_for_checking
    waiting_for_checking = [95m1[m[62;187H[K[62;187H133,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hall_result = data.all_result
    checkAHRS_param = data.checkAHRS_param
    checkWTST_param = data.checkWTST_param
    checkArduino_param = data.checkArduino_param
    checkCamera_param = data.checkCamera_param
    checkRadar_param = data.checkRadar_param
    checkDynamixel_param = data.checkDynamixel_param[62;187H[K[62;187H140,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckDisk_param = data.checkDisk_param
    checkAHRS_result = data.checkAHRS_result
    checkWTST_result = data.checkWTST_result
    checkArduino_result = data.checkArduino_result
    checkCamera_result = data.checkCamera_result
    checkRadar_result = data.checkRadar_result
    checkDynamixel_result = data.checkDynamixel_result[62;187H[K[62;187H147,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HcheckDisk_result = data.checkDisk_result
    [93mreturn[m Self_Checking_srvResponse([1m[96mTrue[m)

[93mclass[m [1m[96mSensorListener[m:
    [93mdef[m [1m[96m__init__[m(self,nodeName):[60;9Hself.NodeName = nodeName[61;9H[96m#self.TopicName = topicName[m[62;187H[K[62;187H154,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.init_node(self.NodeName, anonymous=[1m[96mTrue[m)[56;9Hself.pub = rospy.Publisher([95m'arduino'[m, Arduino_msg, queue_size=[95m5[m)[57;9Hself.r = rospy.Rate([95m5[m)[58;9Hself.arduino = Arduino()[59;9Hself.arduinomsg = Arduino_msg()[60;9Hrospy.Subscriber([95m'/base/mach'[m, Mach_msg, machCallback)[61;9Hrospy.Subscriber([95m'/out_time'[m, Mach_msg, outTimeCallback)[62;187H[K[62;187H161,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hrospy.Service([95m'self_checking_arduino_srv'[m,Self_Checking_srv,handleSelfChecking)[56;9Hself.talker()[58;5H[93mdef[m [1m[96mtalker[m(self):[59;9H[93mglobal[m green_led, yellow_led, red_led[60;9H[93mtry[m:[61;13H[96m# spin() simply keeps python from exiting until this node is stopped[m[62;187H[K[62;187H168,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mwhile[m [93mnot[m rospy.is_shutdown():[56;17Hself.arduino.update()[57;17Hself.arduinomsg.header.stamp = rospy.Time.now()[58;17Hself.arduinomsg.header.frame_id = [95m'arduino'[m[59;17H[96m#self.arduinomsg.timestamp = rospy.get_time()[m[60;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][61;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][62;187H[K[62;187H175,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][56;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][57;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][58;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][59;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][60;17Hself.pub.publish(self.arduinomsg)[62;187H[K[62;187H182,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17H[93mif[m waiting_for_checking == [95m0[m:[56;21Hgreen_led = [95m1[m[57;21Hyellow_led = [95m0[m[58;21Hred_led = [95m0[m[59;17H[93melif[m all_result == [1m[96mTrue[m :[60;21H[93mif[m pcCtrl == [95m1[m :[61;25Hgreen_led = [95m2[m[62;187H[K[62;187H189,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;25Hyellow_led = [95m0[m[56;25Hred_led = [95m0[m[57;21H[93melse[m:[58;25Hgreen_led = [95m0[m[59;25Hyellow_led = [95m1[m[60;25Hred_led = [95m0[m[61;17H[93melse[m:[62;187H[K[62;187H196,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;21Hgreen_led = [95m0[m[56;21Hyellow_led = [95m0[m[57;21Hred_led = [95m1[m[58;17Hgreen_led = [95m1[m[59;17Hyellow_led = [95m0[m[60;17Hred_led = [95m0[m[61;17Hself.r.sleep()[62;187H[K[62;187H203,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mexcept[m rospy.ROSInterruptException [93mas[m e:[56;13H[1m[96mprint[m(e)[57;9H[93mfinally[m:[58;13H[1m[96mprint[m([95m'arduino closed!'[m)[59;13Hself.arduino.close()

[93mdef[m [1m[96mmachCallback[m(data):[62;187H[K[62;187H210,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m motor, rudder, sail, pcCtrl
    [96m#print ('start')
[m    [96m#rospy.loginfo("I heard %f", data.roll)[m
    motor = [1m[96mint[m(data.motor)
    [96m#max~min 40~-40[m
    rudder = [1m[96mint[m(data.rudder*[95m57.3[m)
    [96m#max~min 90-0[m[62;187H[K[62;187H217,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hsail = [1m[96mint[m([1m[96mabs[m(data.sail)*[95m57.3[m)
    pcCtrl = [1m[96mint[m(data.PCCtrl)[58;5H[93mif[m motor > [95m100[m:[59;9Hmotor = [95m100[m
    [93mif[m motor < [95m0[m:[61;9Hmotor = [95m0[m[62;187H[K[62;187H224,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m rudder > [95m105[m:[56;9Hrudder = [95m105[m
    [93mif[m rudder < [95m75[m:[58;9Hrudder = [95m75[m
    [93mif[m sail > [95m360[m:[60;9Hsail = [95m360[m
    [93mif[m sail < [95m0[m:[62;187H[K[62;187H231,1[9C89%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail = [95m0[m
    [96m#print data.motor,data.rudder,data.sail,data.pcCtrl[m
    [1m[96mprint[m [95m'get mach msg:'[m,motor,rudder,sail,pcCtrl

[93mdef[m [1m[96moutTimeCallback[m(data):
    [93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime[62;187H[K[62;187H238,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5HWTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m

[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)[62;187H[K[62;187H245,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[1;1H[5M[1;62r[57;5Hrospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;188H16[27;1H[?12l[?25h[?25l[62;188H09[20;1H[?12l[?25h[?25l[62;189H2[13;1H[?12l[?25h[?25l[62;187H195[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;21H[93mif[m pcCtrl == [95m1[m :[2;25Hgreen_led = [95m2[m[62;187H[K[62;187H188,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.pub.publish(self.arduinomsg)[3;17H[93mif[m waiting_for_checking == [95m0[m:[4;21Hgreen_led = [95m1[m[5;21Hyellow_led = [95m0[m[6;21Hred_led = [95m0[m[7;17H[93melif[m all_result == [1m[96mTrue[m :[62;187H[K[62;187H181,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hself.arduinomsg.readMark = self.arduino.EarduinoDatas[[95m0[m][2;17Hself.arduinomsg.autoFlag = self.arduino.EarduinoDatas[[95m1[m][3;17Hself.arduinomsg.motor = self.arduino.EarduinoDatas[[95m2[m][4;17Hself.arduinomsg.rudder = self.arduino.EarduinoDatas[[95m3[m][5;17Hself.arduinomsg.sail = self.arduino.EarduinoDatas[[95m4[m][6;17Hself.arduinomsg.voltage1 = self.arduino.EarduinoDatas[[95m5[m][7;17Hself.arduinomsg.voltage2 = self.arduino.EarduinoDatas[[95m6[m][62;187H[K[62;187H174,1[9C91%[1;1H[?12l[?25h[?25l[62;188H80[7;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;188H94[21;1H[?12l[?25h[?25l[62;187H201[28;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;188H15[42;1H[?12l[?25h[?25l[62;188H22[49;1H[?12l[?25h[?25l[62;189H9[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[61;1H[93mdef[m [1m[96moutTimeCallback[m(data):[62;187H[K[62;187H236,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m AHRS_outTime, WTST_outTime, Arduino_outTime, Mach_outTime
    AHRS_outTime = data.AHRS_outTime
    WTST_outTime = data.WTST_outTime
    Arduino_outTime = data.Arduino_outTime
    Mach_outTime = data.Mach_outTime
    [96m#if AHRS_outTime[m[62;187H[K[62;187H243,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;1H[93mdef[m [1m[96mtalker[m():[96m#ros message publish[m
    SensorListener([95m'arduino'[m)
    rospy.spin()

[93mif[m __name__ == [95m'__main__'[m:
    talker()[62;187H[K[62;187H250,1[9CBot[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;189H9[40;1H[?12l[?25h[?25l[62;188H36[47;1H[?12l[?25h[?25l[62;188H43[54;1H[?12l[?25h[?25l[62;188H50[61;1H[?12l[?25h[?25l[62;188H44[55;1H[?12l[?25h[?25l[62;188H37[48;1H[?12l[?25h[?25l[62;189H0[41;1H[?12l[?25h[?25l[62;188H23[34;1H[?12l[?25h[?25l[62;189H9[40;1H[?12l[?25h[?25l[62;188H36[47;1H[?12l[?25h[?25l[62;188H43[54;1H[?12l[?25h[?25l[62;188H50[61;1H[?12l[?25h[62;1H[K[61;1H[?25l[62;187H250,0-1[7CBot[61;1H[?12l[?25h[?25l[62;187H[K[62;1H:[?12l[?25hw[?25l[?12l[?25hq[?25l[?12l[?25h[?25l"arduino_comm.py" 250L, 7997C written
[?1l>[?12l[?25h[?1049l]0;sjtu151@sjtu151-desktop: ~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat/scripts[01;32msjtu151@sjtu151-desktop[00m:[01;34m~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat/scripts[00m$ [K]0;sjtu151@sjtu151-desktop: ~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat/scripts[01;32msjtu151@sjtu151-desktop[00m:[01;34m~/sailboat-ws/src/Sailboat-Ros/Drivers/actuator_onboat/scripts[00m$ cd ~/sailboat-ws/src/Sailboat-Ros/Class/spare_function/scripts
]0;sjtu151@sjtu151-desktop: ~/sailboat-ws/src/Sailboat-Ros/Class/spare_function/scripts[01;32msjtu151@sjtu151-desktop[00m:[01;34m~/sailboat-ws/src/Sailboat-Ros/Class/spare_function/scripts[00m$ python example3.py 
^C]0;sjtu151@sjtu151-desktop: ~/sailboat-ws/src/Sailboat-Ros/Class/spare_function/scripts[01;32msjtu151@sjtu151-desktop[00m:[01;34m~/sailboat-ws/src/Sailboat-Ros/Class/spare_function/scripts[00m$ vim example3.py 
[?1049h[?1h=[2;1Hâ–½[6n[2;1H  [1;1H]11;?[1;62r[?12;25h[?12l[?25h[27m[23m[m[H[2J[?25l[62;1H"example3.py" 374L, 12089C[>c[1;1H[34m#!/usr/bin/env python[m
[35mimport[m rospy
[35mfrom[m sailboat_message.msg [35mimport[m Sensor_msg
[35mfrom[m sailboat_message.msg [35mimport[m Mach_msg

[35mfrom[m spare_function.cfg [35mimport[m spare_function_Config
[35mfrom[m spare_function.msg [35mimport[m spare_function_out
[35mfrom[m spare_function.msg [35mimport[m spare_function_para

[35mfrom[m dynamic_reconfigure.server [35mimport[m Server

[35mimport[m math

pi = [31m3.14159[m

sensor_submsg = [[31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m]
para_cfg = [[31m0[m, [31m0[m, [31m0[m, [31m0[m, [31m0[m, [31m0[m, [31m0[m, [31m0[m]
rudA = [31m0.0[m
sailA = [31m0.0[m
X0 = -[31m1.0[m
Y0 = -[31m3.0[m
oyaw0 = [31m1.0[m
oyaw1 = oyaw0
sub_oyaw = [31m190.0[m

devA = [31m0.0[m
devA0 = [31m0.0[m

Per = [31m0.0[m
Ier = [31m0.0[m
Der = [31m0.0[m

TWA0 = [31m1.0[m
Zip = [31m1[m
turnL = [31m0[m
turnR = [31m0[m
Flag0 = [36mFalse[m

devD0 = [31m0.0[m

gox = [31m0.1[m
goy = [31m0.1[m

nub = [31m0[m
track = [[31m20[m, -[31m10[m, -[31m30[m, [31m0[m, [31m0[m, [31m20[m]  [34m# [x0, y0, x1, y1, x2, y2][m

AgainstWind = [36mFalse[m
AgainstWind0 = [36mFalse[m

count = [31m0[m

[38;5;130mdef[m [36mgetOutMachPut[m(msg):  [34m# sailboat_message::Mach_msg[m
    mach_pub = Mach_msg()
    mach_pub.header.stamp = rospy.Time.now()
    mach_pub.header.frame_id = [31m'AHRS'[m
    [34m# mach_pub.timestamp = rospy.Time.now()[m
    mach_pub.motor = [31m57[m
    mach_pub.rudder = msg[[31m0[m]
    mach_pub.sail   = msg[[31m1[m]
    mach_pub.PCCtrl = msg[[31m2[m]
    [38;5;130mreturn[m mach_pub[62;187H1,1[11CTop[1;1H[?12l[?25h[27m[23m[m[H[2J[?25l[1;1H[96m#!/usr/bin/env python[m
[38;5;81mimport[m rospy
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Sensor_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg

[38;5;81mfrom[m spare_function.cfg [38;5;81mimport[m spare_function_Config
[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_out
[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_para

[38;5;81mfrom[m dynamic_reconfigure.server [38;5;81mimport[m Server

[38;5;81mimport[m math

pi = [95m3.14159[m

sensor_submsg = [[95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m]
para_cfg = [[95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m]
rudA = [95m0.0[m
sailA = [95m0.0[m
X0 = -[95m1.0[m
Y0 = -[95m3.0[m
oyaw0 = [95m1.0[m
oyaw1 = oyaw0
sub_oyaw = [95m190.0[m

devA = [95m0.0[m
devA0 = [95m0.0[m

Per = [95m0.0[m
Ier = [95m0.0[m
Der = [95m0.0[m

TWA0 = [95m1.0[m
Zip = [95m1[m
turnL = [95m0[m
turnR = [95m0[m
Flag0 = [1m[96mFalse[m

devD0 = [95m0.0[m

gox = [95m0.1[m
goy = [95m0.1[m

nub = [95m0[m
track = [[95m20[m, -[95m10[m, -[95m30[m, [95m0[m, [95m0[m, [95m20[m]  [96m# [x0, y0, x1, y1, x2, y2][m

AgainstWind = [1m[96mFalse[m
AgainstWind0 = [1m[96mFalse[m

count = [95m0[m

[93mdef[m [1m[96mgetOutMachPut[m(msg):  [96m# sailboat_message::Mach_msg[m
    mach_pub = Mach_msg()
    mach_pub.header.stamp = rospy.Time.now()
    mach_pub.header.frame_id = [95m'AHRS'[m
    [96m# mach_pub.timestamp = rospy.Time.now()[m
    mach_pub.motor = [95m57[m
    mach_pub.rudder = msg[[95m0[m]
    mach_pub.sail   = msg[[95m1[m]
    mach_pub.PCCtrl = msg[[95m2[m]
    [93mreturn[m mach_pub[62;187H1,1[11CTop"example3.py" 374L, 12089C[1;1HP+q436f\P+q6b75\P+q6b64\P+q6b72\P+q6b6c\P+q2332\P+q2334\P+q2569\P+q2a37\P+q6b31\[?12l[?25h[?25l[62;1H[1m-- INSERT --[m[62;13H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H8[8;1H[?12l[?25h[?25l[62;187H15,1[15;1H[?12l[?25h[?25l[62;187H22[22;1H[?12l[?25h[?25l[62;188H9[29;1H[?12l[?25h[?25l[62;187H36[36;1H[?12l[?25h[?25l[62;188H0[30;1H[?12l[?25h[?25l[62;187H23[23;1H[?12l[?25h[?25l[62;187H16[16;1H[?12l[?25h[?25l[62;187H9,1 [9;1H[?12l[?25h[?25l[62;187H2[2;1H[?12l[?25h[?25l[62;187H8[8;1H[?12l[?25h[?25l[62;187H15,1[15;1H[?12l[?25h[?25l[62;187H22[22;1H[?12l[?25h[?25l[62;188H9[29;1H[?12l[?25h[?25l[62;187H36[36;1H[?12l[?25h[?25l[62;187H43[43;1H[?12l[?25h[?25l[62;187H50[50;1H[?12l[?25h[?25l[62;188H7[57;1H[?12l[?25h[?25l[1;61r[1;1H[3M[1;62r[61;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[11C0%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hout_pub = spare_function_out()
    out_pub.rudder = msg[[95m0[m]
    out_pub.sail = msg[[95m1[m]
    out_pub.deviationA = msg[[95m2[m]
    out_pub.deviationD = msg[[95m3[m]
    out_pub.oyaw0 = msg[[95m4[m]
    out_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hout_pub.Yaw = msg[[95m6[m]
    [93mreturn[m out_pub


[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m
    para_pubmsg = spare_function_para()
    para_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hpara_pubmsg.rudderP= msg[[95m2[m]
    para_pubmsg.rudderI= msg[[95m3[m]
    para_pubmsg.rudderD= msg[[95m4[m]
    para_pubmsg.sailP  = msg[[95m5[m]
    para_pubmsg.sailI  = msg[[95m6[m]
    para_pubmsg.sailD  = msg[[95m7[m]
    [93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[11C7%[61;1H[?12l[?25h[?25l[62;187H79[55;1H[?12l[?25h[?25l[62;187H85[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[57;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m
    [93mglobal[m sensor_submsg
    sensor_submsg[[95m0[m] = msg.Roll
    sensor_submsg[[95m1[m] = msg.Yaw
    sensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hsensor_submsg[[95m3[m] = msg.TWA
    sensor_submsg[[95m4[m] = msg.Posx
    sensor_submsg[[95m5[m] = msg.Posy
    sensor_submsg[[95m6[m] = msg.ux
    sensor_submsg[[95m7[m] = msg.vy
    sensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H99,1[10C12%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m
    [93mglobal[m para_cfg
    [93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[59;9Hpara_cfg[[95m0[m] = [95m1[m
    [93melse[m:[61;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hpara_cfg[[95m1[m] = config.oyaw
    para_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m
    para_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m
    para_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m
    para_cfg[[95m5[m] = config.sailP    [96m# devD[m
    para_cfg[[95m6[m] = config.sailI    [96m# pos1x[m
    para_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mreturn[m config


[93mdef[m [1m[96mcompute_sail_angle[m(awa):
    [93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[60;9Hsail_angle = [95m0[m
    [93melse[m:[62;187H[K[62;187H120,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)
    [93mreturn[m sail_angle


[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):
    alpha = yaw + awa - pi
    [93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Halpha = alpha + [95m2[m * pi
    twa_ux = aws * math.cos(alpha) + ux
    twa_uy = aws * math.sin(alpha) + vy
    [93mif[m twa_ux > [95m0[m:[59;9Htwa0 = math.atan(twa_uy / twa_ux)
    [93melif[m twa_ux < [95m0[m:[61;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93mif[m twa0 >= pi:[56;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m
    [93melse[m:[58;9Htwa0 = pi
    [93mreturn[m twa0[62;187H[K[62;187H141,1[9C25%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m
    [93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[57;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))
    [93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[59;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[60;9H[93mif[m yaw0 >= pi:[61;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93melse[m:[56;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])
    [93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m


[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):
    angle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[56;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi
    [93mreturn[m angle_between_oyaw_twa


[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):
    [93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9Hagainst_wind = [1m[96mTrue[m
    [93melse[m:[57;9Hagainst_wind = [1m[96mFalse[m
    [93mreturn[m against_wind


[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)
    [93mreturn[m dev_distance


[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):
    [93mglobal[m Zip
    [93mglobal[m turnL[62;187H[K[62;187H176,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93mglobal[m turnR
    [93mif[m against_wind:[57;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[58;13HturnR = [95m1[m[59;13HturnL = [95m0[m[60;13HZip = [95m0[m[61;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13HturnR = [95m0[m[56;13HturnL = [95m1[m[57;13HZip = [95m0[m[58;9H[93melif[m Zip == [95m1[m:[59;13HturnR = [95m1[m[60;13HturnL = [95m0[m[61;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[57;13HturnL = [95m1[m[58;13HZip = [95m0[m[59;13HturnR = [95m0[m[60;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[61;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13HZip = [95m0[m[56;13HturnL = [95m0[m[58;9H[93mif[m turnL == [95m1[m:[59;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[60;9H[93melif[m turnR == [95m1[m:[61;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;9H[93melse[m:[56;13Hsub_oyaw0 = oyaw[58;9H[93mif[m sub_oyaw0 < [95m0[m:[59;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[60;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[61;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5H[93melse[m:[56;9HturnL = [95m0[m[57;9HturnR = [95m0[m[58;9HZip = [95m0[m[59;9Hsub_oyaw0 = oyaw
    [93mreturn[m sub_oyaw0[62;187H[K[62;187H218,1[9C50%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;1H[93mdef[m [1m[96mrudAlim[m(rudangle):
    [93mif[m rudangle >= pi/[95m6.0[m:[58;9Hrudangle = pi/[95m6.0[m
    [93mif[m rudangle <= -pi/[95m6.0[m:[60;9Hrudangle = -pi/[95m6.0[m
    [93mreturn[m rudangle[62;187H[K[62;187H225,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;1H[93mif[m __name__ == [95m"__main__"[m:
    rospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[59;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)
    spare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)
    spare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)
    config_srv = Server(spare_function_Config, getConfigCallback)[59;5Hrate = rospy.Rate([95m10[m)
    sa = [95m0.1[m
    ra = pi/[95m2[m[62;187H[K[62;187H239,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;5Hdra = [95m0.01[m
    dsa = [95m0.1[m
    [93mtry[m:[58;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[59;13H[96m# todo[m[60;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[61;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[56;13H# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[57;13H# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[58;13H# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[59;13H# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[60;13H# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[61;13H# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[57;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[58;13H[96m# TWA0 = sensor_submsg[3][m[59;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[61;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[57;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[58;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[59;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[60;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[61;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17HFlag0 = [1m[96mTrue[m[56;17H[93mif[m nub == [95m3[m:[57;21Hnub = [95m0[m[58;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[59;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][60;17H[96m# auto triangle track[61;17H# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][56;17H#  goal position[m[58;13Hoyaw0 = computeoyaw(xy)[59;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[61;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17HX0 = sensor_submsg[[95m4[m][56;17HY0 = sensor_submsg[[95m5[m][57;17Hoyaw1 = oyaw0    [96m# ***************************[m[59;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[60;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H288,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mif[m AgainstWind:[56;17HZip = [95m1[m[58;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[59;17HX0 = sensor_submsg[[95m4[m][60;17HY0 = sensor_submsg[[95m5[m][61;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[57;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[58;13H[93mif[m sub_oyaw >= pi:[59;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[60;13H[93melif[m sub_oyaw <= -pi:[61;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[57;17Hoyaw1 = oyaw0[58;17HFlag0 = [1m[96mFalse[m[60;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[61;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17HdevA = devA - [95m2[m*pi[56;13H[93melif[m devA <= -pi:[57;17HdevA = devA + [95m2[m*pi[59;13H[93mif[m - pi/[95m2.0[m <= devA <= pi/[95m2.0[m:[60;17HPer = devA[61;17HIer = Ier + devA[62;187H[K[62;187H316,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17HDer = devA - devA0[56;17H[93mif[m Ier >= [95m15.0[m:  Ier = [95m15.0[m[57;17H[93mif[m Ier <= -[95m15.0[m:  Ier = -[95m15.0[m[58;17H[96m# rudA = -(para_cfg[2] * Per + para_cfg[3] * (Ier + para_cfg[4]/para_cfg[2] * Der) + para_cfg[4] * Der)[m[59;17HrudA = -(para_cfg[[95m2[m] * Per + para_cfg[[95m3[m] * Ier + para_cfg[[95m4[m] * Der)[60;17HrudA = rudAlim(rudA)   [96m# limit the rudder's maximum angle to pi/6[m[61;17HdevA0 = devA[62;187H[K[62;187H323,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93melif[m devA > [95m0[m:[56;17HrudA = -[95m1.0[m * pi / [95m6.0[m[57;17HIer = [95m0[m[58;17HdevA0 = [95m0[m[59;13H[93melse[m:[60;17HrudA = pi / [95m6.0[m[61;17HIer = [95m0[m[62;187H[K[62;187H330,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17HdevA0 = [95m0[m[57;13Hmach_np = [para_cfg[[95m5[m], para_cfg[[95m6[m], [95m1[m][58;13H[96m# out_np = [length, TWA0*180/pi, devA*180/pi, devD, oyaw1*180/pi, sub_oyaw*180/pi, sensor_submsg[1]*180/pi][m[59;13Hsa += dsa[60;13Hra += dra[61;13H[93mif[m sa >= pi:[62;187H[K[62;187H337,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hdsa = -[95m0.05[m[56;13H[93mif[m sa <= [95m0[m:[57;17Hdsa = [95m0.05[m[58;13H[93mif[m ra >= [95m90.0[m/[95m180.0[m*pi:[59;17Hdra = -[95m0.01[m[60;13H[93mif[m ra <= [95m75.0[m/[95m180.0[m*pi:[61;17Hdra = [95m0.01[m[62;187H[K[62;187H344,1[9C90%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[57;13Hout_np = [length, AngleOytw * [95m180[m / pi, turnR, devD, turnL, sub_oyaw * [95m180[m / pi, sensor_submsg[[95m1[m] * [95m180[m / pi]  [96m# test************************************************[58;13H# out_np = [rudA*180/pi, sailA, ][59;13H# out_pub.rudder = msg[0][60;13H# out_pub.sail = msg[1][61;13H# out_pub.deviationA = msg[2][m[62;187H[K[62;187H351,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m# out_pub.deviationD = msg[3][56;13H# out_pub.oyaw0 = msg[4]            # out_pub.suboyaw0 = msg[5][57;13H# out_pub.Yaw = msg[6][58;13H# para_np = [0,0,0,0,0,0,0][59;13H#[60;13H# input : sensor_submsg [61;13H# cfg: para_cfg[m[62;187H[K[62;187H358,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m# output : mach_np out_np para_np[m[57;13Hmach_pubmsg = getOutMachPut(mach_np)[58;13Hout_pubmsg = getOutput(out_np)[59;13Hpara_pubmsg = getOutParaPut(para_cfg)[61;13Hmach_pub.publish(mach_pubmsg)[62;187H[K[62;187H365,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13Hspare_function_pub.publish(out_pubmsg)[56;13Hspare_function_para_pub.publish(para_pubmsg)[58;13Hrate.sleep()
    [93mexcept[m rospy.ROSInterruptException:[60;9H[93mpass[m
    [96m#finally:[m[62;187H[K[62;187H372,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;9H[96m#close()[m
    rospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;188H68[55;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;188H54[41;1H[?12l[?25h[?25l[62;188H47[34;1H[?12l[?25h[?25l[62;189H0[27;1H[?12l[?25h[?25l[62;188H33[20;1H[?12l[?25h[?25l[62;188H26[13;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hoyaw1 = oyaw0[2;17HFlag0 = [1m[96mFalse[m[4;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[5;13H[93mif[m devA >= pi:[6;17HdevA = devA - [95m2[m*pi[7;13H[93melif[m devA <= -pi:[62;187H[K[62;187H305,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[2;13H[93mif[m sub_oyaw >= pi:[3;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[4;13H[93melif[m sub_oyaw <= -pi:[5;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[7;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H298,1[9C94%[1;1H[?12l[?25h[?25l[62;187H304[7;1H[?12l[?25h[?25l[62;188H11[14;1H[?12l[?25h[?25l[62;189H8[21;1H[?12l[?25h[?25l[62;188H25[28;1H[?12l[?25h[?25l[62;188H32[35;1H[?12l[?25h[?25l[62;189H9[42;1H[?12l[?25h[?25l[62;188H46[49;1H[?12l[?25h[?25l[62;188H53[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;13H[96m# output : mach_np out_np para_np[m[62;187H[K[62;187H360,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13Hmach_pubmsg = getOutMachPut(mach_np)[56;13Hout_pubmsg = getOutput(out_np)[57;13Hpara_pubmsg = getOutParaPut(para_cfg)[59;13Hmach_pub.publish(mach_pubmsg)[60;13Hspare_function_pub.publish(out_pubmsg)[61;13Hspare_function_para_pub.publish(para_pubmsg)[62;187H[K[62;187H367,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;13Hrate.sleep()
    [93mexcept[m rospy.ROSInterruptException:[58;9H[93mpass[m
    [96m#finally:[60;9H#close()[m
    rospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;188H68[55;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;188H54[41;1H[?12l[?25h[?25l[62;188H47[34;1H[?12l[?25h[?25l[62;189H0[27;1H[?12l[?25h[?25l[62;188H33[20;1H[?12l[?25h[?25l[62;188H26[13;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hoyaw1 = oyaw0[2;17HFlag0 = [1m[96mFalse[m[4;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[5;13H[93mif[m devA >= pi:[6;17HdevA = devA - [95m2[m*pi[7;13H[93melif[m devA <= -pi:[62;187H[K[62;187H305,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[2;13H[93mif[m sub_oyaw >= pi:[3;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[4;13H[93melif[m sub_oyaw <= -pi:[5;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[7;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H298,1[9C94%[1;1H[?12l[?25h[?25l[62;187H304[7;1H[?12l[?25h[?25l[62;188H11[14;1H[?12l[?25h[?25l[62;189H8[21;1H[?12l[?25h[?25l[62;188H25[28;1H[?12l[?25h[?25l[62;188H32[35;1H[?12l[?25h[?25l[62;189H9[42;1H[?12l[?25h[?25l[62;188H46[49;1H[?12l[?25h[?25l[62;188H53[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;13H[96m# output : mach_np out_np para_np[m[62;187H[K[62;187H360,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13Hmach_pubmsg = getOutMachPut(mach_np)[56;13Hout_pubmsg = getOutput(out_np)[57;13Hpara_pubmsg = getOutParaPut(para_cfg)[59;13Hmach_pub.publish(mach_pubmsg)[60;13Hspare_function_pub.publish(out_pubmsg)[61;13Hspare_function_para_pub.publish(para_pubmsg)[62;187H[K[62;187H367,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;13Hrate.sleep()
    [93mexcept[m rospy.ROSInterruptException:[58;9H[93mpass[m
    [96m#finally:[60;9H#close()[m
    rospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;188H68[55;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;188H54[41;1H[?12l[?25h[?25l[62;188H47[34;1H[?12l[?25h[?25l[62;189H0[27;1H[?12l[?25h[?25l[62;188H33[20;1H[?12l[?25h[?25l[62;188H26[13;1H[?12l[?25h[?25l[62;188H32[19;1H[?12l[?25h[?25l[62;189H9[26;1H[?12l[?25h[?25l[62;188H46[33;1H[?12l[?25h[?25l[62;188H53[40;1H[?12l[?25h[?25l[62;188H47[34;1H[?12l[?25h[?25l[62;189H0[27;1H[?12l[?25h[?25l[62;188H33[20;1H[?12l[?25h[?25l[62;188H26[13;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hoyaw1 = oyaw0[2;17HFlag0 = [1m[96mFalse[m[4;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[5;13H[93mif[m devA >= pi:[6;17HdevA = devA - [95m2[m*pi[7;13H[93melif[m devA <= -pi:[62;187H[K[62;187H305,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[2;13H[93mif[m sub_oyaw >= pi:[3;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[4;13H[93melif[m sub_oyaw <= -pi:[5;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[7;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H298,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[3;17HX0 = sensor_submsg[[95m4[m][4;17HY0 = sensor_submsg[[95m5[m][5;17Hoyaw1 = oyaw0[6;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H291,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hoyaw1 = oyaw0    [96m# ***************************[m[3;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[4;13HAgainstWind = judge_whether_against_wind(AngleOytw)[6;13H[93mif[m AgainstWind:[7;17HZip = [95m1[m[62;187H[K[62;187H284,1[9C90%[1;1H[?12l[?25h[?25l[62;188H90[7;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;187H304[21;1H[?12l[?25h[?25l[62;188H11[28;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;188H25[42;1H[?12l[?25h[?25l[62;188H32[49;1H[?12l[?25h[?25l[62;189H9[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[62;187H[K[62;187H346,1[9C91%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13Hout_np = [length, AngleOytw * [95m180[m / pi, turnR, devD, turnL, sub_oyaw * [95m180[m / pi, sensor_submsg[[95m1[m] * [95m180[m / pi]  [96m# test************************************************[56;13H# out_np = [rudA*180/pi, sailA, ][57;13H# out_pub.rudder = msg[0][58;13H# out_pub.sail = msg[1][59;13H# out_pub.deviationA = msg[2][60;13H# out_pub.deviationD = msg[3][61;13H# out_pub.oyaw0 = msg[4]            # out_pub.suboyaw0 = msg[5][m[62;187H[K[62;187H353,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m# out_pub.Yaw = msg[6][56;13H# para_np = [0,0,0,0,0,0,0][57;13H#[58;13H# input : sensor_submsg [59;13H# cfg: para_cfg[60;13H# output : mach_np out_np para_np[m[62;187H[K[62;187H360,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13Hmach_pubmsg = getOutMachPut(mach_np)[56;13Hout_pubmsg = getOutput(out_np)[57;13Hpara_pubmsg = getOutParaPut(para_cfg)[59;13Hmach_pub.publish(mach_pubmsg)[60;13Hspare_function_pub.publish(out_pubmsg)[61;13Hspare_function_para_pub.publish(para_pubmsg)[62;187H[K[62;187H367,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;13Hrate.sleep()
    [93mexcept[m rospy.ROSInterruptException:[58;9H[93mpass[m
    [96m#finally:[60;9H#close()[m
    rospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;188H68[55;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;188H54[41;1H[?12l[?25h[?25l[62;188H47[34;1H[?12l[?25h[?25l[62;189H0[27;1H[?12l[?25h[?25l[62;188H33[20;1H[?12l[?25h[?25l[62;188H26[13;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[62;189H8[7;1H[?12l[?25h[?25l[62;188H25[14;1H[?12l[?25h[?25l[62;188H32[21;1H[?12l[?25h[?25l[62;189H9[28;1H[?12l[?25h[?25l[62;188H46[35;1H[?12l[?25h[?25l[62;188H53[42;1H[?12l[?25h[?25l[62;188H60[49;1H[?12l[?25h[?25l[62;189H7[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[60;9H[96m#close()[m
    rospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;188H68[55;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;188H54[41;1H[?12l[?25h[?25l[62;188H47[34;1H[?12l[?25h[?25l[62;189H0[27;1H[?12l[?25h[?25l[62;189H6[33;1H[?12l[?25h[?25l[62;188H53[40;1H[?12l[?25h[?25l[62;188H60[47;1H[?12l[?25h[?25l[62;188H54[41;1H[?12l[?25h[?25l[62;188H47[34;1H[?12l[?25h[?25l[62;189H0[27;1H[?12l[?25h[?25l[62;189H6[33;1H[?12l[?25h[?25l[62;188H53[40;1H[?12l[?25h[?25l[62;188H60[47;1H[?12l[?25h[?25l[62;189H7[54;1H[?12l[?25h[?25l[62;188H74[61;1H[?12l[?25h[?25l[62;188H68[55;1H[?12l[?25h[?25l[62;188H74[61;1H[?12l[?25h[?25l[62;188H68[55;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;188H54[41;1H[?12l[?25h[?25l[62;188H47[34;1H[?12l[?25h[?25l[62;189H0[27;1H[?12l[?25h[?25l[62;188H33[20;1H[?12l[?25h[?25l[62;188H26[13;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[1;61r[1;1H[2L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hoyaw1 = oyaw0[2;17HFlag0 = [1m[96mFalse[m[4;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[5;13H[93mif[m devA >= pi:[6;17HdevA = devA - [95m2[m*pi[7;13H[93melif[m devA <= -pi:[62;187H[K[62;187H305,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[2;13H[93mif[m sub_oyaw >= pi:[3;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[4;13H[93melif[m sub_oyaw <= -pi:[5;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[7;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H298,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[3;17HX0 = sensor_submsg[[95m4[m][4;17HY0 = sensor_submsg[[95m5[m][5;17Hoyaw1 = oyaw0[6;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H291,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;17Hoyaw1 = oyaw0    [96m# ***************************[m[3;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[4;13HAgainstWind = judge_whether_against_wind(AngleOytw)[6;13H[93mif[m AgainstWind:[7;17HZip = [95m1[m[62;187H[K[62;187H284,1[9C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;13Hoyaw0 = computeoyaw(xy)[3;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[5;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[6;17HX0 = sensor_submsg[[95m4[m][7;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H277,1[9C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;21Hnub = [95m0[m[2;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[3;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][4;17H[96m# auto triangle track[5;17H# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[6;17H# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][7;17H#  goal position[m[62;187H[K[62;187H270,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[2;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[3;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[4;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[5;17Hnub = nub + [95m1[m[6;17HFlag0 = [1m[96mTrue[m[7;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H263,1[9C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[2;13H[96m# TWA0 = sensor_submsg[3][m[3;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[5;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[6;13H# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H256,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[2;13H# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[3;13H# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[4;13H# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[5;13H# sensor_submsg[8] = msg.AWS[m[7;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H249,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5H[93mtry[m:[2;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[3;13H[96m# todo[m[4;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[5;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[6;13H# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[7;13H# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H242,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[3;5Hrate = rospy.Rate([95m10[m)
    sa = [95m0.1[m
    ra = pi/[95m2[m
    dra = [95m0.01[m
    dsa = [95m0.1[m[62;187H[K[62;187H235,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[3;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)
    spare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)
    spare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[7;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H228,1[9C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;5H[93mif[m rudangle >= pi/[95m6.0[m:[2;9Hrudangle = pi/[95m6.0[m
    [93mif[m rudangle <= -pi/[95m6.0[m:[4;9Hrudangle = -pi/[95m6.0[m
    [93mreturn[m rudangle

[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H221,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;9HturnR = [95m0[m[2;9HZip = [95m0[m[3;9Hsub_oyaw0 = oyaw
    [93mreturn[m sub_oyaw0


[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H214,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;9H[93mif[m sub_oyaw0 < [95m0[m:[3;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[4;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[5;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m
    [93melse[m:[7;9HturnL = [95m0[m[62;187H[K[62;187H207,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[2;9H[93mif[m turnL == [95m1[m:[3;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[4;9H[93melif[m turnR == [95m1[m:[5;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[6;9H[93melse[m:[7;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H200,1[9C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[7L[1;62r[1;13HturnL = [95m1[m[2;13HZip = [95m0[m[3;13HturnR = [95m0[m[4;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[5;13HturnR = [95m1[m[6;13HZip = [95m0[m[7;13HturnL = [95m0[m[62;187H[K[62;187H193,1[9C61%[1;1H[?12l[?25h[?25l[62;189H9[7;1H[?12l[?25h[?25l[62;187H206[14;1H[?12l[?25h[?25l[62;188H13[21;1H[?12l[?25h[?25l[62;188H20[28;1H[?12l[?25h[?25l[62;189H7[35;1H[?12l[?25h[?25l[62;188H34[42;1H[?12l[?25h[?25l[62;188H41[49;1H[?12l[?25h[?25l[62;189H8[56;1H[?12l[?25h[?25l[1;61r[1;1H[2M[1;62r[61;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[56;13H[96m# TWA0 = sensor_submsg[3][m[57;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[59;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[60;13H# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H262,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[56;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[57;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[58;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[59;17Hnub = nub + [95m1[m[60;17HFlag0 = [1m[96mTrue[m[61;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C66%[61;1H[?12l[?25h[?25l[62;189H3[55;1H[?12l[?25h[?25l[62;188H56[48;1H[?12l[?25h[?25l[62;188H49[41;1H[?12l[?25h[?25l[62;189H2[34;1H[?12l[?25h[?25l[62;188H35[27;1H[?12l[?25h[?25l[62;191H2[27;2H[?12l[?25h[?25l[62;191H3[27;3H[?12l[?25h[?25l[62;191H4[27;4H[?12l[?25h[?25l[62;191H5[27;5H[?12l[?25h[?25l[62;191H6[27;6H[?12l[?25h[?25l[62;191H7[27;7H[?12l[?25h[?25l[62;191H8[27;8H[?12l[?25h[?25l[62;191H9[27;9H[?12l[?25h[?25l[62;191H10[27;10H[?12l[?25h[?25l[62;192H1[27;11H[?12l[?25h[?25l[62;192H2[27;12H[?12l[?25h[?25l[62;192H3[27;13H[?12l[?25h[?25l[62;192H4[27;14H[?12l[?25h[?25l[62;189H6,1 [28;1H[?12l[?25h[?25l[62;189H7,14[29;14H[?12l[?25h[?25l[62;189H8,13[30;13H[?12l[?25h[?25l[62;192H2[30;12H[?12l[?25h[?25l[62;192H3[30;13H[?12l[?25h[?25l[30;12H[K[62;192H2[30;12H[?12l[?25h[?25l[30;11H[K[62;192H1[30;11H[?12l[?25h[?25l[30;10H[K[62;192H0[30;10H[?12l[?25h[?25lp[62;192H1[30;11H[?12l[?25h[?25li[62;192H2[30;12H[?12l[?25h[?25l/[62;192H3[30;13H[?12l[?25h[?25l[95m2[m[62;192H4[30;14H[?12l[?25h[?25l[62;189H9[31;14H[?12l[?25h[?25l[31;13H[K[62;192H3[31;13H[?12l[?25h[?25l[31;12H[K[62;192H2[31;12H[?12l[?25h[?25l[31;11H[K[62;192H1[31;11H[?12l[?25h[?25l[31;10H[K[62;192H0[31;10H[?12l[?25h[?25lp[62;192H1[31;11H[?12l[?25h[?25li[62;192H2[31;12H[?12l[?25h[?25l[62;188H45[37;12H[?12l[?25h[?25l[62;188H52[44;12H[?12l[?25h[?25l[62;189H9,1 [51;1H[?12l[?25h[?25l[62;188H66,12[58;12H[?12l[?25h[?25l[1;61r[1;1H[4M[1;62r[58;21Hnub = [95m0[m[59;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[60;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][61;17H[96m# auto triangle track[m[62;187H[K[62;187H273,12[8C67%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[56;17H# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][57;17H#  goal position[m[59;13Hoyaw0 = computeoyaw(xy)[60;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H280,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[56;17HX0 = sensor_submsg[[95m4[m][57;17HY0 = sensor_submsg[[95m5[m][58;17Hoyaw1 = oyaw0    [96m# ***************************[m[60;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[61;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,12[8C72%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[56;13H[93mif[m AgainstWind:[57;17HZip = [95m1[m[59;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[60;17HX0 = sensor_submsg[[95m4[m][61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,12[8C74%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hoyaw1 = oyaw0[56;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[58;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[59;13H[93mif[m sub_oyaw >= pi:[60;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[61;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,12[8C76%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[57;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[58;17Hoyaw1 = oyaw0[59;17HFlag0 = [1m[96mFalse[m[61;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,12[8C78%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mif[m devA >= pi:[56;17HdevA = devA - [95m2[m*pi[57;13H[93melif[m devA <= -pi:[58;17HdevA = devA + [95m2[m*pi[60;13H[93mif[m - pi/[95m2.0[m <= devA <= pi/[95m2.0[m:[61;17HPer = devA[62;187H[K[62;187H315,12[8C81%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17HIer = Ier + devA[56;17HDer = devA - devA0[57;17H[93mif[m Ier >= [95m15.0[m:  Ier = [95m15.0[m[58;17H[93mif[m Ier <= -[95m15.0[m:  Ier = -[95m15.0[m[59;17H[96m# rudA = -(para_cfg[2] * Per + para_cfg[3] * (Ier + para_cfg[4]/para_cfg[2] * Der) + para_cfg[4] * Der)[m[60;17HrudA = -(para_cfg[[95m2[m] * Per + para_cfg[[95m3[m] * Ier + para_cfg[[95m4[m] * Der)[61;17HrudA = rudAlim(rudA)   [96m# limit the rudder's maximum angle to pi/6[m[62;187H[K[62;187H322,12[8C83%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17HdevA0 = devA[56;13H[93melif[m devA > [95m0[m:[57;17HrudA = -[95m1.0[m * pi / [95m6.0[m[58;17HIer = [95m0[m[59;17HdevA0 = [95m0[m[60;13H[93melse[m:[61;17HrudA = pi / [95m6.0[m[62;187H[K[62;187H329,12[8C85%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17HIer = [95m0[m[56;17HdevA0 = [95m0[m[58;13Hmach_np = [para_cfg[[95m5[m], para_cfg[[95m6[m], [95m1[m][59;13H[96m# out_np = [length, TWA0*180/pi, devA*180/pi, devD, oyaw1*180/pi, sub_oyaw*180/pi, sensor_submsg[1]*180/pi][m[60;13Hsa += dsa[61;13Hra += dra[62;187H[K[62;187H336,12[8C87%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[93mif[m sa >= pi:[56;17Hdsa = -[95m0.05[m[57;13H[93mif[m sa <= [95m0[m:[58;17Hdsa = [95m0.05[m[59;13H[93mif[m ra >= [95m90.0[m/[95m180.0[m*pi:[60;17Hdra = -[95m0.01[m[61;13H[93mif[m ra <= [95m75.0[m/[95m180.0[m*pi:[62;187H[K[62;187H343,5-12      90%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;17Hdra = [95m0.01[m[58;13Hout_np = [length, AngleOytw * [95m180[m / pi, turnR, devD, turnL, sub_oyaw * [95m180[m / pi, sensor_submsg[[95m1[m] * [95m180[m / pi]  [96m# test************************************************[59;13H# out_np = [rudA*180/pi, sailA, ][60;13H# out_pub.rudder = msg[0][61;13H# out_pub.sail = msg[1][m[62;187H[K[62;187H350,12[8C92%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m# out_pub.deviationA = msg[2][56;13H# out_pub.deviationD = msg[3][57;13H# out_pub.oyaw0 = msg[4]            # out_pub.suboyaw0 = msg[5][58;13H# out_pub.Yaw = msg[6][59;13H# para_np = [0,0,0,0,0,0,0][60;13H#[61;13H# input : sensor_submsg [m[62;187H[K[62;187H357,12[8C94%[61;12H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13H[96m# cfg: para_cfg[56;13H# output : mach_np out_np para_np[m[58;13Hmach_pubmsg = getOutMachPut(mach_np)[59;13Hout_pubmsg = getOutput(out_np)[60;13Hpara_pubmsg = getOutParaPut(para_cfg)[62;187H[K[62;187H364,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[1;1H[7M[1;62r[55;13Hmach_pub.publish(mach_pubmsg)[56;13Hspare_function_pub.publish(out_pubmsg)[57;13Hspare_function_para_pub.publish(para_pubmsg)[59;13Hrate.sleep()
    [93mexcept[m rospy.ROSInterruptException:[61;9H[93mpass[m[62;187H[K[62;187H371,12[8C99%[61;12H[?12l[?25h[?25l[1;61r[1;1H[3M[1;62r[59;5H[96m#finally:[60;9H#close()[m
    rospy.spin()[62;187H[K[62;187H374,12[8CBot[61;12H[?12l[?25h[?25l[62;188H68,1 [55;1H[?12l[?25h[?25l[62;189H1,12[48;12H[?12l[?25h[?25l[62;188H54[41;12H[?12l[?25h[?25l[62;188H47,5-12[34;12H[?12l[?25h[?25l[62;189H0,6-9 [27;9H[?12l[?25h[?25l[62;188H33,12 [20;12H[?12l[?25h[?25l[62;189H9[26;12H[?12l[?25h[?25l[62;188H46,5-12[33;12H[?12l[?25h[?25l[62;188H53,12  [40;12H[?12l[?25h[?25l[62;188H60,1 [47;1H[?12l[?25h[?25l[62;189H7,12[54;12H[?12l[?25h[?25l[62;188H74[61;12H[?12l[?25h[62;1H[K[61;11H[?25l[62;187H374,11[8CBot[61;11H[?12l[?25h[?25l[62;187H[K[62;1H:[?12l[?25hw[?25l[?12l[?25hq[?25l[?12l[?25h[?25l"example3.py" 374L, 12088C written
[?1l>[?12l[?25h[?1049l]0;sjtu151@sjtu151-desktop: ~/sailboat-ws/src/Sailboat-Ros/Class/spare_function/scripts[01;32msjtu151@sjtu151-desktop[00m:[01;34m~/sailboat-ws/src/Sailboat-Ros/Class/spare_function/scripts[00m$ vim example3.py [3@python[C[C[C[C[C[C[C[C[C[C[C[C[C
^C]0;sjtu151@sjtu151-desktop: ~/sailboat-ws/src/Sailboat-Ros/Class/spare_function/scripts[01;32msjtu151@sjtu151-desktop[00m:[01;34m~/sailboat-ws/src/Sailboat-Ros/Class/spare_function/scripts[00m$ e[Kvim example3.py 
[?1049h[?1h=[2;1Hâ–½[6n[2;1H  [1;1H]11;?[1;62r[?12;25h[?12l[?25h[27m[23m[m[H[2J[?25l[62;1H"example3.py" 374L, 12088C[>c[1;1H[34m#!/usr/bin/env python[m
[35mimport[m rospy
[35mfrom[m sailboat_message.msg [35mimport[m Sensor_msg
[35mfrom[m sailboat_message.msg [35mimport[m Mach_msg

[35mfrom[m spare_function.cfg [35mimport[m spare_function_Config
[35mfrom[m spare_function.msg [35mimport[m spare_function_out
[35mfrom[m spare_function.msg [35mimport[m spare_function_para

[35mfrom[m dynamic_reconfigure.server [35mimport[m Server

[35mimport[m math

pi = [31m3.14159[m

sensor_submsg = [[31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m, [31m0.0[m]
para_cfg = [[31m0[m, [31m0[m, [31m0[m, [31m0[m, [31m0[m, [31m0[m, [31m0[m, [31m0[m]
rudA = [31m0.0[m
sailA = [31m0.0[m
X0 = -[31m1.0[m
Y0 = -[31m3.0[m
oyaw0 = [31m1.0[m
oyaw1 = oyaw0
sub_oyaw = [31m190.0[m

devA = [31m0.0[m
devA0 = [31m0.0[m

Per = [31m0.0[m
Ier = [31m0.0[m
Der = [31m0.0[m

TWA0 = [31m1.0[m
Zip = [31m1[m
turnL = [31m0[m
turnR = [31m0[m
Flag0 = [36mFalse[m

devD0 = [31m0.0[m

gox = [31m0.1[m
goy = [31m0.1[m

nub = [31m0[m
track = [[31m20[m, -[31m10[m, -[31m30[m, [31m0[m, [31m0[m, [31m20[m]  [34m# [x0, y0, x1, y1, x2, y2][m

AgainstWind = [36mFalse[m
AgainstWind0 = [36mFalse[m

count = [31m0[m

[38;5;130mdef[m [36mgetOutMachPut[m(msg):  [34m# sailboat_message::Mach_msg[m
    mach_pub = Mach_msg()
    mach_pub.header.stamp = rospy.Time.now()
    mach_pub.header.frame_id = [31m'AHRS'[m
    [34m# mach_pub.timestamp = rospy.Time.now()[m
    mach_pub.motor = [31m57[m
    mach_pub.rudder = msg[[31m0[m]
    mach_pub.sail   = msg[[31m1[m]
    mach_pub.PCCtrl = msg[[31m2[m]
    [38;5;130mreturn[m mach_pub[62;187H1,1[11CTop[1;1H[?12l[?25h[27m[23m[m[H[2J[?25l[1;1H[96m#!/usr/bin/env python[m
[38;5;81mimport[m rospy
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Sensor_msg
[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg

[38;5;81mfrom[m spare_function.cfg [38;5;81mimport[m spare_function_Config
[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_out
[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_para

[38;5;81mfrom[m dynamic_reconfigure.server [38;5;81mimport[m Server

[38;5;81mimport[m math

pi = [95m3.14159[m

sensor_submsg = [[95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m]
para_cfg = [[95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m]
rudA = [95m0.0[m
sailA = [95m0.0[m
X0 = -[95m1.0[m
Y0 = -[95m3.0[m
oyaw0 = [95m1.0[m
oyaw1 = oyaw0
sub_oyaw = [95m190.0[m

devA = [95m0.0[m
devA0 = [95m0.0[m

Per = [95m0.0[m
Ier = [95m0.0[m
Der = [95m0.0[m

TWA0 = [95m1.0[m
Zip = [95m1[m
turnL = [95m0[m
turnR = [95m0[m
Flag0 = [1m[96mFalse[m

devD0 = [95m0.0[m

gox = [95m0.1[m
goy = [95m0.1[m

nub = [95m0[m
track = [[95m20[m, -[95m10[m, -[95m30[m, [95m0[m, [95m0[m, [95m20[m]  [96m# [x0, y0, x1, y1, x2, y2][m

AgainstWind = [1m[96mFalse[m
AgainstWind0 = [1m[96mFalse[m

count = [95m0[m

[93mdef[m [1m[96mgetOutMachPut[m(msg):  [96m# sailboat_message::Mach_msg[m
    mach_pub = Mach_msg()
    mach_pub.header.stamp = rospy.Time.now()
    mach_pub.header.frame_id = [95m'AHRS'[m
    [96m# mach_pub.timestamp = rospy.Time.now()[m
    mach_pub.motor = [95m57[m
    mach_pub.rudder = msg[[95m0[m]
    mach_pub.sail   = msg[[95m1[m]
    mach_pub.PCCtrl = msg[[95m2[m]
    [93mreturn[m mach_pub[62;187H1,1[11CTop"example3.py" 374L, 12088C[1;1HP+q436f\P+q6b75\P+q6b64\P+q6b72\P+q6b6c\P+q2332\P+q2334\P+q2569\P+q2a37\P+q6b31\[?12l[?25h[?25l[62;187H2[2;1H[?12l[?25h[?25l[62;187H3[3;1H[?12l[?25h[?25l[62;187H4[4;1H[?12l[?25h[?25l[62;187H5,0-1[5;1H[?12l[?25h[?25l[62;187H6,1  [6;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H8[8;1H[?12l[?25h[?25l[62;187H9,0-1[9;1H[?12l[?25h[?25l[62;187H10,1 [10;1H[?12l[?25h[?25l[62;188H1,0-1[11;1H[?12l[?25h[?25l[62;188H2,1  [12;1H[?12l[?25h[?25l[62;188H3,0-1[13;1H[?12l[?25h[?25l[62;188H4,1  [14;1H[?12l[?25h[?25l[62;188H5,0-1[15;1H[?12l[?25h[?25l[62;188H6,1  [16;1H[?12l[?25h[?25l[62;188H7[17;1H[?12l[?25h[?25l[62;188H8[18;1H[?12l[?25h[?25l[62;188H9[19;1H[?12l[?25h[?25l[62;187H20[20;1H[?12l[?25h[?25l[62;188H1[21;1H[?12l[?25h[?25l[62;188H2[22;1H[?12l[?25h[?25l[62;188H3[23;1H[?12l[?25h[?25l[62;188H4[24;1H[?12l[?25h[?25l[62;188H5,0-1[25;1H[?12l[?25h[?25l[62;188H6,1  [26;1H[?12l[?25h[?25l[62;188H7[27;1H[?12l[?25h[?25l[62;188H8,0-1[28;1H[?12l[?25h[?25l[62;188H9,1  [29;1H[?12l[?25h[?25l[62;187H30[30;1H[?12l[?25h[?25l[62;188H1[31;1H[?12l[?25h[?25l[62;188H2,0-1[32;1H[?12l[?25h[?25l[62;188H3,1  [33;1H[?12l[?25h[?25l[62;188H4[34;1H[?12l[?25h[?25l[62;188H5[35;1H[?12l[?25h[?25l[62;188H6[36;1H[?12l[?25h[?25l[62;188H7[37;1H[?12l[?25h[?25l[62;188H8,0-1[38;1H[?12l[?25h[?25l[62;188H9,1  [39;1H[?12l[?25h[?25l[62;187H40,0-1[40;1H[?12l[?25h[?25l[62;188H1,1  [41;1H[?12l[?25h[?25l[62;188H2[42;1H[?12l[?25h[?25l[62;188H3,0-1[43;1H[?12l[?25h[?25l[62;188H4,1  [44;1H[?12l[?25h[?25l[62;188H5[45;1H[?12l[?25h[?25l[62;188H6,0-1[46;1H[?12l[?25h[?25l[62;188H7,1  [47;1H[?12l[?25h[?25l[62;188H8[48;1H[?12l[?25h[?25l[62;188H9,0-1[49;1H[?12l[?25h[?25l[62;187H50,1  [50;1H[?12l[?25h[?25l[62;188H1,0-1[51;1H[?12l[?25h[?25l[62;188H2,1  [52;1H[?12l[?25h[?25l[62;188H3[53;1H[?12l[?25h[?25l[62;188H4[54;1H[?12l[?25h[?25l[62;188H5[55;1H[?12l[?25h[?25l[62;188H6[56;1H[?12l[?25h[?25l[62;188H7[57;1H[?12l[?25h[?25l[62;188H8[58;1H[?12l[?25h[?25l[62;188H9[59;1H[?12l[?25h[?25l[62;187H60[60;1H[?12l[?25h[?25l[62;188H1[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;1H[K[62;187H62,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H63,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[11C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H74,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H75,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H86,0-1[9C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H87,0-1[9C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H99,0-1[8C12%[61;1H[?12l[?25h[?25l[62;188H8,1  [60;1H[?12l[?25h[?25l[62;188H7[59;1H[?12l[?25h[?25l[62;188H6[58;1H[?12l[?25h[?25l[62;188H5[57;1H[?12l[?25h[?25l[62;188H4[56;1H[?12l[?25h[?25l[62;188H3[55;1H[?12l[?25h[?25l[62;188H2[54;1H[?12l[?25h[?25l[62;188H1[53;1H[?12l[?25h[?25l[62;188H0[52;1H[?12l[?25h[?25l[62;187H89[51;1H[?12l[?25h[?25l[62;188H8[50;1H[?12l[?25h[?25l[62;188H7,0-1[49;1H[?12l[?25h[?25l[62;188H6[48;1H[?12l[?25h[?25l[62;188H5,1  [47;1H[?12l[?25h[?25l[62;188H4[46;1H[?12l[?25h[?25l[62;188H3[45;1H[?12l[?25h[?25l[62;188H2[44;1H[?12l[?25h[?25l[62;188H1[43;1H[?12l[?25h[?25l[62;188H0[42;1H[?12l[?25h[?25l[62;187H79[41;1H[?12l[?25h[?25l[62;188H8[40;1H[?12l[?25h[?25l[62;188H7[39;1H[?12l[?25h[?25l[62;188H6[38;1H[?12l[?25h[?25l[62;188H5,0-1[37;1H[?12l[?25h[?25l[62;188H4[36;1H[?12l[?25h[?25l[62;188H3,1  [35;1H[?12l[?25h[?25l[62;188H2[34;1H[?12l[?25h[?25l[62;188H1[33;1H[?12l[?25h[?25l[62;188H0[32;1H[?12l[?25h[?25l[62;187H69[31;1H[?12l[?25h[?25l[62;188H8[30;1H[?12l[?25h[?25l[62;188H7[29;1H[?12l[?25h[?25l[62;188H6[28;1H[?12l[?25h[?25l[62;188H5[27;1H[?12l[?25h[?25l[62;188H4[26;1H[?12l[?25h[?25l[62;188H3,0-1[25;1H[?12l[?25h[?25l[62;188H2[24;1H[?12l[?25h[?25l[62;188H1,1  [23;1H[?12l[?25h[?25l[62;188H0[22;1H[?12l[?25h[?25l[62;187H59[21;1H[?12l[?25h[?25l[62;188H8[20;1H[?12l[?25h[?25l[62;188H7[19;1H[?12l[?25h[?25l[62;188H6[18;1H[?12l[?25h[?25l[62;188H5[17;1H[?12l[?25h[?25l[62;188H4[16;1H[?12l[?25h[?25l[62;188H3[15;1H[?12l[?25h[?25l[62;188H2[14;1H[?12l[?25h[?25l[62;188H1,0-1[13;1H[?12l[?25h[?25l[62;188H0,1  [12;1H[?12l[?25h[?25l[62;187H49,0-1[11;1H[?12l[?25h[?25l[62;188H8,1  [10;1H[?12l[?25h[?25l[62;188H7[9;1H[?12l[?25h[?25l[62;188H6,0-1[8;1H[?12l[?25h[?25l[62;188H5,1  [7;1H[?12l[?25h[?25l[62;188H4[6;1H[?12l[?25h[?25l[62;188H3,0-1[5;1H[?12l[?25h[?25l[62;188H2,1  [4;1H[?12l[?25h[?25l[62;188H1[3;1H[?12l[?25h[?25l[62;188H0,0-1[2;1H[?12l[?25h[?25l[62;187H39,1  [1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H38,0-1[8C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H37,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnR = [95m0[m[62;187H[K[62;187H36,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnL = [95m0[m[62;187H[K[62;187H35,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HZip = [95m1[m[62;187H[K[62;187H34,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HTWA0 = [95m1.0[m[62;187H[K[62;187H33,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H32,0-1[9C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HDer = [95m0.0[m[62;187H[K[62;187H31,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HIer = [95m0.0[m[62;187H[K[62;187H30,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HPer = [95m0.0[m[62;187H[K[62;187H29,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H28,0-1[9C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA0 = [95m0.0[m[62;187H[K[62;187H27,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA = [95m0.0[m[62;187H[K[62;187H26,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H25,0-1[9C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsub_oyaw = [95m190.0[m[62;187H[K[62;187H24,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw1 = oyaw0[62;187H[K[62;187H23,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw0 = [95m1.0[m[62;187H[K[62;187H22,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HY0 = -[95m3.0[m[62;187H[K[62;187H21,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HX0 = -[95m1.0[m[62;187H[K[62;187H20,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HsailA = [95m0.0[m[62;187H[K[62;187H19,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HrudA = [95m0.0[m[62;187H[K[62;187H18,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpara_cfg = [[95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m][62;187H[K[62;187H17,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsensor_submsg = [[95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m][62;187H[K[62;187H16,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H15,0-1[9C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpi = [95m3.14159[m[62;187H[K[62;187H14,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H13,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m math[62;187H[K[62;187H12,1[11C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H11,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m dynamic_reconfigure.server [38;5;81mimport[m Server[62;187H[K[62;187H10,1[11C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H9,0-1[10C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_para[62;187H[K[62;187H8,1[12C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_out[62;187H[K[62;187H7,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.cfg [38;5;81mimport[m spare_function_Config[62;187H[K[62;187H6,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H5,0-1[10C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg[62;187H[K[62;187H4,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Sensor_msg[62;187H[K[62;187H3,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m rospy[62;187H[K[62;187H2,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[96m#!/usr/bin/env python[m[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H2[2;1H[?12l[?25h[?25l[62;187H3[3;1H[?12l[?25h[?25l[62;187H4[4;1H[?12l[?25h[?25l[62;187H5,0-1[5;1H[?12l[?25h[?25l[62;187H6,1  [6;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H8[8;1H[?12l[?25h[?25l[62;187H9,0-1[9;1H[?12l[?25h[?25l[62;187H10,1 [10;1H[?12l[?25h[?25l[62;188H1,0-1[11;1H[?12l[?25h[?25l[62;188H2,1  [12;1H[?12l[?25h[?25l[62;188H3,0-1[13;1H[?12l[?25h[?25l[62;188H4,1  [14;1H[?12l[?25h[?25l[62;188H5,0-1[15;1H[?12l[?25h[?25l[62;188H6,1  [16;1H[?12l[?25h[?25l[62;188H7[17;1H[?12l[?25h[?25l[62;188H8[18;1H[?12l[?25h[?25l[62;188H9[19;1H[?12l[?25h[?25l[62;187H20[20;1H[?12l[?25h[?25l[62;188H1[21;1H[?12l[?25h[?25l[62;188H2[22;1H[?12l[?25h[?25l[62;188H3[23;1H[?12l[?25h[?25l[62;188H4[24;1H[?12l[?25h[?25l[62;188H5,0-1[25;1H[?12l[?25h[?25l[62;188H6,1  [26;1H[?12l[?25h[?25l[62;188H7[27;1H[?12l[?25h[?25l[62;188H8,0-1[28;1H[?12l[?25h[?25l[62;188H9,1  [29;1H[?12l[?25h[?25l[62;187H30[30;1H[?12l[?25h[?25l[62;188H1[31;1H[?12l[?25h[?25l[62;188H2,0-1[32;1H[?12l[?25h[?25l[62;188H3,1  [33;1H[?12l[?25h[?25l[62;188H4[34;1H[?12l[?25h[?25l[62;188H5[35;1H[?12l[?25h[?25l[62;188H6[36;1H[?12l[?25h[?25l[62;188H7[37;1H[?12l[?25h[?25l[62;188H8,0-1[38;1H[?12l[?25h[?25l[62;188H9,1  [39;1H[?12l[?25h[?25l[62;187H40,0-1[40;1H[?12l[?25h[?25l[62;188H1,1  [41;1H[?12l[?25h[?25l[62;188H2[42;1H[?12l[?25h[?25l[62;188H3,0-1[43;1H[?12l[?25h[?25l[62;188H4,1  [44;1H[?12l[?25h[?25l[62;188H5[45;1H[?12l[?25h[?25l[62;188H6,0-1[46;1H[?12l[?25h[?25l[62;188H7,1  [47;1H[?12l[?25h[?25l[62;188H8[48;1H[?12l[?25h[?25l[62;188H9,0-1[49;1H[?12l[?25h[?25l[62;187H50,1  [50;1H[?12l[?25h[?25l[62;188H1,0-1[51;1H[?12l[?25h[?25l[62;188H2,1  [52;1H[?12l[?25h[?25l[62;188H3[53;1H[?12l[?25h[?25l[62;188H4[54;1H[?12l[?25h[?25l[62;188H5[55;1H[?12l[?25h[?25l[62;188H6[56;1H[?12l[?25h[?25l[62;188H7[57;1H[?12l[?25h[?25l[62;188H8[58;1H[?12l[?25h[?25l[62;188H9[59;1H[?12l[?25h[?25l[62;187H60[60;1H[?12l[?25h[?25l[62;188H1[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H62,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H63,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[11C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H74,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H75,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H86,0-1[9C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H87,0-1[9C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H99,0-1[8C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H100,0-1[7C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m[62;187H[K[62;187H101,1[9C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m para_cfg[62;187H[K[62;187H102,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[62;187H[K[62;187H103,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m1[m[62;187H[K[62;187H104,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H105,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m1[m] = config.oyaw[62;187H[K[62;187H107,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m[62;187H[K[62;187H108,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m[62;187H[K[62;187H109,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m[62;187H[K[62;187H110,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m5[m] = config.sailP    [96m# devD[m[62;187H[K[62;187H111,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m6[m] = config.sailI    [96m# pos1x[m[62;187H[K[62;187H112,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m config[62;187H[K[62;187H114,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H115,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H116,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sail_angle[m(awa):[62;187H[K[62;187H117,1[9C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[62;187H[K[62;187H118,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = [95m0[m[62;187H[K[62;187H119,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H120,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)[62;187H[K[62;187H121,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sail_angle[62;187H[K[62;187H122,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H123,0-1[7C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H124,0-1[7C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):[62;187H[K[62;187H125,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Halpha = yaw + awa - pi[62;187H[K[62;187H126,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Halpha = alpha + [95m2[m * pi[62;187H[K[62;187H128,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_ux = aws * math.cos(alpha) + ux[62;187H[K[62;187H129,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_uy = aws * math.sin(alpha) + vy[62;187H[K[62;187H130,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m twa_ux > [95m0[m:[62;187H[K[62;187H131,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux)[62;187H[K[62;187H132,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m twa_ux < [95m0[m:[62;187H[K[62;187H133,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m twa0 >= pi:[62;187H[K[62;187H135,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m[62;187H[K[62;187H136,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H137,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = pi[62;187H[K[62;187H138,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m twa0[62;187H[K[62;187H139,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H140,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H141,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m[62;187H[K[62;187H142,1[9C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[62;187H[K[62;187H143,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))[62;187H[K[62;187H144,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[62;187H[K[62;187H145,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[62;187H[K[62;187H146,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m yaw0 >= pi:[62;187H[K[62;187H147,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H149,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])[62;187H[K[62;187H150,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m[62;187H[K[62;187H151,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H152,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H153,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):[62;187H[K[62;187H154,1[9C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hangle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[62;187H[K[62;187H156,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi[62;187H[K[62;187H157,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m angle_between_oyaw_twa[62;187H[K[62;187H158,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H159,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H160,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):[62;187H[K[62;187H161,1[9C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mTrue[m[62;187H[K[62;187H163,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H164,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mFalse[m[62;187H[K[62;187H165,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m against_wind[62;187H[K[62;187H166,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H167,0-1[7C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H168,0-1[7C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)[62;187H[K[62;187H170,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m dev_distance[62;187H[K[62;187H171,1[9C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H172,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H173,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):[62;187H[K[62;187H174,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m Zip[62;187H[K[62;187H175,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnL[62;187H[K[62;187H176,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnR[62;187H[K[62;187H177,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m against_wind:[62;187H[K[62;187H178,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H179,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H180,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H181,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H182,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H184,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H185,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H186,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m Zip == [95m1[m:[62;187H[K[62;187H187,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H188,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H189,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H191,0-1[7C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[62;187H[K[62;187H192,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H193,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H194,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H195,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[62;187H[K[62;187H196,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H198,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H199,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H200,0-1[7C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m turnL == [95m1[m:[62;187H[K[62;187H201,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[62;187H[K[62;187H202,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m turnR == [95m1[m:[62;187H[K[62;187H203,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melse[m:[62;187H[K[62;187H205,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H206,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H207,0-1[7C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m sub_oyaw0 < [95m0[m:[62;187H[K[62;187H208,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[62;187H[K[62;187H209,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[62;187H[K[62;187H210,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H212,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnL = [95m0[m[62;187H[K[62;187H213,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnR = [95m0[m[62;187H[K[62;187H214,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HZip = [95m0[m[62;187H[K[62;187H215,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsub_oyaw0 = oyaw[62;187H[K[62;187H216,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sub_oyaw0[62;187H[K[62;187H217,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H218,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H219,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H220,1[9C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle >= pi/[95m6.0[m:[62;187H[K[62;187H221,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = pi/[95m6.0[m[62;187H[K[62;187H222,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle <= -pi/[95m6.0[m:[62;187H[K[62;187H223,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = -pi/[95m6.0[m[62;187H[K[62;187H224,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m rudangle[62;187H[K[62;187H225,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H226,0-1[7C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H227,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[62;187H[K[62;187H228,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H229,0-1[7C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)[62;187H[K[62;187H230,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)[62;187H[K[62;187H231,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H233,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H234,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[62;187H[K[62;187H235,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H236,0-1[7C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrate = rospy.Rate([95m10[m)[62;187H[K[62;187H237,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsa = pi/[95m2[m[62;187H[K[62;187H238,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hra = pi[62;187H[K[62;187H239,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdra = [95m0.01[m[62;187H[K[62;187H240,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdsa = [95m0.1[m[62;187H[K[62;187H241,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mtry[m:[62;187H[K[62;187H242,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[62;187H[K[62;187H243,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# todo[m[62;187H[K[62;187H244,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[62;187H[K[62;187H245,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[m[62;187H[K[62;187H247,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H248,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[m[62;187H[K[62;187H249,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[m[62;187H[K[62;187H250,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[m[62;187H[K[62;187H251,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[m[62;187H[K[62;187H252,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H254,0-1[7C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[62;187H[K[62;187H256,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# TWA0 = sensor_submsg[3][m[62;187H[K[62;187H257,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[62;187H[K[62;187H258,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H259,0-1[7C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H261,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H262,0-1[7C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H263,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[62;187H[K[62;187H264,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[62;187H[K[62;187H265,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[62;187H[K[62;187H266,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mTrue[m[62;187H[K[62;187H268,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;21Hnub = [95m0[m[62;187H[K[62;187H270,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H271,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][62;187H[K[62;187H272,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# auto triangle track[m[62;187H[K[62;187H273,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][m[62;187H[K[62;187H275,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m#  goal position[m[62;187H[K[62;187H276,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H277,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hoyaw0 = computeoyaw(xy)[62;187H[K[62;187H278,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H279,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H280,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H282,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H283,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0    [96m# ***************************[m[62;187H[K[62;187H284,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H285,0-1[7C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[62;187H[K[62;187H286,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H288,0-1[7C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind:[62;187H[K[62;187H289,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HZip = [95m1[m[62;187H[K[62;187H290,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H291,0-1[7C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[62;187H[K[62;187H292,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H293,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H296,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H297,0-1[7C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[62;187H[K[62;187H298,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sub_oyaw >= pi:[62;187H[K[62;187H299,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[62;187H[K[62;187H300,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H303,0-1[7C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H304,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H305,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H306,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H307,0-1[7C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA - [95m2[m*pi[62;187H[K[62;187H310,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA <= -pi:[62;187H[K[62;187H311,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H313,0-1[7C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m - pi/[95m2.0[m <= devA <= pi/[95m2.0[m:[62;187H[K[62;187H314,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HPer = devA[62;187H[K[62;187H315,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = Ier + devA[62;187H[K[62;187H316,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HDer = devA - devA0[62;187H[K[62;187H317,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier >= [95m15.0[m:  Ier = [95m15.0[m[62;187H[K[62;187H318,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier <= -[95m15.0[m:  Ier = -[95m15.0[m[62;187H[K[62;187H319,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# rudA = -(para_cfg[2] * Per + para_cfg[3] * (Ier + para_cfg[4]/para_cfg[2] * Der) + para_cfg[4] * Der)[m[62;187H[K[62;187H320,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -(para_cfg[[95m2[m] * Per + para_cfg[[95m3[m] * Ier + para_cfg[[95m4[m] * Der)[62;187H[K[62;187H321,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = rudAlim(rudA)   [96m# limit the rudder's maximum angle to pi/6[m[62;187H[K[62;187H322,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = devA[62;187H[K[62;187H323,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA > [95m0[m:[62;187H[K[62;187H324,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -[95m1.0[m * pi / [95m6.0[m[62;187H[K[62;187H325,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H326,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H327,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melse[m:[62;187H[K[62;187H328,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = pi / [95m6.0[m[62;187H[K[62;187H329,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H330,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H331,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H332,0-1[7C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_np = [para_cfg[[95m5[m], para_cfg[[95m6[m], [95m1[m][62;187H[K[62;187H333,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [length, TWA0*180/pi, devA*180/pi, devD, oyaw1*180/pi, sub_oyaw*180/pi, sensor_submsg[1]*180/pi][m[62;187H[K[62;187H334,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsa += dsa[62;187H[K[62;187H335,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hra += dra[62;187H[K[62;187H336,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa >= pi:[62;187H[K[62;187H337,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = -[95m0.05[m[62;187H[K[62;187H338,1-8[7C88%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa <= [95m0[m:[62;187H[K[62;187H339,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = [95m0.05[m[62;187H[K[62;187H340,1[9C89%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra >= [95m90.0[m/[95m180.0[m*pi:[62;187H[K[62;187H341,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = -[95m0.01[m[62;187H[K[62;187H342,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra <= [95m75.0[m/[95m180.0[m*pi:[62;187H[K[62;187H343,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = [95m0.01[m[62;187H[K[62;187H344,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H345,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H346,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_np = [length, AngleOytw * [95m180[m / pi, turnR, devD, turnL, sub_oyaw * [95m180[m / pi, sensor_submsg[[95m1[m] * [95m180[m / pi]  [96m# test************************************************[m[62;187H[K[62;187H347,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [rudA*180/pi, sailA, ][m[62;187H[K[62;187H348,1[9C91%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.rudder = msg[0][m[62;187H[K[62;187H349,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.sail = msg[1][m[62;187H[K[62;187H350,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationA = msg[2][m[62;187H[K[62;187H351,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationD = msg[3][m[62;187H[K[62;187H352,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.oyaw0 = msg[4]            # out_pub.suboyaw0 = msg[5][m[62;187H[K[62;187H353,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.Yaw = msg[6][m[62;187H[K[62;187H354,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# para_np = [0,0,0,0,0,0,0][m[62;187H[K[62;187H355,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m#[m[62;187H[K[62;187H356,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# input : sensor_submsg [m[62;187H[K[62;187H357,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# cfg: para_cfg[m[62;187H[K[62;187H358,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# output : mach_np out_np para_np[m[62;187H[K[62;187H359,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H360,0-1[7C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pubmsg = getOutMachPut(mach_np)[62;187H[K[62;187H361,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_pubmsg = getOutput(out_np)[62;187H[K[62;187H362,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hpara_pubmsg = getOutParaPut(para_cfg)[62;187H[K[62;187H363,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H364,0-1[7C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pub.publish(mach_pubmsg)[62;187H[K[62;187H365,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_pub.publish(out_pubmsg)[62;187H[K[62;187H366,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_para_pub.publish(para_pubmsg)[62;187H[K[62;187H367,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H368,0-1[7C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hrate.sleep()[62;187H[K[62;187H369,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mexcept[m rospy.ROSInterruptException:[62;187H[K[62;187H370,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mpass[m[62;187H[K[62;187H371,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[96m#finally:[m[62;187H[K[62;187H372,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[96m#close()[m[62;187H[K[62;187H373,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;189H3[60;1H[?12l[?25h[?25l[62;189H2[59;1H[?12l[?25h[?25l[62;189H1[58;1H[?12l[?25h[?25l[62;189H0[57;1H[?12l[?25h[?25l[62;188H69[56;1H[?12l[?25h[?25l[62;189H8,0-1[55;1H[?12l[?25h[?25l[62;189H7,1  [54;1H[?12l[?25h[?25l[62;189H6[53;1H[?12l[?25h[?25l[62;189H5[52;1H[?12l[?25h[?25l[62;189H4,0-1[51;1H[?12l[?25h[?25l[62;189H3,1  [50;1H[?12l[?25h[?25l[62;189H2[49;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;189H0,0-1[47;1H[?12l[?25h[?25l[62;188H59,1  [46;1H[?12l[?25h[?25l[62;189H8[45;1H[?12l[?25h[?25l[62;189H7[44;1H[?12l[?25h[?25l[62;189H6[43;1H[?12l[?25h[?25l[62;189H5[42;1H[?12l[?25h[?25l[62;189H4[41;1H[?12l[?25h[?25l[62;189H3[40;1H[?12l[?25h[?25l[62;189H2[39;1H[?12l[?25h[?25l[62;189H1[38;1H[?12l[?25h[?25l[62;189H0[37;1H[?12l[?25h[?25l[62;188H49[36;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;189H7,1-8[34;8H[?12l[?25h[?25l[62;189H6[33;8H[?12l[?25h[?25l[62;189H5[32;8H[?12l[?25h[?25l[62;189H4[31;8H[?12l[?25h[?25l[62;189H3[30;8H[?12l[?25h[?25l[62;189H2[29;8H[?12l[?25h[?25l[62;189H1[28;8H[?12l[?25h[?25l[62;189H0,1  [27;1H[?12l[?25h[?25l[62;188H39[26;1H[?12l[?25h[?25l[62;189H8,1-8[25;8H[?12l[?25h[?25l[62;189H7,1  [24;1H[?12l[?25h[?25l[62;189H6[23;1H[?12l[?25h[?25l[62;189H5[22;1H[?12l[?25h[?25l[62;189H4[21;1H[?12l[?25h[?25l[62;189H3[20;1H[?12l[?25h[?25l[62;189H2,0-1[19;1H[?12l[?25h[?25l[62;189H1,1  [18;1H[?12l[?25h[?25l[62;189H0[17;1H[?12l[?25h[?25l[62;188H29[16;1H[?12l[?25h[?25l[62;189H8[15;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;189H6[13;1H[?12l[?25h[?25l[62;189H5[12;1H[?12l[?25h[?25l[62;189H4[11;1H[?12l[?25h[?25l[62;189H3[10;1H[?12l[?25h[?25l[62;189H2[9;1H[?12l[?25h[?25l[62;189H1[8;1H[?12l[?25h[?25l[62;189H0[7;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[62;189H8[5;1H[?12l[?25h[?25l[62;189H7[4;1H[?12l[?25h[?25l[62;189H6[3;1H[?12l[?25h[?25l[62;189H5[2;1H[?12l[?25h[?25l[62;189H4[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H313,0-1[7C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[62;189H3,0-1[2;1H[?12l[?25h[?25l[62;189H4,1  [3;1H[?12l[?25h[?25l[62;189H5[4;1H[?12l[?25h[?25l[62;189H6[5;1H[?12l[?25h[?25l[62;189H7[6;1H[?12l[?25h[?25l[62;189H8[7;1H[?12l[?25h[?25l[62;189H9[8;1H[?12l[?25h[?25l[62;188H20[9;1H[?12l[?25h[?25l[62;189H1[10;1H[?12l[?25h[?25l[62;189H2[11;1H[?12l[?25h[?25l[62;189H3[12;1H[?12l[?25h[?25l[62;189H4[13;1H[?12l[?25h[?25l[62;189H5[14;1H[?12l[?25h[?25l[62;189H6[15;1H[?12l[?25h[?25l[62;189H7[16;1H[?12l[?25h[?25l[62;189H8[17;1H[?12l[?25h[?25l[62;189H9[18;1H[?12l[?25h[?25l[62;188H30[19;1H[?12l[?25h[?25l[62;189H1[20;1H[?12l[?25h[?25l[62;189H2,0-1[21;1H[?12l[?25h[?25l[62;189H3,1  [22;1H[?12l[?25h[?25l[62;189H4[23;1H[?12l[?25h[?25l[62;189H5[24;1H[?12l[?25h[?25l[62;189H6[25;1H[?12l[?25h[?25l[62;189H7[26;1H[?12l[?25h[?25l[62;189H8,1-8[27;8H[?12l[?25h[?25l[62;189H9,1  [28;1H[?12l[?25h[?25l[62;188H40[29;1H[?12l[?25h[?25l[62;189H1,1-8[30;8H[?12l[?25h[?25l[62;189H2[31;8H[?12l[?25h[?25l[62;189H3[32;8H[?12l[?25h[?25l[62;189H4[33;8H[?12l[?25h[?25l[62;189H5[34;8H[?12l[?25h[?25l[62;189H6[35;8H[?12l[?25h[?25l[62;189H7[36;8H[?12l[?25h[?25l[62;189H8,1  [37;1H[?12l[?25h[?25l[62;189H9[38;1H[?12l[?25h[?25l[62;188H50[39;1H[?12l[?25h[?25l[62;189H1[40;1H[?12l[?25h[?25l[62;189H2[41;1H[?12l[?25h[?25l[62;189H3[42;1H[?12l[?25h[?25l[62;189H4[43;1H[?12l[?25h[?25l[62;189H5[44;1H[?12l[?25h[?25l[62;189H6[45;1H[?12l[?25h[?25l[62;189H7[46;1H[?12l[?25h[?25l[62;189H8[47;1H[?12l[?25h[?25l[62;189H9[48;1H[?12l[?25h[?25l[62;188H60,0-1[49;1H[?12l[?25h[?25l[62;189H1,1  [50;1H[?12l[?25h[?25l[62;189H2[51;1H[?12l[?25h[?25l[62;189H3[52;1H[?12l[?25h[?25l[62;189H4,0-1[53;1H[?12l[?25h[?25l[62;189H5,1  [54;1H[?12l[?25h[?25l[62;189H6[55;1H[?12l[?25h[?25l[62;189H7[56;1H[?12l[?25h[?25l[62;189H8,0-1[57;1H[?12l[?25h[?25l[62;189H9,1  [58;1H[?12l[?25h[?25l[62;188H70[59;1H[?12l[?25h[?25l[62;189H1[60;1H[?12l[?25h[?25l[62;189H2[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[96m#close()[m[62;187H[K[62;187H373,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;189H3[60;1H[?12l[?25h[?25l[62;189H2[59;1H[?12l[?25h[?25l[62;189H1[58;1H[?12l[?25h[?25l[62;189H0[57;1H[?12l[?25h[?25l[62;188H69[56;1H[?12l[?25h[?25l[62;189H8,0-1[55;1H[?12l[?25h[?25l[62;189H7,1  [54;1H[?12l[?25h[?25l[62;189H6[53;1H[?12l[?25h[?25l[62;189H5[52;1H[?12l[?25h[?25l[62;189H4,0-1[51;1H[?12l[?25h[?25l[62;189H3,1  [50;1H[?12l[?25h[?25l[62;189H2[49;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;189H0,0-1[47;1H[?12l[?25h[?25l[62;188H59,1  [46;1H[?12l[?25h[?25l[62;189H8[45;1H[?12l[?25h[?25l[62;189H7[44;1H[?12l[?25h[?25l[62;189H6[43;1H[?12l[?25h[?25l[62;189H5[42;1H[?12l[?25h[?25l[62;189H4[41;1H[?12l[?25h[?25l[62;189H3[40;1H[?12l[?25h[?25l[62;189H2[39;1H[?12l[?25h[?25l[62;189H1[38;1H[?12l[?25h[?25l[62;189H0[37;1H[?12l[?25h[?25l[62;188H49[36;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;189H7,1-8[34;8H[?12l[?25h[?25l[62;189H6[33;8H[?12l[?25h[?25l[62;189H5[32;8H[?12l[?25h[?25l[62;189H4[31;8H[?12l[?25h[?25l[62;189H3[30;8H[?12l[?25h[?25l[62;189H2[29;8H[?12l[?25h[?25l[62;189H1[28;8H[?12l[?25h[?25l[62;189H0,1  [27;1H[?12l[?25h[?25l[62;188H39[26;1H[?12l[?25h[?25l[62;189H8,1-8[25;8H[?12l[?25h[?25l[62;189H7,1  [24;1H[?12l[?25h[?25l[62;189H6[23;1H[?12l[?25h[?25l[62;189H5[22;1H[?12l[?25h[?25l[62;189H4[21;1H[?12l[?25h[?25l[62;189H3[20;1H[?12l[?25h[?25l[62;189H2,0-1[19;1H[?12l[?25h[?25l[62;189H1,1  [18;1H[?12l[?25h[?25l[62;189H0[17;1H[?12l[?25h[?25l[62;188H29[16;1H[?12l[?25h[?25l[62;189H8[15;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;189H6[13;1H[?12l[?25h[?25l[62;189H5[12;1H[?12l[?25h[?25l[62;189H4[11;1H[?12l[?25h[?25l[62;189H3[10;1H[?12l[?25h[?25l[62;189H2[9;1H[?12l[?25h[?25l[62;189H1[8;1H[?12l[?25h[?25l[62;189H0[7;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[62;189H8[5;1H[?12l[?25h[?25l[62;189H7[4;1H[?12l[?25h[?25l[62;189H6[3;1H[?12l[?25h[?25l[62;189H5[2;1H[?12l[?25h[?25l[62;189H4[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H313,0-1[7C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93melif[m devA <= -pi:[62;187H[K[62;187H311,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HdevA = devA - [95m2[m*pi[62;187H[K[62;187H310,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H307,0-1[7C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H306,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0[62;187H[K[62;187H305,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H304,1[9C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H303,0-1[7C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[62;187H[K[62;187H300,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m sub_oyaw >= pi:[62;187H[K[62;187H299,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[62;187H[K[62;187H298,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H297,0-1[7C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H296,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H293,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[62;187H[K[62;187H292,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H291,0-1[7C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HZip = [95m1[m[62;187H[K[62;187H290,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m AgainstWind:[62;187H[K[62;187H289,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H288,0-1[7C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[62;187H[K[62;187H286,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H285,0-1[7C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0    [96m# ***************************[m[62;187H[K[62;187H284,1[9C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H283,1[9C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H282,1[9C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H280,0-1[7C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H279,1[9C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hoyaw0 = computeoyaw(xy)[62;187H[K[62;187H278,1[9C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H277,0-1[7C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m#  goal position[m[62;187H[K[62;187H276,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][m[62;187H[K[62;187H275,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# auto triangle track[m[62;187H[K[62;187H273,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][62;187H[K[62;187H272,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H271,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;21Hnub = [95m0[m[62;187H[K[62;187H270,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HFlag0 = [1m[96mTrue[m[62;187H[K[62;187H268,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[62;187H[K[62;187H266,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[62;187H[K[62;187H265,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[62;187H[K[62;187H264,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H263,1[9C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H262,0-1[7C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H261,1[9C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H259,0-1[7C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[62;187H[K[62;187H258,1[9C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# TWA0 = sensor_submsg[3][m[62;187H[K[62;187H257,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[62;187H[K[62;187H256,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H254,0-1[7C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[m[62;187H[K[62;187H252,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[m[62;187H[K[62;187H251,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[m[62;187H[K[62;187H250,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[m[62;187H[K[62;187H249,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H248,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[m[62;187H[K[62;187H247,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[62;187H[K[62;187H245,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# todo[m[62;187H[K[62;187H244,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[62;187H[K[62;187H243,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mtry[m:[62;187H[K[62;187H242,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdsa = [95m0.1[m[62;187H[K[62;187H241,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdra = [95m0.01[m[62;187H[K[62;187H240,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hra = pi[62;187H[K[62;187H239,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsa = pi/[95m2[m[62;187H[K[62;187H238,1[9C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrate = rospy.Rate([95m10[m)[62;187H[K[62;187H237,1[9C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H236,0-1[7C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[62;187H[K[62;187H235,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H234,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H233,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hspare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hspare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)[62;187H[K[62;187H231,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)[62;187H[K[62;187H230,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H229,0-1[7C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[62;187H[K[62;187H228,1[9C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H227,1[9C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H226,0-1[7C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m rudangle[62;187H[K[62;187H225,1[9C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hrudangle = -pi/[95m6.0[m[62;187H[K[62;187H224,1[9C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m rudangle <= -pi/[95m6.0[m:[62;187H[K[62;187H223,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hrudangle = pi/[95m6.0[m[62;187H[K[62;187H222,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m rudangle >= pi/[95m6.0[m:[62;187H[K[62;187H221,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H220,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H219,0-1[7C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H218,0-1[7C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m sub_oyaw0[62;187H[K[62;187H217,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsub_oyaw0 = oyaw[62;187H[K[62;187H216,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HZip = [95m0[m[62;187H[K[62;187H215,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HturnR = [95m0[m[62;187H[K[62;187H214,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HturnL = [95m0[m[62;187H[K[62;187H213,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H212,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[62;187H[K[62;187H210,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[62;187H[K[62;187H209,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m sub_oyaw0 < [95m0[m:[62;187H[K[62;187H208,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H207,0-1[7C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H206,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melse[m:[62;187H[K[62;187H205,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m turnR == [95m1[m:[62;187H[K[62;187H203,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[62;187H[K[62;187H202,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m turnL == [95m1[m:[62;187H[K[62;187H201,1[9C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H200,0-1[7C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H199,1[9C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H198,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[62;187H[K[62;187H196,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m0[m[62;187H[K[62;187H195,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H194,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m1[m[62;187H[K[62;187H193,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[62;187H[K[62;187H192,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H191,0-1[7C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H189,1[9C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H188,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m Zip == [95m1[m:[62;187H[K[62;187H187,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H186,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m1[m[62;187H[K[62;187H185,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m0[m[62;187H[K[62;187H184,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H182,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H181,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H180,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H179,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m against_wind:[62;187H[K[62;187H178,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m turnR[62;187H[K[62;187H177,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m turnL[62;187H[K[62;187H176,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m Zip[62;187H[K[62;187H175,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):[62;187H[K[62;187H174,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H173,0-1[7C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H172,0-1[7C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m dev_distance[62;187H[K[62;187H171,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)[62;187H[K[62;187H170,1[9C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H168,0-1[7C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H167,0-1[7C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m against_wind[62;187H[K[62;187H166,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hagainst_wind = [1m[96mFalse[m[62;187H[K[62;187H165,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H164,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hagainst_wind = [1m[96mTrue[m[62;187H[K[62;187H163,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):[62;187H[K[62;187H161,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H160,0-1[7C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H159,0-1[7C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m angle_between_oyaw_twa[62;187H[K[62;187H158,1[9C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi[62;187H[K[62;187H157,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[62;187H[K[62;187H156,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hangle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):[62;187H[K[62;187H154,1[9C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H153,0-1[7C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H152,0-1[7C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m[62;187H[K[62;187H151,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])[62;187H[K[62;187H150,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H149,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m yaw0 >= pi:[62;187H[K[62;187H147,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[62;187H[K[62;187H146,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[62;187H[K[62;187H145,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))[62;187H[K[62;187H144,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[62;187H[K[62;187H143,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m[62;187H[K[62;187H142,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H141,0-1[7C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H140,0-1[7C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m twa0[62;187H[K[62;187H139,1[9C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = pi[62;187H[K[62;187H138,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H137,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m[62;187H[K[62;187H136,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m twa0 >= pi:[62;187H[K[62;187H135,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melif[m twa_ux < [95m0[m:[62;187H[K[62;187H133,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = math.atan(twa_uy / twa_ux)[62;187H[K[62;187H132,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m twa_ux > [95m0[m:[62;187H[K[62;187H131,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Htwa_uy = aws * math.sin(alpha) + vy[62;187H[K[62;187H130,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Htwa_ux = aws * math.cos(alpha) + ux[62;187H[K[62;187H129,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Halpha = alpha + [95m2[m * pi[62;187H[K[62;187H128,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Halpha = yaw + awa - pi[62;187H[K[62;187H126,1[9C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):[62;187H[K[62;187H125,1[9C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H124,0-1[7C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H123,0-1[7C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m sail_angle[62;187H[K[62;187H122,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)[62;187H[K[62;187H121,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H120,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsail_angle = [95m0[m[62;187H[K[62;187H119,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[62;187H[K[62;187H118,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_sail_angle[m(awa):[62;187H[K[62;187H117,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H116,0-1[7C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H115,0-1[7C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m config[62;187H[K[62;187H114,1[9C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m6[m] = config.sailI    [96m# pos1x[m[62;187H[K[62;187H112,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m5[m] = config.sailP    [96m# devD[m[62;187H[K[62;187H111,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m[62;187H[K[62;187H110,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m[62;187H[K[62;187H109,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m[62;187H[K[62;187H108,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m1[m] = config.oyaw[62;187H[K[62;187H107,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H105,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hpara_cfg[[95m0[m] = [95m1[m[62;187H[K[62;187H104,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[62;187H[K[62;187H103,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m para_cfg[62;187H[K[62;187H102,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m[62;187H[K[62;187H101,1[9C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H100,0-1[7C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H99,0-1[8C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[10C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H87,0-1[8C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H86,0-1[8C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[10C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H75,0-1[8C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H74,0-1[8C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[10C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H63,0-1[8C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H62,0-1[8C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m mach_pub[62;187H[K[62;187H61,1[10C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.PCCtrl = msg[[95m2[m][62;187H[K[62;187H60,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.sail   = msg[[95m1[m][62;187H[K[62;187H59,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.rudder = msg[[95m0[m][62;187H[K[62;187H58,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.motor = [95m57[m[62;187H[K[62;187H57,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[96m# mach_pub.timestamp = rospy.Time.now()[m[62;187H[K[62;187H56,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.header.frame_id = [95m'AHRS'[m[62;187H[K[62;187H55,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.header.stamp = rospy.Time.now()[62;187H[K[62;187H54,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub = Mach_msg()[62;187H[K[62;187H53,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutMachPut[m(msg):  [96m# sailboat_message::Mach_msg[m[62;187H[K[62;187H52,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H51,0-1[8C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hcount = [95m0[m[62;187H[K[62;187H50,1[10C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H49,0-1[8C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HAgainstWind0 = [1m[96mFalse[m[62;187H[K[62;187H48,1[10C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HAgainstWind = [1m[96mFalse[m[62;187H[K[62;187H47,1[10C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H46,0-1[8C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Htrack = [[95m20[m, -[95m10[m, -[95m30[m, [95m0[m, [95m0[m, [95m20[m]  [96m# [x0, y0, x1, y1, x2, y2][m[62;187H[K[62;187H45,1[10C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hnub = [95m0[m[62;187H[K[62;187H44,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H43,0-1[8C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hgoy = [95m0.1[m[62;187H[K[62;187H42,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hgox = [95m0.1[m[62;187H[K[62;187H41,1[10C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H40,0-1[8C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevD0 = [95m0.0[m[62;187H[K[62;187H39,1[10C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H38,0-1[8C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H37,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnR = [95m0[m[62;187H[K[62;187H36,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnL = [95m0[m[62;187H[K[62;187H35,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HZip = [95m1[m[62;187H[K[62;187H34,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HTWA0 = [95m1.0[m[62;187H[K[62;187H33,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H32,0-1[9C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HDer = [95m0.0[m[62;187H[K[62;187H31,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HIer = [95m0.0[m[62;187H[K[62;187H30,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HPer = [95m0.0[m[62;187H[K[62;187H29,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H28,0-1[9C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA0 = [95m0.0[m[62;187H[K[62;187H27,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA = [95m0.0[m[62;187H[K[62;187H26,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H25,0-1[9C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsub_oyaw = [95m190.0[m[62;187H[K[62;187H24,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw1 = oyaw0[62;187H[K[62;187H23,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw0 = [95m1.0[m[62;187H[K[62;187H22,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HY0 = -[95m3.0[m[62;187H[K[62;187H21,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HX0 = -[95m1.0[m[62;187H[K[62;187H20,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HsailA = [95m0.0[m[62;187H[K[62;187H19,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HrudA = [95m0.0[m[62;187H[K[62;187H18,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpara_cfg = [[95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m][62;187H[K[62;187H17,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsensor_submsg = [[95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m][62;187H[K[62;187H16,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H15,0-1[9C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpi = [95m3.14159[m[62;187H[K[62;187H14,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H13,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m math[62;187H[K[62;187H12,1[11C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H11,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m dynamic_reconfigure.server [38;5;81mimport[m Server[62;187H[K[62;187H10,1[11C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H9,0-1[10C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_para[62;187H[K[62;187H8,1[12C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_out[62;187H[K[62;187H7,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.cfg [38;5;81mimport[m spare_function_Config[62;187H[K[62;187H6,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H5,0-1[10C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg[62;187H[K[62;187H4,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Sensor_msg[62;187H[K[62;187H3,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m rospy[62;187H[K[62;187H2,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[96m#!/usr/bin/env python[m[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H2[2;1H[?12l[?25h[?25l[62;187H3[3;1H[?12l[?25h[?25l[62;187H4[4;1H[?12l[?25h[?25l[62;187H5,0-1[5;1H[?12l[?25h[?25l[62;187H6,1  [6;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H8[8;1H[?12l[?25h[?25l[62;187H9,0-1[9;1H[?12l[?25h[?25l[62;187H10,1 [10;1H[?12l[?25h[?25l[62;188H1,0-1[11;1H[?12l[?25h[?25l[62;188H2,1  [12;1H[?12l[?25h[?25l[62;188H3,0-1[13;1H[?12l[?25h[?25l[62;188H4,1  [14;1H[?12l[?25h[?25l[62;188H5,0-1[15;1H[?12l[?25h[?25l[62;188H6,1  [16;1H[?12l[?25h[?25l[62;188H7[17;1H[?12l[?25h[?25l[62;188H8[18;1H[?12l[?25h[?25l[62;188H9[19;1H[?12l[?25h[?25l[62;187H20[20;1H[?12l[?25h[?25l[62;188H1[21;1H[?12l[?25h[?25l[62;188H2[22;1H[?12l[?25h[?25l[62;188H3[23;1H[?12l[?25h[?25l[62;188H4[24;1H[?12l[?25h[?25l[62;188H5,0-1[25;1H[?12l[?25h[?25l[62;188H6,1  [26;1H[?12l[?25h[?25l[62;188H7[27;1H[?12l[?25h[?25l[62;188H8,0-1[28;1H[?12l[?25h[?25l[62;188H9,1  [29;1H[?12l[?25h[?25l[62;187H30[30;1H[?12l[?25h[?25l[62;188H1[31;1H[?12l[?25h[?25l[62;188H2,0-1[32;1H[?12l[?25h[?25l[62;188H3,1  [33;1H[?12l[?25h[?25l[62;188H4[34;1H[?12l[?25h[?25l[62;188H5[35;1H[?12l[?25h[?25l[62;188H6[36;1H[?12l[?25h[?25l[62;188H7[37;1H[?12l[?25h[?25l[62;188H8,0-1[38;1H[?12l[?25h[?25l[62;188H9,1  [39;1H[?12l[?25h[?25l[62;187H40,0-1[40;1H[?12l[?25h[?25l[62;188H1,1  [41;1H[?12l[?25h[?25l[62;188H2[42;1H[?12l[?25h[?25l[62;188H3,0-1[43;1H[?12l[?25h[?25l[62;188H4,1  [44;1H[?12l[?25h[?25l[62;188H5[45;1H[?12l[?25h[?25l[62;188H6,0-1[46;1H[?12l[?25h[?25l[62;188H7,1  [47;1H[?12l[?25h[?25l[62;188H8[48;1H[?12l[?25h[?25l[62;188H9,0-1[49;1H[?12l[?25h[?25l[62;187H50,1  [50;1H[?12l[?25h[?25l[62;188H1,0-1[51;1H[?12l[?25h[?25l[62;188H2,1  [52;1H[?12l[?25h[?25l[62;188H3[53;1H[?12l[?25h[?25l[62;188H4[54;1H[?12l[?25h[?25l[62;188H5[55;1H[?12l[?25h[?25l[62;188H6[56;1H[?12l[?25h[?25l[62;188H7[57;1H[?12l[?25h[?25l[62;188H8[58;1H[?12l[?25h[?25l[62;188H9[59;1H[?12l[?25h[?25l[62;187H60[60;1H[?12l[?25h[?25l[62;188H1[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H62,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H63,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[11C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H74,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H75,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H86,0-1[9C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H87,0-1[9C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H99,0-1[8C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H100,0-1[7C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m[62;187H[K[62;187H101,1[9C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m para_cfg[62;187H[K[62;187H102,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[62;187H[K[62;187H103,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m1[m[62;187H[K[62;187H104,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H105,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m1[m] = config.oyaw[62;187H[K[62;187H107,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m[62;187H[K[62;187H108,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m[62;187H[K[62;187H109,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m[62;187H[K[62;187H110,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m5[m] = config.sailP    [96m# devD[m[62;187H[K[62;187H111,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m6[m] = config.sailI    [96m# pos1x[m[62;187H[K[62;187H112,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m config[62;187H[K[62;187H114,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H115,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H116,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sail_angle[m(awa):[62;187H[K[62;187H117,1[9C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[62;187H[K[62;187H118,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = [95m0[m[62;187H[K[62;187H119,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H120,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)[62;187H[K[62;187H121,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sail_angle[62;187H[K[62;187H122,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H123,0-1[7C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H124,0-1[7C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):[62;187H[K[62;187H125,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Halpha = yaw + awa - pi[62;187H[K[62;187H126,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Halpha = alpha + [95m2[m * pi[62;187H[K[62;187H128,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_ux = aws * math.cos(alpha) + ux[62;187H[K[62;187H129,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_uy = aws * math.sin(alpha) + vy[62;187H[K[62;187H130,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m twa_ux > [95m0[m:[62;187H[K[62;187H131,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux)[62;187H[K[62;187H132,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m twa_ux < [95m0[m:[62;187H[K[62;187H133,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m twa0 >= pi:[62;187H[K[62;187H135,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m[62;187H[K[62;187H136,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H137,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = pi[62;187H[K[62;187H138,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m twa0[62;187H[K[62;187H139,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H140,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H141,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m[62;187H[K[62;187H142,1[9C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[62;187H[K[62;187H143,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))[62;187H[K[62;187H144,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[62;187H[K[62;187H145,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[62;187H[K[62;187H146,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m yaw0 >= pi:[62;187H[K[62;187H147,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H149,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])[62;187H[K[62;187H150,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m[62;187H[K[62;187H151,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H152,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H153,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):[62;187H[K[62;187H154,1[9C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hangle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[62;187H[K[62;187H156,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi[62;187H[K[62;187H157,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m angle_between_oyaw_twa[62;187H[K[62;187H158,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H159,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H160,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):[62;187H[K[62;187H161,1[9C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mTrue[m[62;187H[K[62;187H163,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H164,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mFalse[m[62;187H[K[62;187H165,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m against_wind[62;187H[K[62;187H166,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H167,0-1[7C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H168,0-1[7C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)[62;187H[K[62;187H170,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m dev_distance[62;187H[K[62;187H171,1[9C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H172,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H173,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):[62;187H[K[62;187H174,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m Zip[62;187H[K[62;187H175,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnL[62;187H[K[62;187H176,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnR[62;187H[K[62;187H177,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m against_wind:[62;187H[K[62;187H178,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H179,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H180,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H181,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H182,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H184,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H185,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H186,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m Zip == [95m1[m:[62;187H[K[62;187H187,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H188,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H189,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H191,0-1[7C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[62;187H[K[62;187H192,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H193,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H194,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H195,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[62;187H[K[62;187H196,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H198,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H199,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H200,0-1[7C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m turnL == [95m1[m:[62;187H[K[62;187H201,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[62;187H[K[62;187H202,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m turnR == [95m1[m:[62;187H[K[62;187H203,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melse[m:[62;187H[K[62;187H205,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H206,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H207,0-1[7C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m sub_oyaw0 < [95m0[m:[62;187H[K[62;187H208,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[62;187H[K[62;187H209,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[62;187H[K[62;187H210,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H212,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnL = [95m0[m[62;187H[K[62;187H213,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnR = [95m0[m[62;187H[K[62;187H214,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HZip = [95m0[m[62;187H[K[62;187H215,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsub_oyaw0 = oyaw[62;187H[K[62;187H216,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sub_oyaw0[62;187H[K[62;187H217,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H218,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H219,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H220,1[9C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle >= pi/[95m6.0[m:[62;187H[K[62;187H221,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = pi/[95m6.0[m[62;187H[K[62;187H222,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle <= -pi/[95m6.0[m:[62;187H[K[62;187H223,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = -pi/[95m6.0[m[62;187H[K[62;187H224,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m rudangle[62;187H[K[62;187H225,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H226,0-1[7C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H227,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[62;187H[K[62;187H228,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H229,0-1[7C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)[62;187H[K[62;187H230,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)[62;187H[K[62;187H231,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H233,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H234,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[62;187H[K[62;187H235,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H236,0-1[7C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrate = rospy.Rate([95m10[m)[62;187H[K[62;187H237,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsa = pi/[95m2[m[62;187H[K[62;187H238,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hra = pi[62;187H[K[62;187H239,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdra = [95m0.01[m[62;187H[K[62;187H240,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdsa = [95m0.1[m[62;187H[K[62;187H241,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mtry[m:[62;187H[K[62;187H242,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[62;187H[K[62;187H243,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# todo[m[62;187H[K[62;187H244,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[62;187H[K[62;187H245,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[m[62;187H[K[62;187H247,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H248,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[m[62;187H[K[62;187H249,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[m[62;187H[K[62;187H250,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[m[62;187H[K[62;187H251,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[m[62;187H[K[62;187H252,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H254,0-1[7C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[62;187H[K[62;187H256,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# TWA0 = sensor_submsg[3][m[62;187H[K[62;187H257,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[62;187H[K[62;187H258,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H259,0-1[7C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H261,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H262,0-1[7C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H263,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[62;187H[K[62;187H264,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[62;187H[K[62;187H265,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[62;187H[K[62;187H266,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mTrue[m[62;187H[K[62;187H268,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;21Hnub = [95m0[m[62;187H[K[62;187H270,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H271,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][62;187H[K[62;187H272,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# auto triangle track[m[62;187H[K[62;187H273,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][m[62;187H[K[62;187H275,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m#  goal position[m[62;187H[K[62;187H276,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H277,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hoyaw0 = computeoyaw(xy)[62;187H[K[62;187H278,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H279,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H280,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H282,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H283,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0    [96m# ***************************[m[62;187H[K[62;187H284,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H285,0-1[7C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[62;187H[K[62;187H286,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H288,0-1[7C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind:[62;187H[K[62;187H289,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HZip = [95m1[m[62;187H[K[62;187H290,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H291,0-1[7C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[62;187H[K[62;187H292,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H293,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H296,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H297,0-1[7C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[62;187H[K[62;187H298,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sub_oyaw >= pi:[62;187H[K[62;187H299,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[62;187H[K[62;187H300,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H303,0-1[7C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H304,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H305,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H306,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H307,0-1[7C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA - [95m2[m*pi[62;187H[K[62;187H310,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA <= -pi:[62;187H[K[62;187H311,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H313,0-1[7C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m - pi/[95m2.0[m <= devA <= pi/[95m2.0[m:[62;187H[K[62;187H314,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HPer = devA[62;187H[K[62;187H315,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = Ier + devA[62;187H[K[62;187H316,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HDer = devA - devA0[62;187H[K[62;187H317,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier >= [95m15.0[m:  Ier = [95m15.0[m[62;187H[K[62;187H318,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier <= -[95m15.0[m:  Ier = -[95m15.0[m[62;187H[K[62;187H319,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# rudA = -(para_cfg[2] * Per + para_cfg[3] * (Ier + para_cfg[4]/para_cfg[2] * Der) + para_cfg[4] * Der)[m[62;187H[K[62;187H320,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -(para_cfg[[95m2[m] * Per + para_cfg[[95m3[m] * Ier + para_cfg[[95m4[m] * Der)[62;187H[K[62;187H321,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = rudAlim(rudA)   [96m# limit the rudder's maximum angle to pi/6[m[62;187H[K[62;187H322,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = devA[62;187H[K[62;187H323,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA > [95m0[m:[62;187H[K[62;187H324,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -[95m1.0[m * pi / [95m6.0[m[62;187H[K[62;187H325,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H326,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H327,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melse[m:[62;187H[K[62;187H328,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = pi / [95m6.0[m[62;187H[K[62;187H329,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H330,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H331,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H332,0-1[7C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_np = [para_cfg[[95m5[m], para_cfg[[95m6[m], [95m1[m][62;187H[K[62;187H333,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [length, TWA0*180/pi, devA*180/pi, devD, oyaw1*180/pi, sub_oyaw*180/pi, sensor_submsg[1]*180/pi][m[62;187H[K[62;187H334,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsa += dsa[62;187H[K[62;187H335,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hra += dra[62;187H[K[62;187H336,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa >= pi:[62;187H[K[62;187H337,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = -[95m0.05[m[62;187H[K[62;187H338,1-8[7C88%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa <= [95m0[m:[62;187H[K[62;187H339,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = [95m0.05[m[62;187H[K[62;187H340,1[9C89%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra >= [95m90.0[m/[95m180.0[m*pi:[62;187H[K[62;187H341,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = -[95m0.01[m[62;187H[K[62;187H342,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra <= [95m75.0[m/[95m180.0[m*pi:[62;187H[K[62;187H343,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = [95m0.01[m[62;187H[K[62;187H344,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H345,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H346,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_np = [length, AngleOytw * [95m180[m / pi, turnR, devD, turnL, sub_oyaw * [95m180[m / pi, sensor_submsg[[95m1[m] * [95m180[m / pi]  [96m# test************************************************[m[62;187H[K[62;187H347,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [rudA*180/pi, sailA, ][m[62;187H[K[62;187H348,1[9C91%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.rudder = msg[0][m[62;187H[K[62;187H349,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.sail = msg[1][m[62;187H[K[62;187H350,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationA = msg[2][m[62;187H[K[62;187H351,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationD = msg[3][m[62;187H[K[62;187H352,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.oyaw0 = msg[4]            # out_pub.suboyaw0 = msg[5][m[62;187H[K[62;187H353,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.Yaw = msg[6][m[62;187H[K[62;187H354,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# para_np = [0,0,0,0,0,0,0][m[62;187H[K[62;187H355,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m#[m[62;187H[K[62;187H356,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# input : sensor_submsg [m[62;187H[K[62;187H357,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# cfg: para_cfg[m[62;187H[K[62;187H358,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# output : mach_np out_np para_np[m[62;187H[K[62;187H359,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H360,0-1[7C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pubmsg = getOutMachPut(mach_np)[62;187H[K[62;187H361,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_pubmsg = getOutput(out_np)[62;187H[K[62;187H362,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hpara_pubmsg = getOutParaPut(para_cfg)[62;187H[K[62;187H363,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H364,0-1[7C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pub.publish(mach_pubmsg)[62;187H[K[62;187H365,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_pub.publish(out_pubmsg)[62;187H[K[62;187H366,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_para_pub.publish(para_pubmsg)[62;187H[K[62;187H367,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H368,0-1[7C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hrate.sleep()[62;187H[K[62;187H369,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mexcept[m rospy.ROSInterruptException:[62;187H[K[62;187H370,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mpass[m[62;187H[K[62;187H371,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[96m#finally:[m[62;187H[K[62;187H372,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[96m#close()[m[62;187H[K[62;187H373,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;189H3[60;1H[?12l[?25h[?25l[62;189H2[59;1H[?12l[?25h[?25l[62;189H1[58;1H[?12l[?25h[?25l[62;189H0[57;1H[?12l[?25h[?25l[62;188H69[56;1H[?12l[?25h[?25l[62;189H8,0-1[55;1H[?12l[?25h[?25l[62;189H7,1  [54;1H[?12l[?25h[?25l[62;189H6[53;1H[?12l[?25h[?25l[62;189H5[52;1H[?12l[?25h[?25l[62;189H4,0-1[51;1H[?12l[?25h[?25l[62;189H3,1  [50;1H[?12l[?25h[?25l[62;189H2[49;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;189H0,0-1[47;1H[?12l[?25h[?25l[62;188H59,1  [46;1H[?12l[?25h[?25l[62;189H8[45;1H[?12l[?25h[?25l[62;189H7[44;1H[?12l[?25h[?25l[62;189H6[43;1H[?12l[?25h[?25l[62;189H5[42;1H[?12l[?25h[?25l[62;189H4[41;1H[?12l[?25h[?25l[62;189H3[40;1H[?12l[?25h[?25l[62;189H2[39;1H[?12l[?25h[?25l[62;189H1[38;1H[?12l[?25h[?25l[62;189H0[37;1H[?12l[?25h[?25l[62;188H49[36;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;189H7,1-8[34;8H[?12l[?25h[?25l[62;189H6[33;8H[?12l[?25h[?25l[62;189H5[32;8H[?12l[?25h[?25l[62;189H4[31;8H[?12l[?25h[?25l[62;189H3[30;8H[?12l[?25h[?25l[62;189H2[29;8H[?12l[?25h[?25l[62;189H1[28;8H[?12l[?25h[?25l[62;189H0,1  [27;1H[?12l[?25h[?25l[62;188H39[26;1H[?12l[?25h[?25l[62;189H8,1-8[25;8H[?12l[?25h[?25l[62;189H7,1  [24;1H[?12l[?25h[?25l[62;189H6[23;1H[?12l[?25h[?25l[62;189H5[22;1H[?12l[?25h[?25l[62;189H4[21;1H[?12l[?25h[?25l[62;189H3[20;1H[?12l[?25h[?25l[62;189H2,0-1[19;1H[?12l[?25h[?25l[62;189H1,1  [18;1H[?12l[?25h[?25l[62;189H0[17;1H[?12l[?25h[?25l[62;188H29[16;1H[?12l[?25h[?25l[62;189H8[15;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;189H6[13;1H[?12l[?25h[?25l[62;189H5[12;1H[?12l[?25h[?25l[62;189H4[11;1H[?12l[?25h[?25l[62;189H3[10;1H[?12l[?25h[?25l[62;189H2[9;1H[?12l[?25h[?25l[62;189H1[8;1H[?12l[?25h[?25l[62;189H0[7;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[62;189H8[5;1H[?12l[?25h[?25l[62;189H7[4;1H[?12l[?25h[?25l[62;189H6[3;1H[?12l[?25h[?25l[62;189H5[2;1H[?12l[?25h[?25l[62;189H4[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H313,0-1[7C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93melif[m devA <= -pi:[62;187H[K[62;187H311,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HdevA = devA - [95m2[m*pi[62;187H[K[62;187H310,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H307,0-1[7C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H306,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0[62;187H[K[62;187H305,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H304,1[9C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H303,0-1[7C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[62;187H[K[62;187H300,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m sub_oyaw >= pi:[62;187H[K[62;187H299,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[62;187H[K[62;187H298,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H297,0-1[7C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H296,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H293,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[62;187H[K[62;187H292,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H291,0-1[7C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HZip = [95m1[m[62;187H[K[62;187H290,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m AgainstWind:[62;187H[K[62;187H289,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H288,0-1[7C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[62;187H[K[62;187H286,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H285,0-1[7C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0    [96m# ***************************[m[62;187H[K[62;187H284,1[9C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H283,1[9C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H282,1[9C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H280,0-1[7C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H279,1[9C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hoyaw0 = computeoyaw(xy)[62;187H[K[62;187H278,1[9C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H277,0-1[7C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m#  goal position[m[62;187H[K[62;187H276,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][m[62;187H[K[62;187H275,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# auto triangle track[m[62;187H[K[62;187H273,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][62;187H[K[62;187H272,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H271,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;21Hnub = [95m0[m[62;187H[K[62;187H270,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HFlag0 = [1m[96mTrue[m[62;187H[K[62;187H268,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[62;187H[K[62;187H266,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[62;187H[K[62;187H265,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[62;187H[K[62;187H264,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H263,1[9C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H262,0-1[7C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H261,1[9C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H259,0-1[7C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[62;187H[K[62;187H258,1[9C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# TWA0 = sensor_submsg[3][m[62;187H[K[62;187H257,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[62;187H[K[62;187H256,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H254,0-1[7C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[m[62;187H[K[62;187H252,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[m[62;187H[K[62;187H251,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[m[62;187H[K[62;187H250,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[m[62;187H[K[62;187H249,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H248,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[m[62;187H[K[62;187H247,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[62;187H[K[62;187H245,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# todo[m[62;187H[K[62;187H244,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[62;187H[K[62;187H243,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mtry[m:[62;187H[K[62;187H242,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdsa = [95m0.1[m[62;187H[K[62;187H241,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdra = [95m0.01[m[62;187H[K[62;187H240,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hra = pi[62;187H[K[62;187H239,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsa = pi/[95m2[m[62;187H[K[62;187H238,1[9C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrate = rospy.Rate([95m10[m)[62;187H[K[62;187H237,1[9C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H236,0-1[7C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[62;187H[K[62;187H235,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H234,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H233,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hspare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hspare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)[62;187H[K[62;187H231,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)[62;187H[K[62;187H230,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H229,0-1[7C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[62;187H[K[62;187H228,1[9C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H227,1[9C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H226,0-1[7C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m rudangle[62;187H[K[62;187H225,1[9C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hrudangle = -pi/[95m6.0[m[62;187H[K[62;187H224,1[9C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m rudangle <= -pi/[95m6.0[m:[62;187H[K[62;187H223,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hrudangle = pi/[95m6.0[m[62;187H[K[62;187H222,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m rudangle >= pi/[95m6.0[m:[62;187H[K[62;187H221,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H220,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H219,0-1[7C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H218,0-1[7C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m sub_oyaw0[62;187H[K[62;187H217,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsub_oyaw0 = oyaw[62;187H[K[62;187H216,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HZip = [95m0[m[62;187H[K[62;187H215,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HturnR = [95m0[m[62;187H[K[62;187H214,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HturnL = [95m0[m[62;187H[K[62;187H213,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H212,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[62;187H[K[62;187H210,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[62;187H[K[62;187H209,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m sub_oyaw0 < [95m0[m:[62;187H[K[62;187H208,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H207,0-1[7C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H206,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melse[m:[62;187H[K[62;187H205,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m turnR == [95m1[m:[62;187H[K[62;187H203,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[62;187H[K[62;187H202,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m turnL == [95m1[m:[62;187H[K[62;187H201,1[9C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H200,0-1[7C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H199,1[9C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H198,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[62;187H[K[62;187H196,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m0[m[62;187H[K[62;187H195,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H194,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m1[m[62;187H[K[62;187H193,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[62;187H[K[62;187H192,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H191,0-1[7C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H189,1[9C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H188,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m Zip == [95m1[m:[62;187H[K[62;187H187,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H186,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m1[m[62;187H[K[62;187H185,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m0[m[62;187H[K[62;187H184,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H182,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H181,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H180,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H179,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m against_wind:[62;187H[K[62;187H178,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m turnR[62;187H[K[62;187H177,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m turnL[62;187H[K[62;187H176,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m Zip[62;187H[K[62;187H175,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):[62;187H[K[62;187H174,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H173,0-1[7C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H172,0-1[7C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m dev_distance[62;187H[K[62;187H171,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)[62;187H[K[62;187H170,1[9C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H168,0-1[7C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H167,0-1[7C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m against_wind[62;187H[K[62;187H166,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hagainst_wind = [1m[96mFalse[m[62;187H[K[62;187H165,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H164,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hagainst_wind = [1m[96mTrue[m[62;187H[K[62;187H163,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):[62;187H[K[62;187H161,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H160,0-1[7C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H159,0-1[7C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m angle_between_oyaw_twa[62;187H[K[62;187H158,1[9C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi[62;187H[K[62;187H157,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[62;187H[K[62;187H156,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hangle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):[62;187H[K[62;187H154,1[9C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H153,0-1[7C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H152,0-1[7C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m[62;187H[K[62;187H151,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])[62;187H[K[62;187H150,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H149,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m yaw0 >= pi:[62;187H[K[62;187H147,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[62;187H[K[62;187H146,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[62;187H[K[62;187H145,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))[62;187H[K[62;187H144,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[62;187H[K[62;187H143,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m[62;187H[K[62;187H142,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H141,0-1[7C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H140,0-1[7C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m twa0[62;187H[K[62;187H139,1[9C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = pi[62;187H[K[62;187H138,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H137,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m[62;187H[K[62;187H136,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m twa0 >= pi:[62;187H[K[62;187H135,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melif[m twa_ux < [95m0[m:[62;187H[K[62;187H133,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = math.atan(twa_uy / twa_ux)[62;187H[K[62;187H132,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m twa_ux > [95m0[m:[62;187H[K[62;187H131,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Htwa_uy = aws * math.sin(alpha) + vy[62;187H[K[62;187H130,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Htwa_ux = aws * math.cos(alpha) + ux[62;187H[K[62;187H129,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Halpha = alpha + [95m2[m * pi[62;187H[K[62;187H128,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Halpha = yaw + awa - pi[62;187H[K[62;187H126,1[9C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):[62;187H[K[62;187H125,1[9C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H124,0-1[7C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H123,0-1[7C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m sail_angle[62;187H[K[62;187H122,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)[62;187H[K[62;187H121,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H120,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsail_angle = [95m0[m[62;187H[K[62;187H119,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[62;187H[K[62;187H118,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_sail_angle[m(awa):[62;187H[K[62;187H117,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H116,0-1[7C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H115,0-1[7C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m config[62;187H[K[62;187H114,1[9C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m6[m] = config.sailI    [96m# pos1x[m[62;187H[K[62;187H112,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m5[m] = config.sailP    [96m# devD[m[62;187H[K[62;187H111,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m[62;187H[K[62;187H110,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m[62;187H[K[62;187H109,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m[62;187H[K[62;187H108,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m1[m] = config.oyaw[62;187H[K[62;187H107,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H105,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hpara_cfg[[95m0[m] = [95m1[m[62;187H[K[62;187H104,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[62;187H[K[62;187H103,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m para_cfg[62;187H[K[62;187H102,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m[62;187H[K[62;187H101,1[9C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H100,0-1[7C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H99,0-1[8C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[10C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H87,0-1[8C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H86,0-1[8C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[10C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H75,0-1[8C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H74,0-1[8C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[10C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H63,0-1[8C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H62,0-1[8C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m mach_pub[62;187H[K[62;187H61,1[10C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.PCCtrl = msg[[95m2[m][62;187H[K[62;187H60,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.sail   = msg[[95m1[m][62;187H[K[62;187H59,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.rudder = msg[[95m0[m][62;187H[K[62;187H58,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.motor = [95m57[m[62;187H[K[62;187H57,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[96m# mach_pub.timestamp = rospy.Time.now()[m[62;187H[K[62;187H56,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.header.frame_id = [95m'AHRS'[m[62;187H[K[62;187H55,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.header.stamp = rospy.Time.now()[62;187H[K[62;187H54,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub = Mach_msg()[62;187H[K[62;187H53,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutMachPut[m(msg):  [96m# sailboat_message::Mach_msg[m[62;187H[K[62;187H52,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H51,0-1[8C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hcount = [95m0[m[62;187H[K[62;187H50,1[10C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H49,0-1[8C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HAgainstWind0 = [1m[96mFalse[m[62;187H[K[62;187H48,1[10C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HAgainstWind = [1m[96mFalse[m[62;187H[K[62;187H47,1[10C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H46,0-1[8C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Htrack = [[95m20[m, -[95m10[m, -[95m30[m, [95m0[m, [95m0[m, [95m20[m]  [96m# [x0, y0, x1, y1, x2, y2][m[62;187H[K[62;187H45,1[10C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hnub = [95m0[m[62;187H[K[62;187H44,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H43,0-1[8C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hgoy = [95m0.1[m[62;187H[K[62;187H42,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hgox = [95m0.1[m[62;187H[K[62;187H41,1[10C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H40,0-1[8C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevD0 = [95m0.0[m[62;187H[K[62;187H39,1[10C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H38,0-1[8C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H37,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnR = [95m0[m[62;187H[K[62;187H36,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnL = [95m0[m[62;187H[K[62;187H35,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HZip = [95m1[m[62;187H[K[62;187H34,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HTWA0 = [95m1.0[m[62;187H[K[62;187H33,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H32,0-1[9C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HDer = [95m0.0[m[62;187H[K[62;187H31,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HIer = [95m0.0[m[62;187H[K[62;187H30,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HPer = [95m0.0[m[62;187H[K[62;187H29,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H28,0-1[9C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA0 = [95m0.0[m[62;187H[K[62;187H27,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA = [95m0.0[m[62;187H[K[62;187H26,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H25,0-1[9C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsub_oyaw = [95m190.0[m[62;187H[K[62;187H24,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw1 = oyaw0[62;187H[K[62;187H23,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw0 = [95m1.0[m[62;187H[K[62;187H22,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HY0 = -[95m3.0[m[62;187H[K[62;187H21,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HX0 = -[95m1.0[m[62;187H[K[62;187H20,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HsailA = [95m0.0[m[62;187H[K[62;187H19,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HrudA = [95m0.0[m[62;187H[K[62;187H18,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpara_cfg = [[95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m][62;187H[K[62;187H17,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsensor_submsg = [[95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m][62;187H[K[62;187H16,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H15,0-1[9C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpi = [95m3.14159[m[62;187H[K[62;187H14,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H13,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m math[62;187H[K[62;187H12,1[11C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H11,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m dynamic_reconfigure.server [38;5;81mimport[m Server[62;187H[K[62;187H10,1[11C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H9,0-1[10C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_para[62;187H[K[62;187H8,1[12C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_out[62;187H[K[62;187H7,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.cfg [38;5;81mimport[m spare_function_Config[62;187H[K[62;187H6,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H5,0-1[10C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg[62;187H[K[62;187H4,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Sensor_msg[62;187H[K[62;187H3,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m rospy[62;187H[K[62;187H2,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[96m#!/usr/bin/env python[m[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H2[2;1H[?12l[?25h[?25l[62;187H3[3;1H[?12l[?25h[?25l[62;187H4[4;1H[?12l[?25h[?25l[62;187H5,0-1[5;1H[?12l[?25h[?25l[62;187H6,1  [6;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H8[8;1H[?12l[?25h[?25l[62;187H9,0-1[9;1H[?12l[?25h[?25l[62;187H10,1 [10;1H[?12l[?25h[?25l[62;188H1,0-1[11;1H[?12l[?25h[?25l[62;188H2,1  [12;1H[?12l[?25h[?25l[62;188H3,0-1[13;1H[?12l[?25h[?25l[62;188H4,1  [14;1H[?12l[?25h[?25l[62;188H5,0-1[15;1H[?12l[?25h[?25l[62;188H6,1  [16;1H[?12l[?25h[?25l[62;188H7[17;1H[?12l[?25h[?25l[62;188H8[18;1H[?12l[?25h[?25l[62;188H9[19;1H[?12l[?25h[?25l[62;187H20[20;1H[?12l[?25h[?25l[62;188H1[21;1H[?12l[?25h[?25l[62;188H2[22;1H[?12l[?25h[?25l[62;188H3[23;1H[?12l[?25h[?25l[62;188H4[24;1H[?12l[?25h[?25l[62;188H5,0-1[25;1H[?12l[?25h[?25l[62;188H6,1  [26;1H[?12l[?25h[?25l[62;188H7[27;1H[?12l[?25h[?25l[62;188H8,0-1[28;1H[?12l[?25h[?25l[62;188H9,1  [29;1H[?12l[?25h[?25l[62;187H30[30;1H[?12l[?25h[?25l[62;188H1[31;1H[?12l[?25h[?25l[62;188H2,0-1[32;1H[?12l[?25h[?25l[62;188H3,1  [33;1H[?12l[?25h[?25l[62;188H4[34;1H[?12l[?25h[?25l[62;188H5[35;1H[?12l[?25h[?25l[62;188H6[36;1H[?12l[?25h[?25l[62;188H7[37;1H[?12l[?25h[?25l[62;188H8,0-1[38;1H[?12l[?25h[?25l[62;188H9,1  [39;1H[?12l[?25h[?25l[62;187H40,0-1[40;1H[?12l[?25h[?25l[62;188H1,1  [41;1H[?12l[?25h[?25l[62;188H2[42;1H[?12l[?25h[?25l[62;188H3,0-1[43;1H[?12l[?25h[?25l[62;188H4,1  [44;1H[?12l[?25h[?25l[62;188H5[45;1H[?12l[?25h[?25l[62;188H6,0-1[46;1H[?12l[?25h[?25l[62;188H7,1  [47;1H[?12l[?25h[?25l[62;188H8[48;1H[?12l[?25h[?25l[62;188H9,0-1[49;1H[?12l[?25h[?25l[62;187H50,1  [50;1H[?12l[?25h[?25l[62;188H1,0-1[51;1H[?12l[?25h[?25l[62;188H2,1  [52;1H[?12l[?25h[?25l[62;188H3[53;1H[?12l[?25h[?25l[62;188H4[54;1H[?12l[?25h[?25l[62;188H5[55;1H[?12l[?25h[?25l[62;188H6[56;1H[?12l[?25h[?25l[62;188H7[57;1H[?12l[?25h[?25l[62;188H8[58;1H[?12l[?25h[?25l[62;188H9[59;1H[?12l[?25h[?25l[62;187H60[60;1H[?12l[?25h[?25l[62;188H1[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H62,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H63,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[11C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H74,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H75,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H86,0-1[9C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H87,0-1[9C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H99,0-1[8C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H100,0-1[7C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m[62;187H[K[62;187H101,1[9C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m para_cfg[62;187H[K[62;187H102,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[62;187H[K[62;187H103,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m1[m[62;187H[K[62;187H104,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H105,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m1[m] = config.oyaw[62;187H[K[62;187H107,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m[62;187H[K[62;187H108,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m[62;187H[K[62;187H109,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m[62;187H[K[62;187H110,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m5[m] = config.sailP    [96m# devD[m[62;187H[K[62;187H111,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m6[m] = config.sailI    [96m# pos1x[m[62;187H[K[62;187H112,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m config[62;187H[K[62;187H114,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H115,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H116,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sail_angle[m(awa):[62;187H[K[62;187H117,1[9C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[62;187H[K[62;187H118,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = [95m0[m[62;187H[K[62;187H119,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H120,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)[62;187H[K[62;187H121,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sail_angle[62;187H[K[62;187H122,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H123,0-1[7C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H124,0-1[7C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):[62;187H[K[62;187H125,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Halpha = yaw + awa - pi[62;187H[K[62;187H126,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Halpha = alpha + [95m2[m * pi[62;187H[K[62;187H128,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_ux = aws * math.cos(alpha) + ux[62;187H[K[62;187H129,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_uy = aws * math.sin(alpha) + vy[62;187H[K[62;187H130,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m twa_ux > [95m0[m:[62;187H[K[62;187H131,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux)[62;187H[K[62;187H132,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m twa_ux < [95m0[m:[62;187H[K[62;187H133,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m twa0 >= pi:[62;187H[K[62;187H135,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m[62;187H[K[62;187H136,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H137,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = pi[62;187H[K[62;187H138,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m twa0[62;187H[K[62;187H139,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H140,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H141,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m[62;187H[K[62;187H142,1[9C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[62;187H[K[62;187H143,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))[62;187H[K[62;187H144,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[62;187H[K[62;187H145,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[62;187H[K[62;187H146,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m yaw0 >= pi:[62;187H[K[62;187H147,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H149,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])[62;187H[K[62;187H150,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m[62;187H[K[62;187H151,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H152,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H153,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):[62;187H[K[62;187H154,1[9C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hangle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[62;187H[K[62;187H156,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi[62;187H[K[62;187H157,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m angle_between_oyaw_twa[62;187H[K[62;187H158,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H159,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H160,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):[62;187H[K[62;187H161,1[9C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mTrue[m[62;187H[K[62;187H163,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H164,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mFalse[m[62;187H[K[62;187H165,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m against_wind[62;187H[K[62;187H166,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H167,0-1[7C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H168,0-1[7C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)[62;187H[K[62;187H170,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m dev_distance[62;187H[K[62;187H171,1[9C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H172,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H173,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):[62;187H[K[62;187H174,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m Zip[62;187H[K[62;187H175,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnL[62;187H[K[62;187H176,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnR[62;187H[K[62;187H177,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m against_wind:[62;187H[K[62;187H178,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H179,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H180,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H181,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H182,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H184,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H185,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H186,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m Zip == [95m1[m:[62;187H[K[62;187H187,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H188,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H189,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H191,0-1[7C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[62;187H[K[62;187H192,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H193,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H194,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H195,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[62;187H[K[62;187H196,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H198,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H199,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H200,0-1[7C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m turnL == [95m1[m:[62;187H[K[62;187H201,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[62;187H[K[62;187H202,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m turnR == [95m1[m:[62;187H[K[62;187H203,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melse[m:[62;187H[K[62;187H205,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H206,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H207,0-1[7C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m sub_oyaw0 < [95m0[m:[62;187H[K[62;187H208,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[62;187H[K[62;187H209,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[62;187H[K[62;187H210,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H212,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnL = [95m0[m[62;187H[K[62;187H213,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnR = [95m0[m[62;187H[K[62;187H214,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HZip = [95m0[m[62;187H[K[62;187H215,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsub_oyaw0 = oyaw[62;187H[K[62;187H216,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sub_oyaw0[62;187H[K[62;187H217,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H218,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H219,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H220,1[9C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle >= pi/[95m6.0[m:[62;187H[K[62;187H221,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = pi/[95m6.0[m[62;187H[K[62;187H222,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle <= -pi/[95m6.0[m:[62;187H[K[62;187H223,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = -pi/[95m6.0[m[62;187H[K[62;187H224,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m rudangle[62;187H[K[62;187H225,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H226,0-1[7C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H227,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[62;187H[K[62;187H228,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H229,0-1[7C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)[62;187H[K[62;187H230,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)[62;187H[K[62;187H231,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H233,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H234,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[62;187H[K[62;187H235,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H236,0-1[7C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrate = rospy.Rate([95m10[m)[62;187H[K[62;187H237,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsa = pi/[95m2[m[62;187H[K[62;187H238,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hra = pi[62;187H[K[62;187H239,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdra = [95m0.01[m[62;187H[K[62;187H240,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdsa = [95m0.1[m[62;187H[K[62;187H241,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mtry[m:[62;187H[K[62;187H242,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[62;187H[K[62;187H243,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# todo[m[62;187H[K[62;187H244,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[62;187H[K[62;187H245,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[m[62;187H[K[62;187H247,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H248,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[m[62;187H[K[62;187H249,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[m[62;187H[K[62;187H250,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[m[62;187H[K[62;187H251,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[m[62;187H[K[62;187H252,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H254,0-1[7C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[62;187H[K[62;187H256,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# TWA0 = sensor_submsg[3][m[62;187H[K[62;187H257,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[62;187H[K[62;187H258,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H259,0-1[7C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H261,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H262,0-1[7C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H263,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[62;187H[K[62;187H264,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[62;187H[K[62;187H265,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[62;187H[K[62;187H266,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mTrue[m[62;187H[K[62;187H268,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;21Hnub = [95m0[m[62;187H[K[62;187H270,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H271,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][62;187H[K[62;187H272,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# auto triangle track[m[62;187H[K[62;187H273,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][m[62;187H[K[62;187H275,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m#  goal position[m[62;187H[K[62;187H276,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H277,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hoyaw0 = computeoyaw(xy)[62;187H[K[62;187H278,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H279,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H280,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H282,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H283,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0    [96m# ***************************[m[62;187H[K[62;187H284,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H285,0-1[7C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[62;187H[K[62;187H286,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H288,0-1[7C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind:[62;187H[K[62;187H289,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HZip = [95m1[m[62;187H[K[62;187H290,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H291,0-1[7C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[62;187H[K[62;187H292,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H293,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H296,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H297,0-1[7C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[62;187H[K[62;187H298,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sub_oyaw >= pi:[62;187H[K[62;187H299,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[62;187H[K[62;187H300,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H303,0-1[7C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H304,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H305,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H306,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H307,0-1[7C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA - [95m2[m*pi[62;187H[K[62;187H310,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA <= -pi:[62;187H[K[62;187H311,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H313,0-1[7C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m - pi/[95m2.0[m <= devA <= pi/[95m2.0[m:[62;187H[K[62;187H314,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HPer = devA[62;187H[K[62;187H315,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = Ier + devA[62;187H[K[62;187H316,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HDer = devA - devA0[62;187H[K[62;187H317,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier >= [95m15.0[m:  Ier = [95m15.0[m[62;187H[K[62;187H318,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier <= -[95m15.0[m:  Ier = -[95m15.0[m[62;187H[K[62;187H319,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# rudA = -(para_cfg[2] * Per + para_cfg[3] * (Ier + para_cfg[4]/para_cfg[2] * Der) + para_cfg[4] * Der)[m[62;187H[K[62;187H320,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -(para_cfg[[95m2[m] * Per + para_cfg[[95m3[m] * Ier + para_cfg[[95m4[m] * Der)[62;187H[K[62;187H321,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = rudAlim(rudA)   [96m# limit the rudder's maximum angle to pi/6[m[62;187H[K[62;187H322,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = devA[62;187H[K[62;187H323,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA > [95m0[m:[62;187H[K[62;187H324,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -[95m1.0[m * pi / [95m6.0[m[62;187H[K[62;187H325,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H326,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H327,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melse[m:[62;187H[K[62;187H328,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = pi / [95m6.0[m[62;187H[K[62;187H329,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H330,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H331,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H332,0-1[7C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_np = [para_cfg[[95m5[m], para_cfg[[95m6[m], [95m1[m][62;187H[K[62;187H333,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [length, TWA0*180/pi, devA*180/pi, devD, oyaw1*180/pi, sub_oyaw*180/pi, sensor_submsg[1]*180/pi][m[62;187H[K[62;187H334,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsa += dsa[62;187H[K[62;187H335,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hra += dra[62;187H[K[62;187H336,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa >= pi:[62;187H[K[62;187H337,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = -[95m0.05[m[62;187H[K[62;187H338,1-8[7C88%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa <= [95m0[m:[62;187H[K[62;187H339,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = [95m0.05[m[62;187H[K[62;187H340,1[9C89%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra >= [95m90.0[m/[95m180.0[m*pi:[62;187H[K[62;187H341,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = -[95m0.01[m[62;187H[K[62;187H342,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra <= [95m75.0[m/[95m180.0[m*pi:[62;187H[K[62;187H343,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = [95m0.01[m[62;187H[K[62;187H344,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H345,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H346,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_np = [length, AngleOytw * [95m180[m / pi, turnR, devD, turnL, sub_oyaw * [95m180[m / pi, sensor_submsg[[95m1[m] * [95m180[m / pi]  [96m# test************************************************[m[62;187H[K[62;187H347,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [rudA*180/pi, sailA, ][m[62;187H[K[62;187H348,1[9C91%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.rudder = msg[0][m[62;187H[K[62;187H349,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.sail = msg[1][m[62;187H[K[62;187H350,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationA = msg[2][m[62;187H[K[62;187H351,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationD = msg[3][m[62;187H[K[62;187H352,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.oyaw0 = msg[4]            # out_pub.suboyaw0 = msg[5][m[62;187H[K[62;187H353,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.Yaw = msg[6][m[62;187H[K[62;187H354,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# para_np = [0,0,0,0,0,0,0][m[62;187H[K[62;187H355,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m#[m[62;187H[K[62;187H356,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# input : sensor_submsg [m[62;187H[K[62;187H357,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# cfg: para_cfg[m[62;187H[K[62;187H358,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# output : mach_np out_np para_np[m[62;187H[K[62;187H359,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H360,0-1[7C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pubmsg = getOutMachPut(mach_np)[62;187H[K[62;187H361,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_pubmsg = getOutput(out_np)[62;187H[K[62;187H362,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hpara_pubmsg = getOutParaPut(para_cfg)[62;187H[K[62;187H363,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H364,0-1[7C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pub.publish(mach_pubmsg)[62;187H[K[62;187H365,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_pub.publish(out_pubmsg)[62;187H[K[62;187H366,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_para_pub.publish(para_pubmsg)[62;187H[K[62;187H367,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H368,0-1[7C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hrate.sleep()[62;187H[K[62;187H369,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mexcept[m rospy.ROSInterruptException:[62;187H[K[62;187H370,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mpass[m[62;187H[K[62;187H371,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[96m#finally:[m[62;187H[K[62;187H372,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[96m#close()[m[62;187H[K[62;187H373,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;189H3[60;1H[?12l[?25h[?25l[62;189H2[59;1H[?12l[?25h[?25l[62;189H1[58;1H[?12l[?25h[?25l[62;189H0[57;1H[?12l[?25h[?25l[62;188H69[56;1H[?12l[?25h[?25l[62;189H8,0-1[55;1H[?12l[?25h[?25l[62;189H7,1  [54;1H[?12l[?25h[?25l[62;189H6[53;1H[?12l[?25h[?25l[62;189H5[52;1H[?12l[?25h[?25l[62;189H4,0-1[51;1H[?12l[?25h[?25l[62;189H3,1  [50;1H[?12l[?25h[?25l[62;189H2[49;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;189H0,0-1[47;1H[?12l[?25h[?25l[62;188H59,1  [46;1H[?12l[?25h[?25l[62;189H8[45;1H[?12l[?25h[?25l[62;189H7[44;1H[?12l[?25h[?25l[62;189H6[43;1H[?12l[?25h[?25l[62;189H5[42;1H[?12l[?25h[?25l[62;189H4[41;1H[?12l[?25h[?25l[62;189H3[40;1H[?12l[?25h[?25l[62;189H2[39;1H[?12l[?25h[?25l[62;189H1[38;1H[?12l[?25h[?25l[62;189H0[37;1H[?12l[?25h[?25l[62;188H49[36;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;189H7,1-8[34;8H[?12l[?25h[?25l[62;189H8,1  [35;1H[?12l[?25h[?25l[62;189H9[36;1H[?12l[?25h[?25l[62;188H50[37;1H[?12l[?25h[?25l[62;189H1[38;1H[?12l[?25h[?25l[62;189H2[39;1H[?12l[?25h[?25l[62;189H3[40;1H[?12l[?25h[?25l[62;189H2[39;1H[?12l[?25h[?25l[62;189H1[38;1H[?12l[?25h[?25l[62;189H0[37;1H[?12l[?25h[?25l[62;188H49[36;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;189H7,1-8[34;8H[?12l[?25h[?25l[62;189H6[33;8H[?12l[?25h[?25l[62;189H5[32;8H[?12l[?25h[?25l[62;189H4[31;8H[?12l[?25h[?25l[62;189H3[30;8H[?12l[?25h[?25l[62;189H2[29;8H[?12l[?25h[?25l[62;189H1[28;8H[?12l[?25h[?25l[62;189H0,1  [27;1H[?12l[?25h[?25l[62;188H39[26;1H[?12l[?25h[?25l[62;189H8,1-8[25;8H[?12l[?25h[?25l[62;189H7,1  [24;1H[?12l[?25h[?25l[62;189H6[23;1H[?12l[?25h[?25l[62;189H5[22;1H[?12l[?25h[?25l[62;189H4[21;1H[?12l[?25h[?25l[62;189H3[20;1H[?12l[?25h[?25l[62;189H2,0-1[19;1H[?12l[?25h[?25l[62;189H1,1  [18;1H[?12l[?25h[?25l[62;189H0[17;1H[?12l[?25h[?25l[62;188H29[16;1H[?12l[?25h[?25l[62;189H8[15;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;189H6[13;1H[?12l[?25h[?25l[62;189H5[12;1H[?12l[?25h[?25l[62;189H4[11;1H[?12l[?25h[?25l[62;189H3[10;1H[?12l[?25h[?25l[62;189H2[9;1H[?12l[?25h[?25l[62;189H1[8;1H[?12l[?25h[?25l[62;189H0[7;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[62;189H8[5;1H[?12l[?25h[?25l[62;189H7[4;1H[?12l[?25h[?25l[62;189H6[3;1H[?12l[?25h[?25l[62;189H5[2;1H[?12l[?25h[?25l[62;189H4[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H313,0-1[7C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93melif[m devA <= -pi:[62;187H[K[62;187H311,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HdevA = devA - [95m2[m*pi[62;187H[K[62;187H310,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H307,0-1[7C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H306,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0[62;187H[K[62;187H305,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H304,1[9C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H303,0-1[7C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[62;187H[K[62;187H300,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m sub_oyaw >= pi:[62;187H[K[62;187H299,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[62;187H[K[62;187H298,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H297,0-1[7C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H296,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H293,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[62;187H[K[62;187H292,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H291,0-1[7C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HZip = [95m1[m[62;187H[K[62;187H290,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m AgainstWind:[62;187H[K[62;187H289,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H288,0-1[7C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[62;187H[K[62;187H286,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H285,0-1[7C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0    [96m# ***************************[m[62;187H[K[62;187H284,1[9C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H283,1[9C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H282,1[9C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H280,0-1[7C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H279,1[9C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hoyaw0 = computeoyaw(xy)[62;187H[K[62;187H278,1[9C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H277,0-1[7C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m#  goal position[m[62;187H[K[62;187H276,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][m[62;187H[K[62;187H275,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# auto triangle track[m[62;187H[K[62;187H273,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][62;187H[K[62;187H272,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H271,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;21Hnub = [95m0[m[62;187H[K[62;187H270,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HFlag0 = [1m[96mTrue[m[62;187H[K[62;187H268,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[62;187H[K[62;187H266,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[62;187H[K[62;187H265,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[62;187H[K[62;187H264,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H263,1[9C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H262,0-1[7C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H261,1[9C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H259,0-1[7C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[62;187H[K[62;187H258,1[9C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# TWA0 = sensor_submsg[3][m[62;187H[K[62;187H257,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[62;187H[K[62;187H256,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H254,0-1[7C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[m[62;187H[K[62;187H252,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[m[62;187H[K[62;187H251,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[m[62;187H[K[62;187H250,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[m[62;187H[K[62;187H249,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H248,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[m[62;187H[K[62;187H247,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[62;187H[K[62;187H245,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# todo[m[62;187H[K[62;187H244,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[62;187H[K[62;187H243,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mtry[m:[62;187H[K[62;187H242,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdsa = [95m0.1[m[62;187H[K[62;187H241,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdra = [95m0.01[m[62;187H[K[62;187H240,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hra = pi[62;187H[K[62;187H239,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsa = pi/[95m2[m[62;187H[K[62;187H238,1[9C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrate = rospy.Rate([95m10[m)[62;187H[K[62;187H237,1[9C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H236,0-1[7C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[62;187H[K[62;187H235,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H234,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H233,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hspare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hspare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)[62;187H[K[62;187H231,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)[62;187H[K[62;187H230,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H229,0-1[7C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[62;187H[K[62;187H228,1[9C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H227,1[9C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H226,0-1[7C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m rudangle[62;187H[K[62;187H225,1[9C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hrudangle = -pi/[95m6.0[m[62;187H[K[62;187H224,1[9C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m rudangle <= -pi/[95m6.0[m:[62;187H[K[62;187H223,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hrudangle = pi/[95m6.0[m[62;187H[K[62;187H222,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m rudangle >= pi/[95m6.0[m:[62;187H[K[62;187H221,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H220,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H219,0-1[7C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H218,0-1[7C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m sub_oyaw0[62;187H[K[62;187H217,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsub_oyaw0 = oyaw[62;187H[K[62;187H216,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HZip = [95m0[m[62;187H[K[62;187H215,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HturnR = [95m0[m[62;187H[K[62;187H214,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HturnL = [95m0[m[62;187H[K[62;187H213,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H212,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[62;187H[K[62;187H210,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[62;187H[K[62;187H209,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m sub_oyaw0 < [95m0[m:[62;187H[K[62;187H208,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H207,0-1[7C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H206,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melse[m:[62;187H[K[62;187H205,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m turnR == [95m1[m:[62;187H[K[62;187H203,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[62;187H[K[62;187H202,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m turnL == [95m1[m:[62;187H[K[62;187H201,1[9C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H200,0-1[7C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H199,1[9C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H198,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[62;187H[K[62;187H196,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m0[m[62;187H[K[62;187H195,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H194,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m1[m[62;187H[K[62;187H193,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[62;187H[K[62;187H192,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H191,0-1[7C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H189,1[9C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H188,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m Zip == [95m1[m:[62;187H[K[62;187H187,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H186,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m1[m[62;187H[K[62;187H185,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m0[m[62;187H[K[62;187H184,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H182,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H181,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H180,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H179,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m against_wind:[62;187H[K[62;187H178,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m turnR[62;187H[K[62;187H177,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m turnL[62;187H[K[62;187H176,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m Zip[62;187H[K[62;187H175,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):[62;187H[K[62;187H174,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H173,0-1[7C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H172,0-1[7C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m dev_distance[62;187H[K[62;187H171,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)[62;187H[K[62;187H170,1[9C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H168,0-1[7C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H167,0-1[7C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m against_wind[62;187H[K[62;187H166,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hagainst_wind = [1m[96mFalse[m[62;187H[K[62;187H165,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H164,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hagainst_wind = [1m[96mTrue[m[62;187H[K[62;187H163,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):[62;187H[K[62;187H161,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H160,0-1[7C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H159,0-1[7C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m angle_between_oyaw_twa[62;187H[K[62;187H158,1[9C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi[62;187H[K[62;187H157,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[62;187H[K[62;187H156,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hangle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):[62;187H[K[62;187H154,1[9C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H153,0-1[7C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H152,0-1[7C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m[62;187H[K[62;187H151,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])[62;187H[K[62;187H150,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H149,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m yaw0 >= pi:[62;187H[K[62;187H147,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[62;187H[K[62;187H146,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[62;187H[K[62;187H145,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))[62;187H[K[62;187H144,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[62;187H[K[62;187H143,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m[62;187H[K[62;187H142,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H141,0-1[7C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H140,0-1[7C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m twa0[62;187H[K[62;187H139,1[9C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = pi[62;187H[K[62;187H138,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H137,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m[62;187H[K[62;187H136,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m twa0 >= pi:[62;187H[K[62;187H135,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melif[m twa_ux < [95m0[m:[62;187H[K[62;187H133,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = math.atan(twa_uy / twa_ux)[62;187H[K[62;187H132,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m twa_ux > [95m0[m:[62;187H[K[62;187H131,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Htwa_uy = aws * math.sin(alpha) + vy[62;187H[K[62;187H130,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Htwa_ux = aws * math.cos(alpha) + ux[62;187H[K[62;187H129,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Halpha = alpha + [95m2[m * pi[62;187H[K[62;187H128,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Halpha = yaw + awa - pi[62;187H[K[62;187H126,1[9C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):[62;187H[K[62;187H125,1[9C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H124,0-1[7C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H123,0-1[7C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m sail_angle[62;187H[K[62;187H122,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)[62;187H[K[62;187H121,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H120,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsail_angle = [95m0[m[62;187H[K[62;187H119,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[62;187H[K[62;187H118,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_sail_angle[m(awa):[62;187H[K[62;187H117,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H116,0-1[7C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H115,0-1[7C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m config[62;187H[K[62;187H114,1[9C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m6[m] = config.sailI    [96m# pos1x[m[62;187H[K[62;187H112,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m5[m] = config.sailP    [96m# devD[m[62;187H[K[62;187H111,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m[62;187H[K[62;187H110,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m[62;187H[K[62;187H109,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m[62;187H[K[62;187H108,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m1[m] = config.oyaw[62;187H[K[62;187H107,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H105,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hpara_cfg[[95m0[m] = [95m1[m[62;187H[K[62;187H104,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[62;187H[K[62;187H103,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m para_cfg[62;187H[K[62;187H102,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m[62;187H[K[62;187H101,1[9C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H100,0-1[7C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H99,0-1[8C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[10C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H87,0-1[8C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H86,0-1[8C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[10C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H75,0-1[8C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H74,0-1[8C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[10C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H63,0-1[8C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H62,0-1[8C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m mach_pub[62;187H[K[62;187H61,1[10C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.PCCtrl = msg[[95m2[m][62;187H[K[62;187H60,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.sail   = msg[[95m1[m][62;187H[K[62;187H59,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.rudder = msg[[95m0[m][62;187H[K[62;187H58,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.motor = [95m57[m[62;187H[K[62;187H57,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[96m# mach_pub.timestamp = rospy.Time.now()[m[62;187H[K[62;187H56,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.header.frame_id = [95m'AHRS'[m[62;187H[K[62;187H55,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.header.stamp = rospy.Time.now()[62;187H[K[62;187H54,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub = Mach_msg()[62;187H[K[62;187H53,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutMachPut[m(msg):  [96m# sailboat_message::Mach_msg[m[62;187H[K[62;187H52,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H51,0-1[8C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hcount = [95m0[m[62;187H[K[62;187H50,1[10C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H49,0-1[8C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HAgainstWind0 = [1m[96mFalse[m[62;187H[K[62;187H48,1[10C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HAgainstWind = [1m[96mFalse[m[62;187H[K[62;187H47,1[10C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H46,0-1[8C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Htrack = [[95m20[m, -[95m10[m, -[95m30[m, [95m0[m, [95m0[m, [95m20[m]  [96m# [x0, y0, x1, y1, x2, y2][m[62;187H[K[62;187H45,1[10C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hnub = [95m0[m[62;187H[K[62;187H44,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H43,0-1[8C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hgoy = [95m0.1[m[62;187H[K[62;187H42,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hgox = [95m0.1[m[62;187H[K[62;187H41,1[10C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H40,0-1[8C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevD0 = [95m0.0[m[62;187H[K[62;187H39,1[10C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H38,0-1[8C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H37,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnR = [95m0[m[62;187H[K[62;187H36,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnL = [95m0[m[62;187H[K[62;187H35,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HZip = [95m1[m[62;187H[K[62;187H34,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HTWA0 = [95m1.0[m[62;187H[K[62;187H33,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H32,0-1[9C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HDer = [95m0.0[m[62;187H[K[62;187H31,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HIer = [95m0.0[m[62;187H[K[62;187H30,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HPer = [95m0.0[m[62;187H[K[62;187H29,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H28,0-1[9C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA0 = [95m0.0[m[62;187H[K[62;187H27,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA = [95m0.0[m[62;187H[K[62;187H26,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H25,0-1[9C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsub_oyaw = [95m190.0[m[62;187H[K[62;187H24,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw1 = oyaw0[62;187H[K[62;187H23,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw0 = [95m1.0[m[62;187H[K[62;187H22,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HY0 = -[95m3.0[m[62;187H[K[62;187H21,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HX0 = -[95m1.0[m[62;187H[K[62;187H20,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HsailA = [95m0.0[m[62;187H[K[62;187H19,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HrudA = [95m0.0[m[62;187H[K[62;187H18,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpara_cfg = [[95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m][62;187H[K[62;187H17,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsensor_submsg = [[95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m][62;187H[K[62;187H16,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H15,0-1[9C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpi = [95m3.14159[m[62;187H[K[62;187H14,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H13,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m math[62;187H[K[62;187H12,1[11C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H11,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m dynamic_reconfigure.server [38;5;81mimport[m Server[62;187H[K[62;187H10,1[11C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H9,0-1[10C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_para[62;187H[K[62;187H8,1[12C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_out[62;187H[K[62;187H7,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.cfg [38;5;81mimport[m spare_function_Config[62;187H[K[62;187H6,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H5,0-1[10C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg[62;187H[K[62;187H4,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Sensor_msg[62;187H[K[62;187H3,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m rospy[62;187H[K[62;187H2,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[96m#!/usr/bin/env python[m[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H2[2;1H[?12l[?25h[?25l[62;187H3[3;1H[?12l[?25h[?25l[62;187H4[4;1H[?12l[?25h[?25l[62;187H5,0-1[5;1H[?12l[?25h[?25l[62;187H6,1  [6;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H8[8;1H[?12l[?25h[?25l[62;187H9,0-1[9;1H[?12l[?25h[?25l[62;187H10,1 [10;1H[?12l[?25h[?25l[62;188H1,0-1[11;1H[?12l[?25h[?25l[62;188H2,1  [12;1H[?12l[?25h[?25l[62;188H3,0-1[13;1H[?12l[?25h[?25l[62;188H4,1  [14;1H[?12l[?25h[?25l[62;188H5,0-1[15;1H[?12l[?25h[?25l[62;188H6,1  [16;1H[?12l[?25h[?25l[62;188H7[17;1H[?12l[?25h[?25l[62;188H8[18;1H[?12l[?25h[?25l[62;188H9[19;1H[?12l[?25h[?25l[62;187H20[20;1H[?12l[?25h[?25l[62;188H1[21;1H[?12l[?25h[?25l[62;188H2[22;1H[?12l[?25h[?25l[62;188H3[23;1H[?12l[?25h[?25l[62;188H4[24;1H[?12l[?25h[?25l[62;188H5,0-1[25;1H[?12l[?25h[?25l[62;188H6,1  [26;1H[?12l[?25h[?25l[62;188H7[27;1H[?12l[?25h[?25l[62;188H8,0-1[28;1H[?12l[?25h[?25l[62;188H9,1  [29;1H[?12l[?25h[?25l[62;187H30[30;1H[?12l[?25h[?25l[62;188H1[31;1H[?12l[?25h[?25l[62;188H2,0-1[32;1H[?12l[?25h[?25l[62;188H3,1  [33;1H[?12l[?25h[?25l[62;188H4[34;1H[?12l[?25h[?25l[62;188H5[35;1H[?12l[?25h[?25l[62;188H6[36;1H[?12l[?25h[?25l[62;188H7[37;1H[?12l[?25h[?25l[62;188H8,0-1[38;1H[?12l[?25h[?25l[62;188H9,1  [39;1H[?12l[?25h[?25l[62;187H40,0-1[40;1H[?12l[?25h[?25l[62;188H1,1  [41;1H[?12l[?25h[?25l[62;188H2[42;1H[?12l[?25h[?25l[62;188H3,0-1[43;1H[?12l[?25h[?25l[62;188H4,1  [44;1H[?12l[?25h[?25l[62;188H5[45;1H[?12l[?25h[?25l[62;188H6,0-1[46;1H[?12l[?25h[?25l[62;188H7,1  [47;1H[?12l[?25h[?25l[62;188H8[48;1H[?12l[?25h[?25l[62;188H9,0-1[49;1H[?12l[?25h[?25l[62;187H50,1  [50;1H[?12l[?25h[?25l[62;188H1,0-1[51;1H[?12l[?25h[?25l[62;188H2,1  [52;1H[?12l[?25h[?25l[62;188H3[53;1H[?12l[?25h[?25l[62;188H4[54;1H[?12l[?25h[?25l[62;188H5[55;1H[?12l[?25h[?25l[62;188H6[56;1H[?12l[?25h[?25l[62;188H7[57;1H[?12l[?25h[?25l[62;188H8[58;1H[?12l[?25h[?25l[62;188H9[59;1H[?12l[?25h[?25l[62;187H60[60;1H[?12l[?25h[?25l[62;188H1[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H62,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H63,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[11C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H74,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H75,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H86,0-1[9C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H87,0-1[9C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H99,0-1[8C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H100,0-1[7C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m[62;187H[K[62;187H101,1[9C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m para_cfg[62;187H[K[62;187H102,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[62;187H[K[62;187H103,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m1[m[62;187H[K[62;187H104,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H105,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m1[m] = config.oyaw[62;187H[K[62;187H107,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m[62;187H[K[62;187H108,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m[62;187H[K[62;187H109,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m[62;187H[K[62;187H110,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m5[m] = config.sailP    [96m# devD[m[62;187H[K[62;187H111,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m6[m] = config.sailI    [96m# pos1x[m[62;187H[K[62;187H112,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m config[62;187H[K[62;187H114,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H115,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H116,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sail_angle[m(awa):[62;187H[K[62;187H117,1[9C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[62;187H[K[62;187H118,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = [95m0[m[62;187H[K[62;187H119,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H120,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)[62;187H[K[62;187H121,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sail_angle[62;187H[K[62;187H122,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H123,0-1[7C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H124,0-1[7C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):[62;187H[K[62;187H125,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Halpha = yaw + awa - pi[62;187H[K[62;187H126,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Halpha = alpha + [95m2[m * pi[62;187H[K[62;187H128,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_ux = aws * math.cos(alpha) + ux[62;187H[K[62;187H129,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_uy = aws * math.sin(alpha) + vy[62;187H[K[62;187H130,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m twa_ux > [95m0[m:[62;187H[K[62;187H131,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux)[62;187H[K[62;187H132,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m twa_ux < [95m0[m:[62;187H[K[62;187H133,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m twa0 >= pi:[62;187H[K[62;187H135,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m[62;187H[K[62;187H136,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H137,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = pi[62;187H[K[62;187H138,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m twa0[62;187H[K[62;187H139,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H140,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H141,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m[62;187H[K[62;187H142,1[9C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[62;187H[K[62;187H143,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))[62;187H[K[62;187H144,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[62;187H[K[62;187H145,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[62;187H[K[62;187H146,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m yaw0 >= pi:[62;187H[K[62;187H147,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H149,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])[62;187H[K[62;187H150,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m[62;187H[K[62;187H151,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H152,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H153,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):[62;187H[K[62;187H154,1[9C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hangle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[62;187H[K[62;187H156,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi[62;187H[K[62;187H157,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m angle_between_oyaw_twa[62;187H[K[62;187H158,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H159,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H160,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):[62;187H[K[62;187H161,1[9C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mTrue[m[62;187H[K[62;187H163,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H164,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mFalse[m[62;187H[K[62;187H165,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m against_wind[62;187H[K[62;187H166,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H167,0-1[7C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H168,0-1[7C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)[62;187H[K[62;187H170,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m dev_distance[62;187H[K[62;187H171,1[9C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H172,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H173,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):[62;187H[K[62;187H174,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m Zip[62;187H[K[62;187H175,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnL[62;187H[K[62;187H176,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnR[62;187H[K[62;187H177,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m against_wind:[62;187H[K[62;187H178,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H179,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H180,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H181,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H182,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H184,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H185,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H186,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m Zip == [95m1[m:[62;187H[K[62;187H187,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H188,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H189,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H191,0-1[7C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[62;187H[K[62;187H192,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H193,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H194,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H195,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[62;187H[K[62;187H196,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H198,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H199,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H200,0-1[7C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m turnL == [95m1[m:[62;187H[K[62;187H201,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[62;187H[K[62;187H202,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m turnR == [95m1[m:[62;187H[K[62;187H203,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melse[m:[62;187H[K[62;187H205,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H206,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H207,0-1[7C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m sub_oyaw0 < [95m0[m:[62;187H[K[62;187H208,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[62;187H[K[62;187H209,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[62;187H[K[62;187H210,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H212,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnL = [95m0[m[62;187H[K[62;187H213,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnR = [95m0[m[62;187H[K[62;187H214,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HZip = [95m0[m[62;187H[K[62;187H215,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsub_oyaw0 = oyaw[62;187H[K[62;187H216,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sub_oyaw0[62;187H[K[62;187H217,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H218,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H219,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H220,1[9C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle >= pi/[95m6.0[m:[62;187H[K[62;187H221,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = pi/[95m6.0[m[62;187H[K[62;187H222,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle <= -pi/[95m6.0[m:[62;187H[K[62;187H223,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = -pi/[95m6.0[m[62;187H[K[62;187H224,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m rudangle[62;187H[K[62;187H225,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H226,0-1[7C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H227,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[62;187H[K[62;187H228,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H229,0-1[7C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)[62;187H[K[62;187H230,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)[62;187H[K[62;187H231,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H233,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H234,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[62;187H[K[62;187H235,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H236,0-1[7C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrate = rospy.Rate([95m10[m)[62;187H[K[62;187H237,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsa = pi/[95m2[m[62;187H[K[62;187H238,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hra = pi[62;187H[K[62;187H239,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdra = [95m0.01[m[62;187H[K[62;187H240,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdsa = [95m0.1[m[62;187H[K[62;187H241,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mtry[m:[62;187H[K[62;187H242,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[62;187H[K[62;187H243,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# todo[m[62;187H[K[62;187H244,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[62;187H[K[62;187H245,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[m[62;187H[K[62;187H247,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H248,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[m[62;187H[K[62;187H249,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[m[62;187H[K[62;187H250,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[m[62;187H[K[62;187H251,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[m[62;187H[K[62;187H252,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H254,0-1[7C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[62;187H[K[62;187H256,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# TWA0 = sensor_submsg[3][m[62;187H[K[62;187H257,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[62;187H[K[62;187H258,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H259,0-1[7C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H261,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H262,0-1[7C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H263,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[62;187H[K[62;187H264,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[62;187H[K[62;187H265,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[62;187H[K[62;187H266,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mTrue[m[62;187H[K[62;187H268,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;21Hnub = [95m0[m[62;187H[K[62;187H270,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H271,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][62;187H[K[62;187H272,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# auto triangle track[m[62;187H[K[62;187H273,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][m[62;187H[K[62;187H275,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m#  goal position[m[62;187H[K[62;187H276,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H277,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hoyaw0 = computeoyaw(xy)[62;187H[K[62;187H278,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H279,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H280,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H282,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H283,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0    [96m# ***************************[m[62;187H[K[62;187H284,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H285,0-1[7C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[62;187H[K[62;187H286,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H288,0-1[7C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind:[62;187H[K[62;187H289,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HZip = [95m1[m[62;187H[K[62;187H290,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H291,0-1[7C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[62;187H[K[62;187H292,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H293,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H296,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H297,0-1[7C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[62;187H[K[62;187H298,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sub_oyaw >= pi:[62;187H[K[62;187H299,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[62;187H[K[62;187H300,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H303,0-1[7C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H304,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H305,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H306,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H307,0-1[7C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA - [95m2[m*pi[62;187H[K[62;187H310,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA <= -pi:[62;187H[K[62;187H311,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H313,0-1[7C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m - pi/[95m2.0[m <= devA <= pi/[95m2.0[m:[62;187H[K[62;187H314,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HPer = devA[62;187H[K[62;187H315,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = Ier + devA[62;187H[K[62;187H316,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HDer = devA - devA0[62;187H[K[62;187H317,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier >= [95m15.0[m:  Ier = [95m15.0[m[62;187H[K[62;187H318,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier <= -[95m15.0[m:  Ier = -[95m15.0[m[62;187H[K[62;187H319,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# rudA = -(para_cfg[2] * Per + para_cfg[3] * (Ier + para_cfg[4]/para_cfg[2] * Der) + para_cfg[4] * Der)[m[62;187H[K[62;187H320,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -(para_cfg[[95m2[m] * Per + para_cfg[[95m3[m] * Ier + para_cfg[[95m4[m] * Der)[62;187H[K[62;187H321,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = rudAlim(rudA)   [96m# limit the rudder's maximum angle to pi/6[m[62;187H[K[62;187H322,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = devA[62;187H[K[62;187H323,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA > [95m0[m:[62;187H[K[62;187H324,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -[95m1.0[m * pi / [95m6.0[m[62;187H[K[62;187H325,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H326,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H327,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melse[m:[62;187H[K[62;187H328,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = pi / [95m6.0[m[62;187H[K[62;187H329,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H330,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H331,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H332,0-1[7C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_np = [para_cfg[[95m5[m], para_cfg[[95m6[m], [95m1[m][62;187H[K[62;187H333,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [length, TWA0*180/pi, devA*180/pi, devD, oyaw1*180/pi, sub_oyaw*180/pi, sensor_submsg[1]*180/pi][m[62;187H[K[62;187H334,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsa += dsa[62;187H[K[62;187H335,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hra += dra[62;187H[K[62;187H336,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa >= pi:[62;187H[K[62;187H337,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = -[95m0.05[m[62;187H[K[62;187H338,1-8[7C88%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa <= [95m0[m:[62;187H[K[62;187H339,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = [95m0.05[m[62;187H[K[62;187H340,1[9C89%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra >= [95m90.0[m/[95m180.0[m*pi:[62;187H[K[62;187H341,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = -[95m0.01[m[62;187H[K[62;187H342,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra <= [95m75.0[m/[95m180.0[m*pi:[62;187H[K[62;187H343,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = [95m0.01[m[62;187H[K[62;187H344,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H345,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H346,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_np = [length, AngleOytw * [95m180[m / pi, turnR, devD, turnL, sub_oyaw * [95m180[m / pi, sensor_submsg[[95m1[m] * [95m180[m / pi]  [96m# test************************************************[m[62;187H[K[62;187H347,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [rudA*180/pi, sailA, ][m[62;187H[K[62;187H348,1[9C91%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.rudder = msg[0][m[62;187H[K[62;187H349,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.sail = msg[1][m[62;187H[K[62;187H350,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationA = msg[2][m[62;187H[K[62;187H351,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationD = msg[3][m[62;187H[K[62;187H352,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.oyaw0 = msg[4]            # out_pub.suboyaw0 = msg[5][m[62;187H[K[62;187H353,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.Yaw = msg[6][m[62;187H[K[62;187H354,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# para_np = [0,0,0,0,0,0,0][m[62;187H[K[62;187H355,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m#[m[62;187H[K[62;187H356,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# input : sensor_submsg [m[62;187H[K[62;187H357,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# cfg: para_cfg[m[62;187H[K[62;187H358,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# output : mach_np out_np para_np[m[62;187H[K[62;187H359,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H360,0-1[7C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pubmsg = getOutMachPut(mach_np)[62;187H[K[62;187H361,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_pubmsg = getOutput(out_np)[62;187H[K[62;187H362,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hpara_pubmsg = getOutParaPut(para_cfg)[62;187H[K[62;187H363,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H364,0-1[7C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pub.publish(mach_pubmsg)[62;187H[K[62;187H365,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_pub.publish(out_pubmsg)[62;187H[K[62;187H366,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_para_pub.publish(para_pubmsg)[62;187H[K[62;187H367,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H368,0-1[7C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hrate.sleep()[62;187H[K[62;187H369,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mexcept[m rospy.ROSInterruptException:[62;187H[K[62;187H370,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mpass[m[62;187H[K[62;187H371,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[96m#finally:[m[62;187H[K[62;187H372,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[96m#close()[m[62;187H[K[62;187H373,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.spin()[62;187H[K[62;187H374,1[9CBot[61;1H[?12l[?25h[?25l[62;189H3[60;1H[?12l[?25h[?25l[62;189H2[59;1H[?12l[?25h[?25l[62;189H1[58;1H[?12l[?25h[?25l[62;189H0[57;1H[?12l[?25h[?25l[62;188H69[56;1H[?12l[?25h[?25l[62;189H8,0-1[55;1H[?12l[?25h[?25l[62;189H7,1  [54;1H[?12l[?25h[?25l[62;189H6[53;1H[?12l[?25h[?25l[62;189H5[52;1H[?12l[?25h[?25l[62;189H4,0-1[51;1H[?12l[?25h[?25l[62;189H3,1  [50;1H[?12l[?25h[?25l[62;189H2[49;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;189H0,0-1[47;1H[?12l[?25h[?25l[62;188H59,1  [46;1H[?12l[?25h[?25l[62;189H8[45;1H[?12l[?25h[?25l[62;189H7[44;1H[?12l[?25h[?25l[62;189H6[43;1H[?12l[?25h[?25l[62;189H5[42;1H[?12l[?25h[?25l[62;189H4[41;1H[?12l[?25h[?25l[62;189H3[40;1H[?12l[?25h[?25l[62;189H2[39;1H[?12l[?25h[?25l[62;189H1[38;1H[?12l[?25h[?25l[62;189H0[37;1H[?12l[?25h[?25l[62;188H49[36;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;189H7,1-8[34;8H[?12l[?25h[?25l[62;189H6[33;8H[?12l[?25h[?25l[62;189H5[32;8H[?12l[?25h[?25l[62;189H4[31;8H[?12l[?25h[?25l[62;189H3[30;8H[?12l[?25h[?25l[62;189H2[29;8H[?12l[?25h[?25l[62;189H1[28;8H[?12l[?25h[?25l[62;189H0,1  [27;1H[?12l[?25h[?25l[62;189H1,1-8[28;8H[?12l[?25h[?25l[62;189H2[29;8H[?12l[?25h[?25l[62;189H3[30;8H[?12l[?25h[?25l[62;189H4[31;8H[?12l[?25h[?25l[62;189H5[32;8H[?12l[?25h[?25l[62;189H6[33;8H[?12l[?25h[?25l[62;189H7[34;8H[?12l[?25h[?25l[62;189H8,1  [35;1H[?12l[?25h[?25l[62;189H9[36;1H[?12l[?25h[?25l[62;188H50[37;1H[?12l[?25h[?25l[62;189H1[38;1H[?12l[?25h[?25l[62;189H2[39;1H[?12l[?25h[?25l[62;189H3[40;1H[?12l[?25h[?25l[62;189H4[41;1H[?12l[?25h[?25l[62;189H5[42;1H[?12l[?25h[?25l[62;189H6[43;1H[?12l[?25h[?25l[62;189H7[44;1H[?12l[?25h[?25l[62;189H8[45;1H[?12l[?25h[?25l[62;189H9[46;1H[?12l[?25h[?25l[62;188H60,0-1[47;1H[?12l[?25h[?25l[62;189H1,1  [48;1H[?12l[?25h[?25l[62;189H2[49;1H[?12l[?25h[?25l[62;189H3[50;1H[?12l[?25h[?25l[62;189H4,0-1[51;1H[?12l[?25h[?25l[62;189H5,1  [52;1H[?12l[?25h[?25l[62;189H6[53;1H[?12l[?25h[?25l[62;189H7[54;1H[?12l[?25h[?25l[62;189H8,0-1[55;1H[?12l[?25h[?25l[62;189H9,1  [56;1H[?12l[?25h[?25l[62;188H70[57;1H[?12l[?25h[?25l[62;189H1[58;1H[?12l[?25h[?25l[62;189H2[59;1H[?12l[?25h[?25l[62;189H3[60;1H[?12l[?25h[?25l[62;189H4[61;1H[?12l[?25h[?25l[62;189H3[60;1H[?12l[?25h[?25l[62;189H2[59;1H[?12l[?25h[?25l[62;189H1[58;1H[?12l[?25h[?25l[62;189H0[57;1H[?12l[?25h[?25l[62;188H69[56;1H[?12l[?25h[?25l[62;189H8,0-1[55;1H[?12l[?25h[?25l[62;189H7,1  [54;1H[?12l[?25h[?25l[62;189H6[53;1H[?12l[?25h[?25l[62;189H5[52;1H[?12l[?25h[?25l[62;189H4,0-1[51;1H[?12l[?25h[?25l[62;189H3,1  [50;1H[?12l[?25h[?25l[62;189H2[49;1H[?12l[?25h[?25l[62;189H1[48;1H[?12l[?25h[?25l[62;189H0,0-1[47;1H[?12l[?25h[?25l[62;188H59,1  [46;1H[?12l[?25h[?25l[62;189H8[45;1H[?12l[?25h[?25l[62;189H7[44;1H[?12l[?25h[?25l[62;189H6[43;1H[?12l[?25h[?25l[62;189H5[42;1H[?12l[?25h[?25l[62;189H4[41;1H[?12l[?25h[?25l[62;189H3[40;1H[?12l[?25h[?25l[62;189H2[39;1H[?12l[?25h[?25l[62;189H1[38;1H[?12l[?25h[?25l[62;189H0[37;1H[?12l[?25h[?25l[62;188H49[36;1H[?12l[?25h[?25l[62;189H8[35;1H[?12l[?25h[?25l[62;189H7,1-8[34;8H[?12l[?25h[?25l[62;189H6[33;8H[?12l[?25h[?25l[62;189H5[32;8H[?12l[?25h[?25l[62;189H4[31;8H[?12l[?25h[?25l[62;189H3[30;8H[?12l[?25h[?25l[62;189H2[29;8H[?12l[?25h[?25l[62;189H1[28;8H[?12l[?25h[?25l[62;189H0,1  [27;1H[?12l[?25h[?25l[62;188H39[26;1H[?12l[?25h[?25l[62;189H8,1-8[25;8H[?12l[?25h[?25l[62;189H7,1  [24;1H[?12l[?25h[?25l[62;189H6[23;1H[?12l[?25h[?25l[62;189H5[22;1H[?12l[?25h[?25l[62;189H4[21;1H[?12l[?25h[?25l[62;189H3[20;1H[?12l[?25h[?25l[62;189H2,0-1[19;1H[?12l[?25h[?25l[62;189H1,1  [18;1H[?12l[?25h[?25l[62;189H0[17;1H[?12l[?25h[?25l[62;188H29[16;1H[?12l[?25h[?25l[62;189H8[15;1H[?12l[?25h[?25l[62;189H7[14;1H[?12l[?25h[?25l[62;189H6[13;1H[?12l[?25h[?25l[62;189H5[12;1H[?12l[?25h[?25l[62;189H4[11;1H[?12l[?25h[?25l[62;189H3[10;1H[?12l[?25h[?25l[62;189H2[9;1H[?12l[?25h[?25l[62;189H1[8;1H[?12l[?25h[?25l[62;189H0[7;1H[?12l[?25h[?25l[62;188H19[6;1H[?12l[?25h[?25l[62;189H8[5;1H[?12l[?25h[?25l[62;189H7[4;1H[?12l[?25h[?25l[62;189H6[3;1H[?12l[?25h[?25l[62;189H5[2;1H[?12l[?25h[?25l[62;189H4[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H313,0-1[7C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93melif[m devA <= -pi:[62;187H[K[62;187H311,1[9C99%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HdevA = devA - [95m2[m*pi[62;187H[K[62;187H310,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,1[9C98%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H307,0-1[7C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H306,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0[62;187H[K[62;187H305,1[9C97%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H304,1[9C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H303,0-1[7C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C96%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[62;187H[K[62;187H300,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m sub_oyaw >= pi:[62;187H[K[62;187H299,1[9C95%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[62;187H[K[62;187H298,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H297,0-1[7C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H296,1[9C94%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H293,1[9C93%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[62;187H[K[62;187H292,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H291,0-1[7C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HZip = [95m1[m[62;187H[K[62;187H290,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m AgainstWind:[62;187H[K[62;187H289,1[9C92%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H288,0-1[7C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[62;187H[K[62;187H286,1[9C91%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H285,0-1[7C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hoyaw1 = oyaw0    [96m# ***************************[m[62;187H[K[62;187H284,1[9C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H283,1[9C90%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H282,1[9C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H280,0-1[7C89%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H279,1[9C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hoyaw0 = computeoyaw(xy)[62;187H[K[62;187H278,1[9C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H277,0-1[7C88%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m#  goal position[m[62;187H[K[62;187H276,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][m[62;187H[K[62;187H275,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C87%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[96m# auto triangle track[m[62;187H[K[62;187H273,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][62;187H[K[62;187H272,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H271,1[9C86%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;21Hnub = [95m0[m[62;187H[K[62;187H270,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17HFlag0 = [1m[96mTrue[m[62;187H[K[62;187H268,1[9C85%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[62;187H[K[62;187H266,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[62;187H[K[62;187H265,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[62;187H[K[62;187H264,1[9C84%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H263,1[9C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H262,0-1[7C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H261,1[9C83%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H259,0-1[7C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[62;187H[K[62;187H258,1[9C82%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# TWA0 = sensor_submsg[3][m[62;187H[K[62;187H257,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[62;187H[K[62;187H256,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C81%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H254,0-1[7C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[m[62;187H[K[62;187H252,1[9C80%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[m[62;187H[K[62;187H251,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[m[62;187H[K[62;187H250,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[m[62;187H[K[62;187H249,1[9C79%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H248,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[m[62;187H[K[62;187H247,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C78%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[62;187H[K[62;187H245,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13H[96m# todo[m[62;187H[K[62;187H244,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[62;187H[K[62;187H243,1[9C77%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mtry[m:[62;187H[K[62;187H242,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdsa = [95m0.1[m[62;187H[K[62;187H241,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdra = [95m0.01[m[62;187H[K[62;187H240,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hra = pi[62;187H[K[62;187H239,1[9C76%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsa = pi/[95m2[m[62;187H[K[62;187H238,1[9C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrate = rospy.Rate([95m10[m)[62;187H[K[62;187H237,1[9C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H236,0-1[7C75%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[62;187H[K[62;187H235,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H234,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H233,1[9C74%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hspare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hspare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)[62;187H[K[62;187H231,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)[62;187H[K[62;187H230,1[9C73%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H229,0-1[7C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[62;187H[K[62;187H228,1[9C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H227,1[9C72%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H226,0-1[7C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m rudangle[62;187H[K[62;187H225,1[9C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hrudangle = -pi/[95m6.0[m[62;187H[K[62;187H224,1[9C71%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m rudangle <= -pi/[95m6.0[m:[62;187H[K[62;187H223,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hrudangle = pi/[95m6.0[m[62;187H[K[62;187H222,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m rudangle >= pi/[95m6.0[m:[62;187H[K[62;187H221,1[9C70%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H220,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H219,0-1[7C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H218,0-1[7C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m sub_oyaw0[62;187H[K[62;187H217,1[9C69%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsub_oyaw0 = oyaw[62;187H[K[62;187H216,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HZip = [95m0[m[62;187H[K[62;187H215,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HturnR = [95m0[m[62;187H[K[62;187H214,1[9C68%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9HturnL = [95m0[m[62;187H[K[62;187H213,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H212,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C67%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[62;187H[K[62;187H210,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[62;187H[K[62;187H209,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m sub_oyaw0 < [95m0[m:[62;187H[K[62;187H208,1[9C66%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H207,0-1[7C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H206,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melse[m:[62;187H[K[62;187H205,1[9C65%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m turnR == [95m1[m:[62;187H[K[62;187H203,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[62;187H[K[62;187H202,1[9C64%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m turnL == [95m1[m:[62;187H[K[62;187H201,1[9C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H200,0-1[7C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H199,1[9C63%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H198,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[62;187H[K[62;187H196,1[9C62%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m0[m[62;187H[K[62;187H195,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H194,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m1[m[62;187H[K[62;187H193,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[62;187H[K[62;187H192,1[9C61%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H191,0-1[7C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H189,1[9C60%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H188,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m Zip == [95m1[m:[62;187H[K[62;187H187,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H186,1[9C59%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m1[m[62;187H[K[62;187H185,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m0[m[62;187H[K[62;187H184,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C58%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HZip = [95m0[m[62;187H[K[62;187H182,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnL = [95m0[m[62;187H[K[62;187H181,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13HturnR = [95m1[m[62;187H[K[62;187H180,1[9C57%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H179,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m against_wind:[62;187H[K[62;187H178,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m turnR[62;187H[K[62;187H177,1[9C56%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m turnL[62;187H[K[62;187H176,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m Zip[62;187H[K[62;187H175,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):[62;187H[K[62;187H174,1[9C55%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H173,0-1[7C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H172,0-1[7C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m dev_distance[62;187H[K[62;187H171,1[9C54%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)[62;187H[K[62;187H170,1[9C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H168,0-1[7C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H167,0-1[7C53%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m against_wind[62;187H[K[62;187H166,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hagainst_wind = [1m[96mFalse[m[62;187H[K[62;187H165,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H164,1[9C52%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hagainst_wind = [1m[96mTrue[m[62;187H[K[62;187H163,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):[62;187H[K[62;187H161,1[9C51%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H160,0-1[7C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H159,0-1[7C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m angle_between_oyaw_twa[62;187H[K[62;187H158,1[9C50%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi[62;187H[K[62;187H157,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[62;187H[K[62;187H156,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hangle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C49%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):[62;187H[K[62;187H154,1[9C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H153,0-1[7C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H152,0-1[7C48%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m[62;187H[K[62;187H151,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])[62;187H[K[62;187H150,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H149,1[9C47%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m yaw0 >= pi:[62;187H[K[62;187H147,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[62;187H[K[62;187H146,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[62;187H[K[62;187H145,1[9C46%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))[62;187H[K[62;187H144,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[62;187H[K[62;187H143,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m[62;187H[K[62;187H142,1[9C45%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H141,0-1[7C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H140,0-1[7C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m twa0[62;187H[K[62;187H139,1[9C44%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = pi[62;187H[K[62;187H138,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H137,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m[62;187H[K[62;187H136,1[9C43%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9H[93mif[m twa0 >= pi:[62;187H[K[62;187H135,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melif[m twa_ux < [95m0[m:[62;187H[K[62;187H133,1[9C42%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Htwa0 = math.atan(twa_uy / twa_ux)[62;187H[K[62;187H132,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m twa_ux > [95m0[m:[62;187H[K[62;187H131,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Htwa_uy = aws * math.sin(alpha) + vy[62;187H[K[62;187H130,1[9C41%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Htwa_ux = aws * math.cos(alpha) + ux[62;187H[K[62;187H129,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Halpha = alpha + [95m2[m * pi[62;187H[K[62;187H128,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C40%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Halpha = yaw + awa - pi[62;187H[K[62;187H126,1[9C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):[62;187H[K[62;187H125,1[9C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H124,0-1[7C39%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H123,0-1[7C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m sail_angle[62;187H[K[62;187H122,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)[62;187H[K[62;187H121,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H120,1[9C38%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hsail_angle = [95m0[m[62;187H[K[62;187H119,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[62;187H[K[62;187H118,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mcompute_sail_angle[m(awa):[62;187H[K[62;187H117,1[9C37%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H116,0-1[7C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H115,0-1[7C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m config[62;187H[K[62;187H114,1[9C36%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m6[m] = config.sailI    [96m# pos1x[m[62;187H[K[62;187H112,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m5[m] = config.sailP    [96m# devD[m[62;187H[K[62;187H111,1[9C35%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m[62;187H[K[62;187H110,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m[62;187H[K[62;187H109,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m[62;187H[K[62;187H108,1[9C34%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_cfg[[95m1[m] = config.oyaw[62;187H[K[62;187H107,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93melse[m:[62;187H[K[62;187H105,1[9C33%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;9Hpara_cfg[[95m0[m] = [95m1[m[62;187H[K[62;187H104,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[62;187H[K[62;187H103,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m para_cfg[62;187H[K[62;187H102,1[9C32%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m[62;187H[K[62;187H101,1[9C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H100,0-1[7C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H99,0-1[8C31%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C30%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[10C29%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[10C28%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[10C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H87,0-1[8C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H86,0-1[8C27%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[10C26%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[10C25%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[10C24%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[10C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H75,0-1[8C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H74,0-1[8C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[10C23%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[10C22%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[10C21%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[10C20%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H63,0-1[8C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H62,0-1[8C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[93mreturn[m mach_pub[62;187H[K[62;187H61,1[10C19%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.PCCtrl = msg[[95m2[m][62;187H[K[62;187H60,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.sail   = msg[[95m1[m][62;187H[K[62;187H59,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.rudder = msg[[95m0[m][62;187H[K[62;187H58,1[10C18%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.motor = [95m57[m[62;187H[K[62;187H57,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5H[96m# mach_pub.timestamp = rospy.Time.now()[m[62;187H[K[62;187H56,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.header.frame_id = [95m'AHRS'[m[62;187H[K[62;187H55,1[10C17%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub.header.stamp = rospy.Time.now()[62;187H[K[62;187H54,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;5Hmach_pub = Mach_msg()[62;187H[K[62;187H53,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[93mdef[m [1m[96mgetOutMachPut[m(msg):  [96m# sailboat_message::Mach_msg[m[62;187H[K[62;187H52,1[10C16%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H51,0-1[8C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hcount = [95m0[m[62;187H[K[62;187H50,1[10C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H49,0-1[8C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HAgainstWind0 = [1m[96mFalse[m[62;187H[K[62;187H48,1[10C15%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HAgainstWind = [1m[96mFalse[m[62;187H[K[62;187H47,1[10C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H46,0-1[8C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Htrack = [[95m20[m, -[95m10[m, -[95m30[m, [95m0[m, [95m0[m, [95m20[m]  [96m# [x0, y0, x1, y1, x2, y2][m[62;187H[K[62;187H45,1[10C14%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hnub = [95m0[m[62;187H[K[62;187H44,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H43,0-1[8C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hgoy = [95m0.1[m[62;187H[K[62;187H42,1[10C13%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hgox = [95m0.1[m[62;187H[K[62;187H41,1[10C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H40,0-1[8C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevD0 = [95m0.0[m[62;187H[K[62;187H39,1[10C12%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H38,0-1[8C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H37,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnR = [95m0[m[62;187H[K[62;187H36,1[10C11%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HturnL = [95m0[m[62;187H[K[62;187H35,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HZip = [95m1[m[62;187H[K[62;187H34,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HTWA0 = [95m1.0[m[62;187H[K[62;187H33,1[10C10%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H32,0-1[9C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HDer = [95m0.0[m[62;187H[K[62;187H31,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HIer = [95m0.0[m[62;187H[K[62;187H30,1[11C9%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HPer = [95m0.0[m[62;187H[K[62;187H29,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H28,0-1[9C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA0 = [95m0.0[m[62;187H[K[62;187H27,1[11C8%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HdevA = [95m0.0[m[62;187H[K[62;187H26,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H25,0-1[9C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsub_oyaw = [95m190.0[m[62;187H[K[62;187H24,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw1 = oyaw0[62;187H[K[62;187H23,1[11C7%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hoyaw0 = [95m1.0[m[62;187H[K[62;187H22,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HY0 = -[95m3.0[m[62;187H[K[62;187H21,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HX0 = -[95m1.0[m[62;187H[K[62;187H20,1[11C6%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HsailA = [95m0.0[m[62;187H[K[62;187H19,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1HrudA = [95m0.0[m[62;187H[K[62;187H18,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpara_cfg = [[95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m, [95m0[m][62;187H[K[62;187H17,1[11C5%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hsensor_submsg = [[95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m, [95m0.0[m][62;187H[K[62;187H16,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H15,0-1[9C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1Hpi = [95m3.14159[m[62;187H[K[62;187H14,1[11C4%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H13,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m math[62;187H[K[62;187H12,1[11C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H11,0-1[9C3%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m dynamic_reconfigure.server [38;5;81mimport[m Server[62;187H[K[62;187H10,1[11C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H9,0-1[10C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_para[62;187H[K[62;187H8,1[12C2%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.msg [38;5;81mimport[m spare_function_out[62;187H[K[62;187H7,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m spare_function.cfg [38;5;81mimport[m spare_function_Config[62;187H[K[62;187H6,1[12C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[62;187H[K[62;187H5,0-1[10C1%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Mach_msg[62;187H[K[62;187H4,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mfrom[m sailboat_message.msg [38;5;81mimport[m Sensor_msg[62;187H[K[62;187H3,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[38;5;81mimport[m rospy[62;187H[K[62;187H2,1[12C0%[1;1H[?12l[?25h[?25l[1;61r[1;1H[L[1;62r[1;1H[96m#!/usr/bin/env python[m[62;187H[K[62;187H1,1[11CTop[1;1H[?12l[?25h[?25l[62;187H2[2;1H[?12l[?25h[?25l[62;187H3[3;1H[?12l[?25h[?25l[62;187H4[4;1H[?12l[?25h[?25l[62;187H5,0-1[5;1H[?12l[?25h[?25l[62;187H6,1  [6;1H[?12l[?25h[?25l[62;187H7[7;1H[?12l[?25h[?25l[62;187H8[8;1H[?12l[?25h[?25l[62;187H9,0-1[9;1H[?12l[?25h[?25l[62;187H10,1 [10;1H[?12l[?25h[?25l[62;188H1,0-1[11;1H[?12l[?25h[?25l[62;188H2,1  [12;1H[?12l[?25h[?25l[62;188H3,0-1[13;1H[?12l[?25h[?25l[62;188H4,1  [14;1H[?12l[?25h[?25l[62;188H5,0-1[15;1H[?12l[?25h[?25l[62;188H6,1  [16;1H[?12l[?25h[?25l[62;188H7[17;1H[?12l[?25h[?25l[62;188H8[18;1H[?12l[?25h[?25l[62;188H9[19;1H[?12l[?25h[?25l[62;187H20[20;1H[?12l[?25h[?25l[62;188H1[21;1H[?12l[?25h[?25l[62;188H2[22;1H[?12l[?25h[?25l[62;188H3[23;1H[?12l[?25h[?25l[62;188H4[24;1H[?12l[?25h[?25l[62;188H5,0-1[25;1H[?12l[?25h[?25l[62;188H6,1  [26;1H[?12l[?25h[?25l[62;188H7[27;1H[?12l[?25h[?25l[62;188H8,0-1[28;1H[?12l[?25h[?25l[62;188H9,1  [29;1H[?12l[?25h[?25l[62;187H30[30;1H[?12l[?25h[?25l[62;188H1[31;1H[?12l[?25h[?25l[62;188H2,0-1[32;1H[?12l[?25h[?25l[62;188H3,1  [33;1H[?12l[?25h[?25l[62;188H4[34;1H[?12l[?25h[?25l[62;188H5[35;1H[?12l[?25h[?25l[62;188H6[36;1H[?12l[?25h[?25l[62;188H7[37;1H[?12l[?25h[?25l[62;188H8,0-1[38;1H[?12l[?25h[?25l[62;188H9,1  [39;1H[?12l[?25h[?25l[62;187H40,0-1[40;1H[?12l[?25h[?25l[62;188H1,1  [41;1H[?12l[?25h[?25l[62;188H2[42;1H[?12l[?25h[?25l[62;188H3,0-1[43;1H[?12l[?25h[?25l[62;188H4,1  [44;1H[?12l[?25h[?25l[62;188H5[45;1H[?12l[?25h[?25l[62;188H6,0-1[46;1H[?12l[?25h[?25l[62;188H7,1  [47;1H[?12l[?25h[?25l[62;188H8[48;1H[?12l[?25h[?25l[62;188H9,0-1[49;1H[?12l[?25h[?25l[62;187H50,1  [50;1H[?12l[?25h[?25l[62;188H1,0-1[51;1H[?12l[?25h[?25l[62;188H2,1  [52;1H[?12l[?25h[?25l[62;188H3[53;1H[?12l[?25h[?25l[62;188H4[54;1H[?12l[?25h[?25l[62;188H5[55;1H[?12l[?25h[?25l[62;188H6[56;1H[?12l[?25h[?25l[62;188H7[57;1H[?12l[?25h[?25l[62;188H8[58;1H[?12l[?25h[?25l[62;188H9[59;1H[?12l[?25h[?25l[62;187H60[60;1H[?12l[?25h[?25l[62;188H1[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H62,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H63,0-1[9C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutput[m(msg): [96m#spare_function::spare_function_out[m[62;187H[K[62;187H64,1[11C0%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub = spare_function_out()[62;187H[K[62;187H65,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.rudder = msg[[95m0[m][62;187H[K[62;187H66,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.sail = msg[[95m1[m][62;187H[K[62;187H67,1[11C1%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationA = msg[[95m2[m][62;187H[K[62;187H68,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.deviationD = msg[[95m3[m][62;187H[K[62;187H69,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.oyaw0 = msg[[95m4[m][62;187H[K[62;187H70,1[11C2%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.suboyaw0 = msg[[95m5[m][62;187H[K[62;187H71,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hout_pub.Yaw = msg[[95m6[m][62;187H[K[62;187H72,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m out_pub[62;187H[K[62;187H73,1[11C3%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H74,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H75,0-1[9C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetOutParaPut[m(msg):[96m#spare_function::spare_function_para[m[62;187H[K[62;187H76,1[11C4%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg = spare_function_para()[62;187H[K[62;187H77,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.oyaw   = msg[[95m1[m][62;187H[K[62;187H78,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderP= msg[[95m2[m][62;187H[K[62;187H79,1[11C5%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderI= msg[[95m3[m][62;187H[K[62;187H80,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.rudderD= msg[[95m4[m][62;187H[K[62;187H81,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailP  = msg[[95m5[m][62;187H[K[62;187H82,1[11C6%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailI  = msg[[95m6[m][62;187H[K[62;187H83,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_pubmsg.sailD  = msg[[95m7[m][62;187H[K[62;187H84,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m para_pubmsg[62;187H[K[62;187H85,1[11C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H86,0-1[9C7%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H87,0-1[9C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96msensorCallback[m(msg): [96m#sailboat_message::Sensor_msg[m[62;187H[K[62;187H88,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m sensor_submsg[62;187H[K[62;187H89,1[11C8%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m0[m] = msg.Roll[62;187H[K[62;187H90,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m1[m] = msg.Yaw[62;187H[K[62;187H91,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m2[m] = msg.AWA[62;187H[K[62;187H92,1[11C9%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m3[m] = msg.TWA[62;187H[K[62;187H93,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m4[m] = msg.Posx[62;187H[K[62;187H94,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m5[m] = msg.Posy[62;187H[K[62;187H95,1[10C10%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m6[m] = msg.ux[62;187H[K[62;187H96,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m7[m] = msg.vy[62;187H[K[62;187H97,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsensor_submsg[[95m8[m] = msg.AWS[62;187H[K[62;187H98,1[10C11%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H99,0-1[8C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H100,0-1[7C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mgetConfigCallback[m(config, level):  [96m# spare_function::spare_function_Config[m[62;187H[K[62;187H101,1[9C12%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m para_cfg[62;187H[K[62;187H102,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m (config.PC_Ctrl == [1m[96mTrue[m):[62;187H[K[62;187H103,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m1[m[62;187H[K[62;187H104,1[9C13%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H105,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hpara_cfg[[95m0[m] = [95m0[m[62;187H[K[62;187H106,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m1[m] = config.oyaw[62;187H[K[62;187H107,1[9C14%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m2[m] = config.rudderP  [96m# rudderP[m[62;187H[K[62;187H108,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m3[m] = config.rudderI  [96m# rudderI[m[62;187H[K[62;187H109,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m4[m] = config.rudderD  [96m# rudderD[m[62;187H[K[62;187H110,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m5[m] = config.sailP    [96m# devD[m[62;187H[K[62;187H111,1[9C15%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m6[m] = config.sailI    [96m# pos1x[m[62;187H[K[62;187H112,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hpara_cfg[[95m7[m] = config.sailD    [96m# pos1y[m[62;187H[K[62;187H113,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m config[62;187H[K[62;187H114,1[9C16%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H115,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H116,0-1[7C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sail_angle[m(awa):[62;187H[K[62;187H117,1[9C17%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -pi/[95m4.0[m <= awa <= pi/[95m4.0[m:[62;187H[K[62;187H118,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = [95m0[m[62;187H[K[62;187H119,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H120,1[9C18%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsail_angle = -[95m1[m * pi / [95m2.0[m * math.sin(sensor_submsg[[95m2[m] / [95m2.0[m)[62;187H[K[62;187H121,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sail_angle[62;187H[K[62;187H122,1[9C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H123,0-1[7C19%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H124,0-1[7C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_twa[m(yaw, awa, ux, vy, aws):[62;187H[K[62;187H125,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Halpha = yaw + awa - pi[62;187H[K[62;187H126,1[9C20%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m alpha <= -pi:[62;187H[K[62;187H127,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Halpha = alpha + [95m2[m * pi[62;187H[K[62;187H128,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_ux = aws * math.cos(alpha) + ux[62;187H[K[62;187H129,1[9C21%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Htwa_uy = aws * math.sin(alpha) + vy[62;187H[K[62;187H130,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m twa_ux > [95m0[m:[62;187H[K[62;187H131,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux)[62;187H[K[62;187H132,1[9C22%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m twa_ux < [95m0[m:[62;187H[K[62;187H133,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = math.atan(twa_uy / twa_ux) + pi[62;187H[K[62;187H134,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m twa0 >= pi:[62;187H[K[62;187H135,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Htwa0 = twa0 - [95m2[m*pi  [96m# correct the mistake ******************************************[m[62;187H[K[62;187H136,1[9C23%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H137,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Htwa0 = pi[62;187H[K[62;187H138,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m twa0[62;187H[K[62;187H139,1[9C24%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H140,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H141,0-1[7C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcomputeoyaw[m(pos):  [96m# pos[x0,y0,x1,y1][m[62;187H[K[62;187H142,1[9C25%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m pos[[95m2[m] - pos[[95m0[m] > [95m0[m:[62;187H[K[62;187H143,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m]-pos[[95m1[m])/(pos[[95m2[m]-pos[[95m0[m]))[62;187H[K[62;187H144,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melif[m pos[[95m2[m] - pos[[95m0[m] < [95m0[m:[62;187H[K[62;187H145,1[9C26%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = math.atan((pos[[95m3[m] - pos[[95m1[m]) / (pos[[95m2[m] - pos[[95m0[m])) + pi[62;187H[K[62;187H146,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m yaw0 >= pi:[62;187H[K[62;187H147,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hyaw0 = yaw0 - [95m2[m * pi[62;187H[K[62;187H148,1[9C27%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H149,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hyaw0 = pi / [95m2[m * (pos[[95m3[m] - pos[[95m1[m]) / [1m[96mabs[m(pos[[95m3[m] - pos[[95m1[m])[62;187H[K[62;187H150,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m yaw0  [96m# yaw0:[-pi, pi][m[62;187H[K[62;187H151,1[9C28%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H152,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H153,0-1[7C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_angle_oyaw_twa[m(oyaw, twa):[62;187H[K[62;187H154,1[9C29%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hangle_between_oyaw_twa = oyaw - twa + pi[62;187H[K[62;187H155,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m angle_between_oyaw_twa >= [95m7.0[m / [95m4.0[m * pi:[62;187H[K[62;187H156,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hangle_between_oyaw_twa = angle_between_oyaw_twa - [95m2.0[m * pi[62;187H[K[62;187H157,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m angle_between_oyaw_twa[62;187H[K[62;187H158,1[9C30%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H159,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H160,0-1[7C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mjudge_whether_against_wind[m(angle_oyaw_twa):[62;187H[K[62;187H161,1[9C31%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m -[95m1.0[m / [95m4.0[m * pi <= angle_oyaw_twa <= [95m1.0[m / [95m4.0[m * pi:[62;187H[K[62;187H162,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mTrue[m[62;187H[K[62;187H163,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H164,1[9C32%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hagainst_wind = [1m[96mFalse[m[62;187H[K[62;187H165,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m against_wind[62;187H[K[62;187H166,1[9C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H167,0-1[7C33%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H168,0-1[7C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_deviation_distance[m(x0, y0, x1, y1, oyaw):[62;187H[K[62;187H169,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdev_distance = (x1 - x0) * math.sin(oyaw) - (y1 - y0) * math.cos(oyaw)[62;187H[K[62;187H170,1[9C34%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m dev_distance[62;187H[K[62;187H171,1[9C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H172,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H173,0-1[7C35%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mcompute_sub_oyaw[m(against_wind, angle_oyaw_twa, dev_distance, set_dev_distance, twa, oyaw):[62;187H[K[62;187H174,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m Zip[62;187H[K[62;187H175,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnL[62;187H[K[62;187H176,1[9C36%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mglobal[m turnR[62;187H[K[62;187H177,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m against_wind:[62;187H[K[62;187H178,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m ([95m5.0[m/[95m180.0[m*pi <= angle_oyaw_twa < pi / [95m4.0[m) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H179,1[9C37%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H180,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H181,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H182,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m (-pi / [95m4[m < angle_oyaw_twa < -[95m5.0[m/[95m180.0[m*pi) [93mand[m (Zip == [95m1[m):[62;187H[K[62;187H183,1[9C38%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H184,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H185,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H186,1[9C39%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m Zip == [95m1[m:[62;187H[K[62;187H187,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H188,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H189,1[9C40%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H190,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H191,0-1[7C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m dev_distance < -[95m1.0[m * set_dev_distance:  [96m# para_cfg[5] = config.sailP  ---- devD[m[62;187H[K[62;187H192,1[9C41%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m1[m[62;187H[K[62;187H193,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H194,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m0[m[62;187H[K[62;187H195,1[9C42%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m dev_distance > [95m1.0[m * set_dev_distance:[62;187H[K[62;187H196,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnR = [95m1[m[62;187H[K[62;187H197,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HZip = [95m0[m[62;187H[K[62;187H198,1[9C43%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HturnL = [95m0[m[62;187H[K[62;187H199,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H200,0-1[7C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m turnL == [95m1[m:[62;187H[K[62;187H201,1[9C44%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m5.0[m / [95m4.0[m * pi[62;187H[K[62;187H202,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m turnR == [95m1[m:[62;187H[K[62;187H203,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = twa - [95m3.0[m / [95m4.0[m * pi[62;187H[K[62;187H204,1[9C45%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melse[m:[62;187H[K[62;187H205,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = oyaw[62;187H[K[62;187H206,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H207,0-1[7C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mif[m sub_oyaw0 < [95m0[m:[62;187H[K[62;187H208,1[9C46%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = [95m2[m * pi + sub_oyaw0[62;187H[K[62;187H209,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93melif[m sub_oyaw0 > pi * [95m2[m:[62;187H[K[62;187H210,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw0 = sub_oyaw0 - pi * [95m2[m[62;187H[K[62;187H211,1[9C47%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93melse[m:[62;187H[K[62;187H212,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnL = [95m0[m[62;187H[K[62;187H213,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HturnR = [95m0[m[62;187H[K[62;187H214,1[9C48%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9HZip = [95m0[m[62;187H[K[62;187H215,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hsub_oyaw0 = oyaw[62;187H[K[62;187H216,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m sub_oyaw0[62;187H[K[62;187H217,1[9C49%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H218,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H219,0-1[7C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mdef[m [1m[96mrudAlim[m(rudangle):[62;187H[K[62;187H220,1[9C50%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle >= pi/[95m6.0[m:[62;187H[K[62;187H221,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = pi/[95m6.0[m[62;187H[K[62;187H222,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mif[m rudangle <= -pi/[95m6.0[m:[62;187H[K[62;187H223,1[9C51%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9Hrudangle = -pi/[95m6.0[m[62;187H[K[62;187H224,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mreturn[m rudangle[62;187H[K[62;187H225,1[9C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H226,0-1[7C52%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;1H[93mif[m __name__ == [95m"__main__"[m:[62;187H[K[62;187H227,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.init_node([95m"example"[m, anonymous=[1m[96mTrue[m)[62;187H[K[62;187H228,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H229,0-1[7C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hmach_pub = rospy.Publisher([95m'mach'[m, Mach_msg, queue_size=[95m5[m)[62;187H[K[62;187H230,1[9C53%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_pub = rospy.Publisher([95m'spare_function_out'[m, spare_function_out, queue_size=[95m5[m)[62;187H[K[62;187H231,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hspare_function_para_pub = rospy.Publisher([95m'spare_function_para'[m, spare_function_para, queue_size=[95m5[m)[62;187H[K[62;187H232,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H233,1[9C54%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrospy.Subscriber([95m"sensor"[m, Sensor_msg, sensorCallback)[62;187H[K[62;187H234,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hconfig_srv = Server(spare_function_Config, getConfigCallback)[62;187H[K[62;187H235,1[9C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H236,0-1[7C55%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hrate = rospy.Rate([95m10[m)[62;187H[K[62;187H237,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hsa = pi/[95m2[m[62;187H[K[62;187H238,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hra = pi[62;187H[K[62;187H239,1[9C56%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdra = [95m0.01[m[62;187H[K[62;187H240,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5Hdsa = [95m0.1[m[62;187H[K[62;187H241,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mtry[m:[62;187H[K[62;187H242,1[9C57%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mwhile[m [93mnot[m rospy.is_shutdown():[62;187H[K[62;187H243,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# todo[m[62;187H[K[62;187H244,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HsailA = compute_sail_angle(sensor_submsg[[95m2[m])[62;187H[K[62;187H245,1[9C58%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[1] = msg.Yaw        para_cfg[1] = config.oyaw     # length[m[62;187H[K[62;187H246,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[2] = msg.AWA        para_cfg[2] = config.rudderP  # rudderP[m[62;187H[K[62;187H247,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[3] = msg.TWA        para_cfg[3] = config.rudderI  # rudderI[m[62;187H[K[62;187H248,1[9C59%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[4] = msg.Posx       para_cfg[4] = config.rudderD  # rudderD[m[62;187H[K[62;187H249,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[5] = msg.Posy       para_cfg[5] = config.sailP    # devD[m[62;187H[K[62;187H250,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[6] = msg.ux         para_cfg[6] = config.sailI    # pos1x[m[62;187H[K[62;187H251,1[9C60%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[7] = msg.vy         para_cfg[7] = config.sailD    # pos1y[m[62;187H[K[62;187H252,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# sensor_submsg[8] = msg.AWS[m[62;187H[K[62;187H253,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H254,0-1[7C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HUX = sensor_submsg[[95m6[m] * math.cos(sensor_submsg[[95m1[m])[62;187H[K[62;187H255,1[9C61%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HVY = sensor_submsg[[95m6[m] * math.sin(sensor_submsg[[95m1[m])[62;187H[K[62;187H256,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# TWA0 = sensor_submsg[3][m[62;187H[K[62;187H257,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HTWA0 = compute_twa(sensor_submsg[[95m1[m], sensor_submsg[[95m2[m], UX, VY, sensor_submsg[[95m8[m])[62;187H[K[62;187H258,1[9C62%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H259,0-1[7C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]]  [96m# auto triangle track[m[62;187H[K[62;187H260,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]]  # goal position[m[62;187H[K[62;187H261,1[9C63%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H262,0-1[7C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H263,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2  # goal position[m[62;187H[K[62;187H264,1[9C64%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hdistance1 = compute_deviation_distance(track[[95m2[m*nub], track[[95m2[m*nub+[95m1[m], sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], pi/[95m2.0[m+oyaw1)[62;187H[K[62;187H265,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m length <= para_cfg[[95m1[m] [93mor[m (length <= [95m4[m*para_cfg[[95m1[m] [93mand[m distance1 <= para_cfg[[95m1[m]):[62;187H[K[62;187H266,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hnub = nub + [95m1[m[62;187H[K[62;187H267,1[9C65%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mTrue[m[62;187H[K[62;187H268,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m nub == [95m3[m:[62;187H[K[62;187H269,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;21Hnub = [95m0[m[62;187H[K[62;187H270,1[9C66%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hlength = (sensor_submsg[[95m4[m] - track[[95m2[m * nub]) ** [95m2[m + (sensor_submsg[[95m5[m] - track[[95m2[m * nub + [95m1[m]) ** [95m2[m[62;187H[K[62;187H271,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hxy = [sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], track[[95m2[m * nub], track[[95m2[m * nub + [95m1[m]][62;187H[K[62;187H272,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# auto triangle track[m[62;187H[K[62;187H273,1[9C67%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# length = (sensor_submsg[4] - para_cfg[6]) ** 2 + (sensor_submsg[5] - para_cfg[7]) ** 2[m[62;187H[K[62;187H274,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# xy = [sensor_submsg[4], sensor_submsg[5], para_cfg[6], para_cfg[7]][m[62;187H[K[62;187H275,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m#  goal position[m[62;187H[K[62;187H276,1[9C68%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H277,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hoyaw0 = computeoyaw(xy)[62;187H[K[62;187H278,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# oyaw0 = para_cfg[1]  # goal yaw[m[62;187H[K[62;187H279,1[9C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H280,0-1[7C69%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m Flag0:  [96m# **************** make a turn *****************[m[62;187H[K[62;187H281,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H282,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H283,1[9C70%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0    [96m# ***************************[m[62;187H[K[62;187H284,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H285,0-1[7C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAngleOytw = compute_angle_oyaw_twa(oyaw0, TWA0)[62;187H[K[62;187H286,1[9C71%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HAgainstWind = judge_whether_against_wind(AngleOytw)[62;187H[K[62;187H287,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H288,0-1[7C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind:[62;187H[K[62;187H289,1[9C72%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HZip = [95m1[m[62;187H[K[62;187H290,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H291,0-1[7C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m AgainstWind [93mis[m [1m[96mFalse[m:  [96m# goal_yaw is the same as Twa[m[62;187H[K[62;187H292,1[9C73%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HX0 = sensor_submsg[[95m4[m][62;187H[K[62;187H293,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HY0 = sensor_submsg[[95m5[m][62;187H[K[62;187H294,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H295,1[9C74%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevD = compute_deviation_distance(X0, Y0, sensor_submsg[[95m4[m], sensor_submsg[[95m5[m], oyaw1)[62;187H[K[62;187H296,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H297,0-1[7C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsub_oyaw = compute_sub_oyaw(AgainstWind, AngleOytw, devD, para_cfg[[95m5[m], TWA0, oyaw1)  [96m# ************************[m[62;187H[K[62;187H298,1[9C75%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sub_oyaw >= pi:[62;187H[K[62;187H299,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw - [95m2[m*pi[62;187H[K[62;187H300,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m sub_oyaw <= -pi:[62;187H[K[62;187H301,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hsub_oyaw = sub_oyaw + [95m2[m*pi[62;187H[K[62;187H302,1[9C76%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H303,0-1[7C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m [1m[96mabs[m(sensor_submsg[[95m1[m] - sub_oyaw) < [95m0.1[m:[62;187H[K[62;187H304,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hoyaw1 = oyaw0[62;187H[K[62;187H305,1[9C77%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HFlag0 = [1m[96mFalse[m[62;187H[K[62;187H306,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H307,0-1[7C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13HdevA = sensor_submsg[[95m1[m] - sub_oyaw[62;187H[K[62;187H308,1[9C78%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m devA >= pi:[62;187H[K[62;187H309,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA - [95m2[m*pi[62;187H[K[62;187H310,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA <= -pi:[62;187H[K[62;187H311,1[9C79%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA = devA + [95m2[m*pi[62;187H[K[62;187H312,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H313,0-1[7C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m - pi/[95m2.0[m <= devA <= pi/[95m2.0[m:[62;187H[K[62;187H314,1[9C80%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HPer = devA[62;187H[K[62;187H315,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = Ier + devA[62;187H[K[62;187H316,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HDer = devA - devA0[62;187H[K[62;187H317,1[9C81%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier >= [95m15.0[m:  Ier = [95m15.0[m[62;187H[K[62;187H318,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[93mif[m Ier <= -[95m15.0[m:  Ier = -[95m15.0[m[62;187H[K[62;187H319,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17H[96m# rudA = -(para_cfg[2] * Per + para_cfg[3] * (Ier + para_cfg[4]/para_cfg[2] * Der) + para_cfg[4] * Der)[m[62;187H[K[62;187H320,1[9C82%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -(para_cfg[[95m2[m] * Per + para_cfg[[95m3[m] * Ier + para_cfg[[95m4[m] * Der)[62;187H[K[62;187H321,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = rudAlim(rudA)   [96m# limit the rudder's maximum angle to pi/6[m[62;187H[K[62;187H322,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = devA[62;187H[K[62;187H323,1[9C83%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melif[m devA > [95m0[m:[62;187H[K[62;187H324,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = -[95m1.0[m * pi / [95m6.0[m[62;187H[K[62;187H325,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H326,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H327,1[9C84%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93melse[m:[62;187H[K[62;187H328,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HrudA = pi / [95m6.0[m[62;187H[K[62;187H329,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HIer = [95m0[m[62;187H[K[62;187H330,1[9C85%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17HdevA0 = [95m0[m[62;187H[K[62;187H331,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H332,0-1[7C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_np = [para_cfg[[95m5[m], para_cfg[[95m6[m], [95m1[m][62;187H[K[62;187H333,1[9C86%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [length, TWA0*180/pi, devA*180/pi, devD, oyaw1*180/pi, sub_oyaw*180/pi, sensor_submsg[1]*180/pi][m[62;187H[K[62;187H334,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hsa += dsa[62;187H[K[62;187H335,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hra += dra[62;187H[K[62;187H336,1[9C87%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa >= pi:[62;187H[K[62;187H337,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = -[95m0.05[m[62;187H[K[62;187H338,1-8[7C88%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m sa <= [95m0[m:[62;187H[K[62;187H339,1[9C88%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdsa = [95m0.05[m[62;187H[K[62;187H340,1[9C89%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra >= [95m90.0[m/[95m180.0[m*pi:[62;187H[K[62;187H341,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = -[95m0.01[m[62;187H[K[62;187H342,1-8[7C89%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[93mif[m ra <= [95m75.0[m/[95m180.0[m*pi:[62;187H[K[62;187H343,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;17Hdra = [95m0.01[m[62;187H[K[62;187H344,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H345,1-8[7C90%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H346,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_np = [length, AngleOytw * [95m180[m / pi, turnR, devD, turnL, sub_oyaw * [95m180[m / pi, sensor_submsg[[95m1[m] * [95m180[m / pi]  [96m# test************************************************[m[62;187H[K[62;187H347,1-8[7C91%[61;8H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_np = [rudA*180/pi, sailA, ][m[62;187H[K[62;187H348,1[9C91%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.rudder = msg[0][m[62;187H[K[62;187H349,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.sail = msg[1][m[62;187H[K[62;187H350,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationA = msg[2][m[62;187H[K[62;187H351,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.deviationD = msg[3][m[62;187H[K[62;187H352,1[9C92%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.oyaw0 = msg[4]            # out_pub.suboyaw0 = msg[5][m[62;187H[K[62;187H353,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# out_pub.Yaw = msg[6][m[62;187H[K[62;187H354,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# para_np = [0,0,0,0,0,0,0][m[62;187H[K[62;187H355,1[9C93%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m#[m[62;187H[K[62;187H356,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# input : sensor_submsg [m[62;187H[K[62;187H357,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# cfg: para_cfg[m[62;187H[K[62;187H358,1[9C94%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13H[96m# output : mach_np out_np para_np[m[62;187H[K[62;187H359,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H360,0-1[7C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pubmsg = getOutMachPut(mach_np)[62;187H[K[62;187H361,1[9C95%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hout_pubmsg = getOutput(out_np)[62;187H[K[62;187H362,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hpara_pubmsg = getOutParaPut(para_cfg)[62;187H[K[62;187H363,1[9C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H364,0-1[7C96%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hmach_pub.publish(mach_pubmsg)[62;187H[K[62;187H365,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_pub.publish(out_pubmsg)[62;187H[K[62;187H366,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hspare_function_para_pub.publish(para_pubmsg)[62;187H[K[62;187H367,1[9C97%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[62;187H[K[62;187H368,0-1[7C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;13Hrate.sleep()[62;187H[K[62;187H369,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[93mexcept[m rospy.ROSInterruptException:[62;187H[K[62;187H370,1[9C98%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;9H[93mpass[m[62;187H[K[62;187H371,1[9C99%[61;1H[?12l[?25h[?25l[1;61r[61;1H
[1;62r[61;5H[96m#final